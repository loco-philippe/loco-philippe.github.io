<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 11.0.0"/>
    <title>ES.ilist API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(:first-of-type){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;cursor:pointer;}.pdoc details > summary:focus{outline:0;}.pdoc > section:first-of-type details > summary{top:-20px;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../ES.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;ES</a>

            <img src="https://loco-philippe.github.io/ES/logo_loco.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

        <h2>Contents</h2>
        <ul>
  <li><a href="#what-is-the-ilist-object">What is the Ilist Object ?</a></li>
  <li><a href="#main-principles">Main principles</a>
  <ul>
    <li><a href="#index-properties">Index properties</a></li>
    <li><a href="#ilist-size">Ilist size</a></li>
    <li><a href="#aggregation">aggregation</a></li>
  </ul></li>
</ul>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="function" href="#identity">identity</a>
            </li>
            <li>
                    <a class="class" href="#IlistEncoder">IlistEncoder</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#IlistEncoder.default">default</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CborDecoder">CborDecoder</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CborDecoder.__init__">CborDecoder</a>
                        </li>
                        <li>
                                <a class="function" href="#CborDecoder.codecbor">codecbor</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Ilist">Ilist</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Ilist.__init__">Ilist</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.Iidic">Iidic</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.Iset">Iset</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.Iidx">Iidx</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.Iedic">Iedic</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.Iext">Iext</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.Izip">Izip</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.extval">extval</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.iidx">iidx</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.setidx">setidx</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.valname">valname</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.idxname">idxname</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.axes">axes</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.axesall">axesall</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.axesmin">axesmin</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.axesmono">axesmono</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.axesmulti">axesmulti</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.complete">complete</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.completefull">completefull</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.consistent">consistent</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.dicidxref">dicidxref</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.dimension">dimension</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.extidx">extidx</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.idicidxref">idicidxref</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.idxcoupled">idxcoupled</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.idxder">idxder</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.idxderived">idxderived</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.idxlen">idxlen</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.idxref">idxref</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.idxunique">idxunique</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.ind">ind</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.ival">ival</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.lencomplete">lencomplete</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.lencompletefull">lencompletefull</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.lenidx">lenidx</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.minMaxIndex">minMaxIndex</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.rate">rate</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.setval">setval</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.setvallen">setvallen</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.textidx">textidx</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.tiidx">tiidx</a>
                        </li>
                        <li>
                                <a class="variable" href="#Ilist.zip">zip</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.addextidx">addextidx</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.addlistidx">addlistidx</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.append">append</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.appendi">appendi</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.axescoupling">axescoupling</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.couplingmatrix">couplingmatrix</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.derived_to_coupled">derived_to_coupled</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.extidxtoi">extidxtoi</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.from_obj">from_obj</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.from_csv">from_csv</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.from_file">from_file</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.full">full</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.iadd">iadd</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.iidxtoext">iidxtoext</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.iloc">iloc</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.iseIndex">iseIndex</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.isiIndex">isiIndex</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.isValue">isValue</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.json">json</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.loc">loc</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.merge">merge</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.mergeidx">mergeidx</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.reindex">reindex</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.reorder">reorder</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.setname">setname</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.setfilter">setfilter</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.sort">sort</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.sortidx">sortidx</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.swapindex">swapindex</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.to_file">to_file</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.to_csv">to_csv</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.to_numpy">to_numpy</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.to_obj">to_obj</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.to_xarray">to_xarray</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.unconsistent">unconsistent</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.updateidx">updateidx</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.updatelist">updatelist</a>
                        </li>
                        <li>
                                <a class="function" href="#Ilist.vlist">vlist</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#IlistError">IlistError</a>
                            <ul class="memberlist">
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section>
                    <h1 class="modulename">
<a href="./../ES.html">ES</a><wbr>.ilist    </h1>

                        <div class="docstring"><p>Created on Sun Jan  2 18:30:14 2022</p>

<p>@author: Philippe@loco-labs.io</p>

<p>The <code><a href="">ES.ilist</a></code> module contains the <code><a href="#Ilist">Ilist</a></code> class.</p>

<h1 id="what-is-the-ilist-object">What is the Ilist Object ?</h1>

<p>The Ilist Object is a combination of a set of data and properties (index) that describe it.
In the example below, the set of data is scores of students and the properties are the name,
 the age and the subject.</p>

<p><img src="./ilist_example.png" width="500"></p>

<p>The Ilist Object has many properties and can be converted into a matrix (e.g. numpy
or Xarray object to perform statistical processing) or into several formats (e.g. json, csv, bytes).</p>

<p><img src="./ilist_xarray.png" width="400"></p>

<p>The data model is as follows :</p>

<p><img src="./ilist_data_structure.png" width="500"></p>

<ul>
<li>the user data (extval, extidx) can be everything,</li>
<li>the internal data (ival, iidx) are integers, which makes the processing to be performed
much simpler</li>
<li>the index user data (extidx) are dynamic to reduce the size of data.</li>
</ul>

<h1 id="main-principles">Main principles</h1>

<h2 id="index-properties">Index properties</h2>

<h3 id="index-categories">Index categories</h3>

<p>Indexes can be characterized according to the link between external values and internal keys :</p>

<ul>
<li>complete index : one internal key for one external values</li>
<li>unique index : one internal key for all external values </li>
<li>mixte index : index not complete and not unique</li>
</ul>

<p><img src="./ilist_index_category.png" width="800"></p>

<h3 id="index-relationships">Index relationships</h3>

<p>An index can also be characterized based on relationships with another index</p>

<p>There are 4 relationships categories :</p>

<ul>
<li>coupled : an index is coupled to another if there is a 1-to-1 correspondence between values</li>
<li>derived : an index is derived from another if there is a 1-to-n correspondence between values</li>
<li>crossed : two indexes are crossed if there is a correspondence between all values</li>
<li>linked  : if two indexes are not coupled, derived or crossed</li>
</ul>

<p><img src="./ilist_link_category.png" width="800"></p>

<p>If one index is complete, all the indexes are derived from it.
If one index is unique, it is derived from all indexes.
If A is derived from B and B is derived from C, A is derived from C.
If A is coupled from B, all the relationships with other indexes are identical.</p>

<p>The indicated ratio is defined to measure the 'proximity' between to indexes. The value is 
between 0% (the indexes are dependant - coupled or derived) and 100% (the indexes are independant : 
crossed or linked).</p>

<h3 id="global-properties">Global properties</h3>

<p><strong>Index definition</strong></p>

<ul>
<li>An index is derived if it’s derived from at least one other index</li>
<li>An index is coupled if it’s coupled from at least one other index</li>
<li>An Index is primary if it’s not coupled, not derived and not unique</li>
</ul>

<p><strong>IndexSet definition</strong></p>

<ul>
<li>Dimension : number of primary indexes</li>
<li>Full : An indexSet is full if all the primary indexes are crossed with each 
other primary index</li>
<li>Complete : An indexSet is complete if all the non coupled indexes are crossed 
with each other non coupled index</li>
</ul>

<p><strong>Properties</strong></p>

<ul>
<li>The number of values of a full indexset is the product of the primary indexes lenght</li>
<li>A full indexSet is complete</li>
<li>A full IndexSet can be transformed in a Matrix with the dimension of the indexset</li>
<li>A complete Indexset can be expressed in a flat list of values (without detailed indexes)</li>
</ul>

<h3 id="functions">Functions</h3>

<p>These properties can be used to modify an indexset in particular to transform an 
Ilist object into a matrix of chosen dimension    </p>

<p><img src="./ilist_process.png" width="800"></p>

<h3 id="example">Example</h3>

<p>In the example below, 3 columns are linked (Full name, Course, Examen),
3 columns are derived (First name, Last name, Group), 1 column is coupled (Surname),
1 column is unique (Year).</p>

<p><img src="./ilist_index.png" width="800"></p>

<p>If an index is not primary, index values can be calculated from primary indexes.
This property is very usefull if new values have to be added to the Ilist, for example,
if we decide to have all the combinations of independant index.</p>

<p>In this example, the 'full' method generates missing data for all combinations
of primary indexes fullname, course and examen.</p>

<p><img src="./ilist_full.png" width="800"></p>

<p>The completed ilist can then be transformed into a 3 dimensions matrix (e.g. Xarray)
 with one dimension for each primary index.
If the dimension required is lower than ilist dimension, the function to_xarray 
merge the indexes with the lowest coupling rate. </p>

<p>In the example below, a new index 'course-full name' with 'full name' and 'course' is created.
So 'course' and 'full name' become derived from the new index and the dimension 
now becomes 2 :</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">il</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">(</span><span class="n">fillvalue</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">42</span><span class="p">]:</span> 
<span class="o">&lt;</span><span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span> <span class="s1">&#39;Ilist&#39;</span> <span class="p">(</span><span class="n">full</span> <span class="n">name</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">course</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">examen</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span><span class="o">&gt;</span>
<span class="n">array</span><span class="p">([[[</span><span class="n">nan</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">12.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">11.</span><span class="p">,</span> <span class="mf">13.</span><span class="p">,</span> <span class="mf">15.</span><span class="p">],</span>
        <span class="p">[</span><span class="n">nan</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">nan</span><span class="p">]],</span>

       <span class="p">[[</span> <span class="mf">2.</span><span class="p">,</span>  <span class="mf">4.</span><span class="p">,</span> <span class="n">nan</span><span class="p">],</span>
        <span class="p">[</span><span class="n">nan</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">nan</span><span class="p">],</span>
        <span class="p">[</span><span class="n">nan</span><span class="p">,</span> <span class="mf">18.</span><span class="p">,</span> <span class="mf">17.</span><span class="p">]],</span>

       <span class="p">[[</span> <span class="mf">6.</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">nan</span><span class="p">],</span>
        <span class="p">[</span><span class="n">nan</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">nan</span><span class="p">],</span>
        <span class="p">[</span><span class="n">nan</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="mf">18.</span><span class="p">]],</span>

       <span class="p">[[</span><span class="n">nan</span><span class="p">,</span>  <span class="mf">8.</span><span class="p">,</span> <span class="n">nan</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">15.</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">nan</span><span class="p">],</span>
        <span class="p">[</span><span class="n">nan</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">nan</span><span class="p">]]])</span>
<span class="n">Coordinates</span><span class="p">:</span>
    <span class="n">first</span> <span class="n">name</span>  <span class="p">(</span><span class="n">full</span> <span class="n">name</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">U8</span> <span class="s1">&#39;Anne&#39;</span> <span class="s1">&#39;Camille&#39;</span> <span class="s1">&#39;Philippe&#39;</span> <span class="s1">&#39;Philippe&#39;</span>
    <span class="n">last</span> <span class="n">name</span>   <span class="p">(</span><span class="n">full</span> <span class="n">name</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">U5</span> <span class="s1">&#39;White&#39;</span> <span class="s1">&#39;Red&#39;</span> <span class="s1">&#39;Black&#39;</span> <span class="s1">&#39;White&#39;</span>
  <span class="o">*</span> <span class="n">full</span> <span class="n">name</span>   <span class="p">(</span><span class="n">full</span> <span class="n">name</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">U14</span> <span class="s1">&#39;Anne White&#39;</span> <span class="s1">&#39;Camille Red&#39;</span> <span class="o">...</span> <span class="s1">&#39;Philippe White&#39;</span>
    <span class="n">surname</span>     <span class="p">(</span><span class="n">full</span> <span class="n">name</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">U10</span> <span class="s1">&#39;skyler&#39;</span> <span class="s1">&#39;saul&#39;</span> <span class="s1">&#39;gus&#39;</span> <span class="s1">&#39;heisenberg&#39;</span>
    <span class="n">group</span>       <span class="p">(</span><span class="n">full</span> <span class="n">name</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">U3</span> <span class="s1">&#39;gr1&#39;</span> <span class="s1">&#39;gr3&#39;</span> <span class="s1">&#39;gr3&#39;</span> <span class="s1">&#39;gr2&#39;</span>
  <span class="o">*</span> <span class="n">course</span>      <span class="p">(</span><span class="n">course</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">U8</span> <span class="s1">&#39;english&#39;</span> <span class="s1">&#39;math&#39;</span> <span class="s1">&#39;software&#39;</span>
  <span class="o">*</span> <span class="n">examen</span>      <span class="p">(</span><span class="n">examen</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">U2</span> <span class="s1">&#39;t1&#39;</span> <span class="s1">&#39;t2&#39;</span> <span class="s1">&#39;t3&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="n">il</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">(</span><span class="n">dimmax</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">43</span><span class="p">]:</span> 
<span class="o">&lt;</span><span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span> <span class="s1">&#39;Ilist&#39;</span> <span class="p">(</span><span class="n">examen</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;course&quot;</span><span class="p">,</span> <span class="s2">&quot;full name&quot;</span><span class="p">]:</span> <span class="mi">8</span><span class="p">)</span><span class="o">&gt;</span>
<span class="n">array</span><span class="p">([[</span><span class="mf">11.</span><span class="p">,</span> <span class="mf">15.</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span>  <span class="mf">2.</span><span class="p">,</span>  <span class="mf">6.</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">nan</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">13.</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span>  <span class="mf">8.</span><span class="p">,</span>  <span class="mf">4.</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="mf">18.</span><span class="p">,</span> <span class="n">nan</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">15.</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="mf">12.</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="mf">17.</span><span class="p">,</span> <span class="mf">18.</span><span class="p">]])</span>
<span class="n">Coordinates</span><span class="p">:</span>
    <span class="n">first</span> <span class="n">name</span>               <span class="p">([</span><span class="s2">&quot;course&quot;</span><span class="p">,</span> <span class="s2">&quot;full name&quot;</span><span class="p">])</span> <span class="o">&lt;</span><span class="n">U8</span> <span class="s1">&#39;Anne&#39;</span> <span class="o">...</span> <span class="s1">&#39;Philippe&#39;</span>
    <span class="n">last</span> <span class="n">name</span>                <span class="p">([</span><span class="s2">&quot;course&quot;</span><span class="p">,</span> <span class="s2">&quot;full name&quot;</span><span class="p">])</span> <span class="o">&lt;</span><span class="n">U5</span> <span class="s1">&#39;White&#39;</span> <span class="o">...</span> <span class="s1">&#39;Black&#39;</span>
    <span class="n">full</span> <span class="n">name</span>                <span class="p">([</span><span class="s2">&quot;course&quot;</span><span class="p">,</span> <span class="s2">&quot;full name&quot;</span><span class="p">])</span> <span class="o">&lt;</span><span class="n">U14</span> <span class="s1">&#39;Anne White&#39;</span> <span class="o">...</span> <span class="o">...</span>
    <span class="n">surname</span>                  <span class="p">([</span><span class="s2">&quot;course&quot;</span><span class="p">,</span> <span class="s2">&quot;full name&quot;</span><span class="p">])</span> <span class="o">&lt;</span><span class="n">U10</span> <span class="s1">&#39;skyler&#39;</span> <span class="o">...</span> <span class="s1">&#39;gus&#39;</span>
    <span class="n">group</span>                    <span class="p">([</span><span class="s2">&quot;course&quot;</span><span class="p">,</span> <span class="s2">&quot;full name&quot;</span><span class="p">])</span> <span class="o">&lt;</span><span class="n">U3</span> <span class="s1">&#39;gr1&#39;</span> <span class="s1">&#39;gr2&#39;</span> <span class="o">...</span> <span class="s1">&#39;gr3&#39;</span>
    <span class="n">course</span>                   <span class="p">([</span><span class="s2">&quot;course&quot;</span><span class="p">,</span> <span class="s2">&quot;full name&quot;</span><span class="p">])</span> <span class="o">&lt;</span><span class="n">U8</span> <span class="s1">&#39;math&#39;</span> <span class="o">...</span> <span class="s1">&#39;software&#39;</span>
  <span class="o">*</span> <span class="n">examen</span>                   <span class="p">(</span><span class="n">examen</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">U2</span> <span class="s1">&#39;t1&#39;</span> <span class="s1">&#39;t2&#39;</span> <span class="s1">&#39;t3&#39;</span>
  <span class="o">*</span> <span class="p">[</span><span class="s2">&quot;course&quot;</span><span class="p">,</span> <span class="s2">&quot;full name&quot;</span><span class="p">]</span>  <span class="p">([</span><span class="s2">&quot;course&quot;</span><span class="p">,</span> <span class="s2">&quot;full name&quot;</span><span class="p">])</span> <span class="o">&lt;</span><span class="n">U6</span> <span class="s1">&#39;(0, 0)&#39;</span> <span class="o">...</span> <span class="s1">&#39;(2, 3)&#39;</span>
</code></pre></div>

<h2 id="ilist-size">Ilist size</h2>

<p>A list of values (e.g. ['Paul', 'John', 'Marie', 'John']) is represented in an indexed list by :</p>

<ul>
<li>a list of different values (e.g. ['Paul', 'John', 'Marie'])</li>
<li>a list of index (e.g. [0, 1, 2, 1])</li>
</ul>

<p>This representation is similar to Pandas categorical's type.</p>

<p>In term of data volume, there is no duplication (gain) but the index list is added (loss). 
The graph below shows the size difference between simple list and indexed list.</p>

<p><img src="./ilist_size2.png" width="800"></p>

<p>If the values are small (e.g. int, float), the indexed list is bigger than simple list.
If the unicity ratio (number of different values / number of values) is high (&gt; 90%), 
the indexed list is bigger than simple list.
In the other cases, the indexed list is smaller than a simple list (general case of csv files)</p>

<h2 id="aggregation">aggregation</h2>

<p>One of the properties of Ilist object is to be able to index any type of object and 
in particular Ilist objects. This indexing can be recursive, which makes it possible 
to preserve the integrity of the data.</p>

<p>A 'merge' method transform the Ilist object thus aggregated 
into a flat Ilist object.</p>

<p><img src="./ilist_aggregation.png" width="800"></p>

<p>In the example below, an Ilist object is build for each person.
These Ilist objects are then assembled into a summary object which can be 
disassembled by the function 'merge'.</p>

<p><img src="./ilist_merge.png" width="800"></p>
</div>

                        <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Sun Jan  2 18:30:14 2022</span>

<span class="sd">@author: Philippe@loco-labs.io</span>

<span class="sd">The `ES.ilist` module contains the `Ilist` class.</span>

<span class="sd"># What is the Ilist Object ?</span>

<span class="sd">The Ilist Object is a combination of a set of data and properties (index) that describe it.</span>
<span class="sd">In the example below, the set of data is scores of students and the properties are the name,</span>
<span class="sd"> the age and the subject.</span>

<span class="sd">&lt;img src=&quot;./ilist_example.png&quot; width=&quot;500&quot;&gt;</span>

<span class="sd">The Ilist Object has many properties and can be converted into a matrix (e.g. numpy</span>
<span class="sd">or Xarray object to perform statistical processing) or into several formats (e.g. json, csv, bytes).</span>

<span class="sd">&lt;img src=&quot;./ilist_xarray.png&quot; width=&quot;400&quot;&gt;</span>

<span class="sd">The data model is as follows :</span>

<span class="sd">&lt;img src=&quot;./ilist_data_structure.png&quot; width=&quot;500&quot;&gt;</span>

<span class="sd">- the user data (extval, extidx) can be everything,</span>
<span class="sd">- the internal data (ival, iidx) are integers, which makes the processing to be performed</span>
<span class="sd"> much simpler</span>
<span class="sd">- the index user data (extidx) are dynamic to reduce the size of data.</span>

<span class="sd"># Main principles</span>

<span class="sd">## Index properties</span>

<span class="sd">### Index categories</span>

<span class="sd">Indexes can be characterized according to the link between external values and internal keys :</span>
<span class="sd">    </span>
<span class="sd">- complete index : one internal key for one external values</span>
<span class="sd">- unique index : one internal key for all external values </span>
<span class="sd">- mixte index : index not complete and not unique</span>

<span class="sd">&lt;img src=&quot;./ilist_index_category.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd">### Index relationships</span>

<span class="sd">An index can also be characterized based on relationships with another index</span>

<span class="sd">There are 4 relationships categories :</span>

<span class="sd">- coupled : an index is coupled to another if there is a 1-to-1 correspondence between values</span>
<span class="sd">- derived : an index is derived from another if there is a 1-to-n correspondence between values</span>
<span class="sd">- crossed : two indexes are crossed if there is a correspondence between all values</span>
<span class="sd">- linked  : if two indexes are not coupled, derived or crossed</span>

<span class="sd">&lt;img src=&quot;./ilist_link_category.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd">If one index is complete, all the indexes are derived from it.</span>
<span class="sd">If one index is unique, it is derived from all indexes.</span>
<span class="sd">If A is derived from B and B is derived from C, A is derived from C.</span>
<span class="sd">If A is coupled from B, all the relationships with other indexes are identical.</span>

<span class="sd">The indicated ratio is defined to measure the &#39;proximity&#39; between to indexes. The value is </span>
<span class="sd">between 0% (the indexes are dependant - coupled or derived) and 100% (the indexes are independant : </span>
<span class="sd">crossed or linked).</span>

<span class="sd">### Global properties</span>

<span class="sd">**Index definition**</span>

<span class="sd">- An index is derived if it’s derived from at least one other index</span>
<span class="sd">- An index is coupled if it’s coupled from at least one other index</span>
<span class="sd">- An Index is primary if it’s not coupled, not derived and not unique</span>

<span class="sd">**IndexSet definition**</span>

<span class="sd">- Dimension : number of primary indexes</span>
<span class="sd">- Full : An indexSet is full if all the primary indexes are crossed with each </span>
<span class="sd">other primary index</span>
<span class="sd">- Complete : An indexSet is complete if all the non coupled indexes are crossed </span>
<span class="sd">with each other non coupled index</span>

<span class="sd">**Properties**</span>

<span class="sd">- The number of values of a full indexset is the product of the primary indexes lenght</span>
<span class="sd">- A full indexSet is complete</span>
<span class="sd">- A full IndexSet can be transformed in a Matrix with the dimension of the indexset</span>
<span class="sd">- A complete Indexset can be expressed in a flat list of values (without detailed indexes)</span>

<span class="sd">### Functions</span>

<span class="sd">These properties can be used to modify an indexset in particular to transform an </span>
<span class="sd">Ilist object into a matrix of chosen dimension    </span>

<span class="sd">&lt;img src=&quot;./ilist_process.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd">### Example</span>

<span class="sd">In the example below, 3 columns are linked (Full name, Course, Examen),</span>
<span class="sd">3 columns are derived (First name, Last name, Group), 1 column is coupled (Surname),</span>
<span class="sd">1 column is unique (Year).</span>

<span class="sd">&lt;img src=&quot;./ilist_index.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd">If an index is not primary, index values can be calculated from primary indexes.</span>
<span class="sd">This property is very usefull if new values have to be added to the Ilist, for example,</span>
<span class="sd">if we decide to have all the combinations of independant index.</span>

<span class="sd">In this example, the &#39;full&#39; method generates missing data for all combinations</span>
<span class="sd">of primary indexes fullname, course and examen.</span>

<span class="sd">&lt;img src=&quot;./ilist_full.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd">The completed ilist can then be transformed into a 3 dimensions matrix (e.g. Xarray)</span>
<span class="sd"> with one dimension for each primary index.</span>
<span class="sd">If the dimension required is lower than ilist dimension, the function to_xarray </span>
<span class="sd">merge the indexes with the lowest coupling rate. </span>

<span class="sd">In the example below, a new index &#39;course-full name&#39; with &#39;full name&#39; and &#39;course&#39; is created.</span>
<span class="sd">So &#39;course&#39; and &#39;full name&#39; become derived from the new index and the dimension </span>
<span class="sd">now becomes 2 :</span>

<span class="sd">```python</span>
<span class="sd">In [42]: il.to_xarray(fillvalue=math.nan)</span>
<span class="sd">Out[42]: </span>
<span class="sd">&lt;xarray.DataArray &#39;Ilist&#39; (full name: 4, course: 3, examen: 3)&gt;</span>
<span class="sd">array([[[nan, 10., 12.],</span>
<span class="sd">        [11., 13., 15.],</span>
<span class="sd">        [nan, nan, nan]],</span>

<span class="sd">       [[ 2.,  4., nan],</span>
<span class="sd">        [nan, nan, nan],</span>
<span class="sd">        [nan, 18., 17.]],</span>

<span class="sd">       [[ 6., nan, nan],</span>
<span class="sd">        [nan, nan, nan],</span>
<span class="sd">        [nan, nan, 18.]],</span>

<span class="sd">       [[nan,  8., nan],</span>
<span class="sd">        [15., nan, nan],</span>
<span class="sd">        [nan, nan, nan]]])</span>
<span class="sd">Coordinates:</span>
<span class="sd">    first name  (full name) &lt;U8 &#39;Anne&#39; &#39;Camille&#39; &#39;Philippe&#39; &#39;Philippe&#39;</span>
<span class="sd">    last name   (full name) &lt;U5 &#39;White&#39; &#39;Red&#39; &#39;Black&#39; &#39;White&#39;</span>
<span class="sd">  * full name   (full name) &lt;U14 &#39;Anne White&#39; &#39;Camille Red&#39; ... &#39;Philippe White&#39;</span>
<span class="sd">    surname     (full name) &lt;U10 &#39;skyler&#39; &#39;saul&#39; &#39;gus&#39; &#39;heisenberg&#39;</span>
<span class="sd">    group       (full name) &lt;U3 &#39;gr1&#39; &#39;gr3&#39; &#39;gr3&#39; &#39;gr2&#39;</span>
<span class="sd">  * course      (course) &lt;U8 &#39;english&#39; &#39;math&#39; &#39;software&#39;</span>
<span class="sd">  * examen      (examen) &lt;U2 &#39;t1&#39; &#39;t2&#39; &#39;t3&#39;</span>

<span class="sd">In [43]: il.to_xarray(dimmax=2, fillvalue=math.nan)</span>
<span class="sd">Out[43]: </span>
<span class="sd">&lt;xarray.DataArray &#39;Ilist&#39; (examen: 3, [&quot;course&quot;, &quot;full name&quot;]: 8)&gt;</span>
<span class="sd">array([[11., 15., nan, nan,  2.,  6., nan, nan],</span>
<span class="sd">       [13., nan, 10.,  8.,  4., nan, 18., nan],</span>
<span class="sd">       [15., nan, 12., nan, nan, nan, 17., 18.]])</span>
<span class="sd">Coordinates:</span>
<span class="sd">    first name               ([&quot;course&quot;, &quot;full name&quot;]) &lt;U8 &#39;Anne&#39; ... &#39;Philippe&#39;</span>
<span class="sd">    last name                ([&quot;course&quot;, &quot;full name&quot;]) &lt;U5 &#39;White&#39; ... &#39;Black&#39;</span>
<span class="sd">    full name                ([&quot;course&quot;, &quot;full name&quot;]) &lt;U14 &#39;Anne White&#39; ... ...</span>
<span class="sd">    surname                  ([&quot;course&quot;, &quot;full name&quot;]) &lt;U10 &#39;skyler&#39; ... &#39;gus&#39;</span>
<span class="sd">    group                    ([&quot;course&quot;, &quot;full name&quot;]) &lt;U3 &#39;gr1&#39; &#39;gr2&#39; ... &#39;gr3&#39;</span>
<span class="sd">    course                   ([&quot;course&quot;, &quot;full name&quot;]) &lt;U8 &#39;math&#39; ... &#39;software&#39;</span>
<span class="sd">  * examen                   (examen) &lt;U2 &#39;t1&#39; &#39;t2&#39; &#39;t3&#39;</span>
<span class="sd">  * [&quot;course&quot;, &quot;full name&quot;]  ([&quot;course&quot;, &quot;full name&quot;]) &lt;U6 &#39;(0, 0)&#39; ... &#39;(2, 3)&#39;</span>
<span class="sd">```</span>

<span class="sd">## Ilist size</span>

<span class="sd">A list of values (e.g. [&#39;Paul&#39;, &#39;John&#39;, &#39;Marie&#39;, &#39;John&#39;]) is represented in an indexed list by :</span>
<span class="sd">    </span>
<span class="sd">- a list of different values (e.g. [&#39;Paul&#39;, &#39;John&#39;, &#39;Marie&#39;])</span>
<span class="sd">- a list of index (e.g. [0, 1, 2, 1])</span>

<span class="sd">This representation is similar to Pandas categorical&#39;s type.</span>

<span class="sd">In term of data volume, there is no duplication (gain) but the index list is added (loss). </span>
<span class="sd">The graph below shows the size difference between simple list and indexed list.</span>

<span class="sd">&lt;img src=&quot;./ilist_size2.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd">If the values are small (e.g. int, float), the indexed list is bigger than simple list.</span>
<span class="sd">If the unicity ratio (number of different values / number of values) is high (&gt; 90%), </span>
<span class="sd">the indexed list is bigger than simple list.</span>
<span class="sd">In the other cases, the indexed list is smaller than a simple list (general case of csv files)</span>

<span class="sd">## aggregation</span>

<span class="sd">One of the properties of Ilist object is to be able to index any type of object and </span>
<span class="sd">in particular Ilist objects. This indexing can be recursive, which makes it possible </span>
<span class="sd">to preserve the integrity of the data.</span>

<span class="sd">A &#39;merge&#39; method transform the Ilist object thus aggregated </span>
<span class="sd">into a flat Ilist object.</span>

<span class="sd">&lt;img src=&quot;./ilist_aggregation.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd">In the example below, an Ilist object is build for each person.</span>
<span class="sd">These Ilist objects are then assembled into a summary object which can be </span>
<span class="sd">disassembled by the function &#39;merge&#39;.</span>

<span class="sd">&lt;img src=&quot;./ilist_merge.png&quot; width=&quot;800&quot;&gt;</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span><span class="p">,</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">cbor2</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">xarray</span>
<span class="c1">#from bson import decode, encode</span>
<span class="kn">import</span> <span class="nn">bson</span>
<span class="kn">from</span> <span class="nn">ESValue</span> <span class="kn">import</span> <span class="n">LocationValue</span><span class="p">,</span> <span class="n">DatationValue</span><span class="p">,</span> <span class="n">PropertyValue</span><span class="p">,</span> <span class="n">ResultValue</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">ESconstante</span> <span class="kn">import</span> <span class="n">ES</span>

<span class="c1">#from time import time</span>

<span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;return the same value as args or kwargs&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span> <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span> <span class="k">return</span> <span class="n">kwargs</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="k">class</span> <span class="nc">IlistEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;add a new json encoder for Ilist&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="p">:</span> <span class="k">return</span> <span class="n">o</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">option</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encoded&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;encode_format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">}</span>
        <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="n">o</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="o">**</span><span class="n">option</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="n">o</span><span class="o">.</span><span class="n">__to_json__</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">CborDecoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONDecoder</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">json</span><span class="o">.</span><span class="n">JSONDecoder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">object_hook</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">codecbor</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">codecbor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dic</span><span class="p">):</span>
        <span class="n">dic2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
            <span class="k">try</span><span class="p">:</span> <span class="n">k2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="n">k2</span> <span class="o">=</span> <span class="n">k</span>
            <span class="n">dic2</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> 
        <span class="k">return</span> <span class="n">dic2</span>

<span class="k">class</span> <span class="nc">Ilist</span><span class="p">:</span>
<span class="c1">#%% intro</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    An `Ilist` is a representation of an indexed list (a list is indexed by others list).</span>
<span class="sd">    E.g. python zip or csv file.</span>

<span class="sd">    *Attributes (for @property see methods)* :</span>

<span class="sd">    - **extval** : list of data to be indexed</span>
<span class="sd">    - **valname** : name of the extval list</span>
<span class="sd">    - **setval** : list of the different extval values (dynamic value)</span>
<span class="sd">    - **ival** : index of the extval (dynamic value)</span>
<span class="sd">    - **extidx** : list of index (dynamic value)</span>
<span class="sd">    - **idxname** : list of the index name</span>
<span class="sd">    - **setidx** : list of the different idxval values</span>
<span class="sd">    - **iidx** : index of the extidx list of values</span>

<span class="sd">    The methods defined in this class are :</span>

<span class="sd">    *constructor (classmethod))*</span>

<span class="sd">    - `Ilist.Iidic`</span>
<span class="sd">    - `Ilist.Iext`</span>
<span class="sd">    - `Ilist.Iidx`</span>
<span class="sd">    - `Ilist.Iset`</span>
<span class="sd">    - `Ilist.Izip`</span>

<span class="sd">    *dynamic value property (getters)*</span>

<span class="sd">    - `Ilist.ival`</span>
<span class="sd">    - `Ilist.setval`</span>
<span class="sd">    - `Ilist.extidx`</span>
<span class="sd">    - `Ilist.tiidx`</span>
<span class="sd">    - `Ilist.textidx`</span>

<span class="sd">    *global property (getters)*</span>

<span class="sd">    - `Ilist.axes`</span>
<span class="sd">    - `Ilist.axesall`</span>
<span class="sd">    - `Ilist.axesmin`</span>
<span class="sd">    - `Ilist.axesmono`</span>
<span class="sd">    - `Ilist.axesmulti`</span>
<span class="sd">    - `Ilist.complete`</span>
<span class="sd">    - `Ilist.completefull`</span>
<span class="sd">    - `Ilist.consistent`</span>
<span class="sd">    - `Ilist.dimension`</span>
<span class="sd">    - `Ilist.lencomplete`</span>
<span class="sd">    - `Ilist.lencompletefull`</span>
<span class="sd">    - `Ilist.rate`</span>
<span class="sd">    - `Ilist.setvallen`</span>
<span class="sd">    - `Ilist.zip`</span>

<span class="sd">    *idx property (getters)*</span>

<span class="sd">    - `Ilist.dicidxref`</span>
<span class="sd">    - `Ilist.idxcoupled`</span>
<span class="sd">    - `Ilist.idxderived`</span>
<span class="sd">    - `Ilist.idxder`</span>
<span class="sd">    - `Ilist.idxlen`</span>
<span class="sd">    - `Ilist.idxref`</span>
<span class="sd">    - `Ilist.idxunique`</span>
<span class="sd">    - `Ilist.ind`</span>
<span class="sd">    - `Ilist.lenidx`</span>
<span class="sd">    - `Ilist.minMaxIndex`</span>

<span class="sd">    *add - update methods*</span>

<span class="sd">    - `Ilist.addextidx`</span>
<span class="sd">    - `Ilist.addlistidx`</span>
<span class="sd">    - `Ilist.append`</span>
<span class="sd">    - `Ilist.appendi`</span>
<span class="sd">    - `Ilist.updateidx`</span>
<span class="sd">    - `Ilist.updatelist`</span>

<span class="sd">    *selecting methods*</span>

<span class="sd">    - `Ilist.extidxtoi`</span>
<span class="sd">    - `Ilist.iidxtoext`</span>
<span class="sd">    - `Ilist.iloc`</span>
<span class="sd">    - `Ilist.iseIndex`</span>
<span class="sd">    - `Ilist.isiIndex`</span>
<span class="sd">    - `Ilist.isValue`</span>
<span class="sd">    - `Ilist.loc`</span>
<span class="sd">    - `Ilist.setname`</span>
<span class="sd">    - `Ilist.unconsistent`</span>

<span class="sd">    *management - conversion methods*</span>

<span class="sd">    - `Ilist.axescoupling`</span>
<span class="sd">    - `Ilist.couplingmatrix`</span>
<span class="sd">    - `Ilist.derived_to_coupled`</span>
<span class="sd">    - `Ilist.full`</span>
<span class="sd">    - `Ilist.merge`</span>
<span class="sd">    - `Ilist.mergeidx`</span>
<span class="sd">    - `Ilist.reindex`</span>
<span class="sd">    - `Ilist.reorder`</span>
<span class="sd">    - `Ilist.setfilter`</span>
<span class="sd">    - `Ilist.sort`</span>
<span class="sd">    - `Ilist.sortidx`</span>
<span class="sd">    - `Ilist.swapindex`</span>

<span class="sd">    *exports methods*</span>

<span class="sd">    - `Ilist.from_obj` (classmethod)</span>
<span class="sd">    - `Ilist.from_csv` (classmethod)</span>
<span class="sd">    - `Ilist.from_file` (classmethod)</span>
<span class="sd">    - `Ilist.json`</span>
<span class="sd">    - `Ilist.to_obj`</span>
<span class="sd">    - `Ilist.to_csv`</span>
<span class="sd">    - `Ilist.to_file`</span>
<span class="sd">    - `Ilist.to_numpy`</span>
<span class="sd">    - `Ilist.to_xarray`</span>
<span class="sd">    - `Ilist.vlist`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="s1">&#39;extval&#39;</span><span class="p">,</span> <span class="s1">&#39;iidx&#39;</span><span class="p">,</span> <span class="s1">&#39;setidx&#39;</span><span class="p">,</span> <span class="s1">&#39;valname&#39;</span><span class="p">,</span> <span class="s1">&#39;idxname&#39;</span>
    <span class="n">_c1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;\d+\.?\d*[,\-_ ;:]&#39;</span><span class="p">)</span>
    <span class="n">_c2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[,\-_ ;:]\d+\.?\d*&#39;</span><span class="p">)</span>

<span class="c1">#%% constructor</span>
    <span class="nd">@classmethod</span>     <span class="c1"># !!! class methods</span>
    <span class="k">def</span> <span class="nf">Iidic</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dictvaliidx</span><span class="p">,</span> <span class="n">dictsetidx</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">idxref</span><span class="o">=</span><span class="p">[],</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (dictionnary data).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **dictvaliidx** :  {valname : valiidx} with valiidx=list(list(val, indexval))</span>
<span class="sd">        - **dictsetidx** :  {idxname0 : setidx0, ... , idxnamen : setidxn}</span>
<span class="sd">        - **order** : list (default []) of axes used if there is no indexval in valiidx</span>
<span class="sd">        - **idxref** : list (default []) of reference axes used if there is no indexval</span>
<span class="sd">        in valiidx</span>
<span class="sd">        - **defaultidx** : boolean (default True). If True, a generic index is generated</span>
<span class="sd">        if no index is defined</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_initdict</span><span class="p">(</span><span class="n">dictvaliidx</span><span class="p">,</span> <span class="n">dictsetidx</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">idxref</span><span class="p">),</span> <span class="n">defaultidx</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Iset</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">valiidx</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">idxref</span><span class="o">=</span><span class="p">[],</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span>
             <span class="n">idxname</span><span class="o">=</span><span class="p">[],</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (list data with indexed values ).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **valiidx** :  coupled val / index list : list(list(val, indexval))</span>
<span class="sd">        - **setidx** :  external different values of index (see data model)</span>
<span class="sd">        - **order** : list (default []) of axes used if there is no indexval in valiidx</span>
<span class="sd">        - **idxref** : list (default []) of reference axes used if there is no indexval in valiidx</span>
<span class="sd">        - **valname** : string (default &#39;value&#39;) name of indexed list (see data model)</span>
<span class="sd">        - **idxname** : list of string (default []) name of index list (see data model)</span>
<span class="sd">        - **defaultidx** : boolean (default True). If True, a generic index is generated</span>
<span class="sd">        if no index is defined</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">valiidx</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="p">:</span> <span class="n">validx</span> <span class="o">=</span> <span class="p">[</span><span class="n">valiidx</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">validx</span> <span class="o">=</span> <span class="n">valiidx</span>
        <span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">iidx</span><span class="p">)</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_initset</span><span class="p">(</span><span class="n">validx</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">idxref</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Iidx</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">extval</span><span class="p">,</span> <span class="n">idxlen</span><span class="p">,</span> <span class="n">idxref</span><span class="o">=</span><span class="p">[],</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">idxname</span><span class="o">=</span><span class="p">[],</span>
             <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (automatic index).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : indexed list (see data model)</span>
<span class="sd">        - **idxlen** : integer - number of index</span>
<span class="sd">        - **idxref** : list (default []) of reference axes used</span>
<span class="sd">        - **order** : list (default []) of axes used to order the index</span>
<span class="sd">        - **valname** : string (default &#39;value&#39;) name of indexed list (see data model)</span>
<span class="sd">        - **idxname** : list of string (default []) name of index list (see data model)</span>
<span class="sd">        - **defaultidx** : boolean (default True). If True, a generic index</span>
<span class="sd">        is generated if no index is defined</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="n">iidx</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_initiidx</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">),</span> <span class="n">idxlen</span><span class="p">,</span> <span class="n">idxref</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="p">[],</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Iedic</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dicval</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:[]},</span> <span class="n">dicidx</span><span class="o">=</span><span class="p">{},</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (external dictionnary).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **dicval** : {valname : extval}  (see data model)</span>
<span class="sd">        - **dicidx** : {idxname[0] : extidx[0], ... , idxname[n] : extidx[n]} (see data model)</span>
<span class="sd">        - **defaultidx** : boolean (default True). If True, a generic index</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        is generated if no index is defined</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="n">valname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dicval</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">extval</span> <span class="o">=</span> <span class="n">dicval</span><span class="p">[</span><span class="n">valname</span><span class="p">]</span>
        <span class="n">idxname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dicidx</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">extidx</span> <span class="o">=</span> <span class="p">[</span><span class="n">dicidx</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">idxname</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">Iext</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">extidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Iext</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">extval</span><span class="o">=</span><span class="p">[],</span> <span class="n">extidx</span><span class="o">=</span><span class="p">[],</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">idxname</span><span class="o">=</span><span class="p">[],</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (external index).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : indexed list (see data model)</span>
<span class="sd">        - **extidx** : index list (see data model)</span>
<span class="sd">        - **valname** : string (default &#39;value&#39;) name of indexed list (see data model)</span>
<span class="sd">        - **idxname** : list of string (default []) name of index list (see data model)</span>
<span class="sd">        - **defaultidx** : boolean (default True). If True, a generic index</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        is generated if no index is defined</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">extidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">defaultidx</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">extidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">or</span> <span class="n">extidx</span> <span class="o">==</span> <span class="p">[])</span> <span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">)))]</span>
            <span class="n">idxname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;default index&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">extidx</span> <span class="o">!=</span> <span class="p">[]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">extidx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="n">ext</span> <span class="o">=</span> <span class="p">[</span><span class="n">extidx</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>                                          <span class="n">ext</span> <span class="o">=</span> <span class="n">extidx</span>
        <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Izip</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (external index only).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **args** : index list extidx=list(args) (see data model)</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">Iext</span><span class="p">(</span><span class="n">extval</span><span class="o">=</span><span class="p">[],</span> <span class="n">extidx</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">idxname</span><span class="o">=</span><span class="p">[],</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extval</span><span class="o">=</span><span class="p">[],</span> <span class="n">setidx</span><span class="o">=</span><span class="p">[],</span> <span class="n">iidx</span><span class="o">=</span><span class="p">[],</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">idxname</span><span class="o">=</span><span class="p">[],</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : list (default []) - indexed list (see data model)</span>
<span class="sd">        - **setidx** :  list (default []) - external different values of index (see data model)</span>
<span class="sd">        - **iidx** :  list (default [])  - integer value of index (see data model)</span>
<span class="sd">        - **valname** : string (default &#39;value&#39;) - name of indexed list (see data model)</span>
<span class="sd">        - **idxname** : list of string (default []) - name of index list (see data model)</span>
<span class="sd">        - **defaultidx** : boolean (default True) - If True, a generic index</span>
<span class="sd">        is generated if no index is defined</span>

<span class="sd">        *Returns* : None&#39;&#39;&#39;</span>
        <span class="k">if</span>   <span class="nb">type</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span>  <span class="o">!=</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">iidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span>   <span class="n">defaultidx</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">iidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">or</span> <span class="n">iidx</span> <span class="o">==</span> <span class="p">[])</span> <span class="p">:</span>
            <span class="n">iindex</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">)))]</span>
            <span class="k">if</span> <span class="n">idxname</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span>                      <span class="n">idxname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;default index&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">iidx</span> <span class="o">!=</span> <span class="p">[]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">iidx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="n">iindex</span> <span class="o">=</span> <span class="p">[</span><span class="n">iidx</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>                                      <span class="n">iindex</span> <span class="o">=</span> <span class="n">iidx</span>
        <span class="k">if</span>   <span class="nb">type</span><span class="p">(</span><span class="n">setidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">or</span> <span class="n">setidx</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span> <span class="n">setindex</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">iindex</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">setidx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span>              <span class="n">setindex</span> <span class="o">=</span> <span class="p">[</span><span class="n">setidx</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>                                      <span class="n">setindex</span> <span class="o">=</span>  <span class="n">setidx</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span>                   <span class="p">:</span> <span class="n">extvalue</span> <span class="o">=</span> <span class="p">[</span><span class="n">extval</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">extval</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">and</span> <span class="n">iindex</span> <span class="o">==</span> <span class="p">[]</span>        <span class="p">:</span> <span class="n">extvalue</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="n">extval</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">iindex</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                                                    <span class="n">extvalue</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">iindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                                                    <span class="n">valname</span> <span class="o">=</span> <span class="s1">&#39;default value&#39;</span>
        <span class="k">else</span> <span class="p">:</span>                                      <span class="n">extvalue</span> <span class="o">=</span> <span class="n">extval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extval</span>  <span class="o">=</span> <span class="n">extvalue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>    <span class="o">=</span> <span class="n">iindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span>  <span class="o">=</span> <span class="n">setindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valname</span> <span class="o">=</span> <span class="n">valname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;idx&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iindex</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">setindex</span><span class="p">)))]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">idxname</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">))</span> <span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_initdict</span><span class="p">(</span><span class="n">dictvaliidx</span><span class="p">,</span> <span class="n">dictsetidx</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">idxref</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&#39;&#39;&#39; generate extval, setidx, iidx, valname and idxname&#39;&#39;&#39;</span>
        <span class="n">valname</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>
        <span class="n">validx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dictvaliidx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span>
            <span class="n">valname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dictvaliidx</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">validx</span> <span class="o">=</span> <span class="n">dictvaliidx</span><span class="p">[</span><span class="n">valname</span><span class="p">]</span>
        <span class="n">setidx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">idxname</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">dictsetidx</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="p">:</span> <span class="n">vl</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span> <span class="p">:</span> <span class="n">vl</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span>
            <span class="n">idxname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">setidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>
        <span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">iidx</span><span class="p">)</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_initset</span><span class="p">(</span><span class="n">validx</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">idxref</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_initiidx</span><span class="p">(</span><span class="n">vallen</span><span class="p">,</span> <span class="n">idxlen</span><span class="p">,</span> <span class="n">idxref</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; generate a generic iidx&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">vallen</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">idxlen</span> <span class="o">==</span> <span class="p">[]:</span> <span class="k">return</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">idxlen</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span>          <span class="k">return</span> <span class="p">[</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span> <span class="p">]</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">idxlen</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>           <span class="k">return</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">idxref</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">and</span> <span class="n">defaultidx</span> <span class="p">:</span> <span class="n">ref</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxlen</span><span class="p">)))</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">ref</span> <span class="o">=</span> <span class="n">idxref</span>
        <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span> <span class="n">orde</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxlen</span><span class="p">)))</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">orde</span> <span class="o">=</span> <span class="n">order</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">idxlen</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ref</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;idxref and idxlen should have the same lenght&quot;</span><span class="p">)</span>
        <span class="n">idxcoupled</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxlen</span><span class="p">))</span> <span class="k">if</span> <span class="n">ref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">axes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span>
        <span class="n">axesord</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">orde</span> <span class="p">:</span>
            <span class="n">iref</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">iref</span> <span class="ow">in</span> <span class="n">axes</span> <span class="ow">and</span> <span class="n">iref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axesord</span> <span class="p">:</span> <span class="n">axesord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iref</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axes</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axesord</span> <span class="p">:</span> <span class="n">axesord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">iiord</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">idxlen</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axesord</span><span class="p">]</span>
        <span class="n">iidxord</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">iiord</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">vallen</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">iidxord</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;val lenght is not consistent with index lenght&quot;</span><span class="p">)</span>
        <span class="n">iidx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iidxord</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axes</span> <span class="p">:</span> <span class="n">iidx</span><span class="p">[</span><span class="n">axes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">iidxord</span><span class="p">[</span><span class="n">axesord</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxcoupled</span> <span class="p">:</span>
            <span class="n">iidx</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iidx</span><span class="p">[</span><span class="n">ref</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">iidx</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_initset</span><span class="p">(</span><span class="n">validx</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">idxref</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; generate extval and iidx &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">validx</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span>
            <span class="n">extval</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">iidx</span>   <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">setidx</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">validx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span>
            <span class="n">extval</span> <span class="o">=</span> <span class="n">validx</span>
            <span class="n">idxlen</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">setidx</span><span class="p">]</span>
            <span class="n">iidx</span>   <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_initiidx</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">),</span> <span class="n">idxlen</span><span class="p">,</span> <span class="n">idxref</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">tvalidx</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="n">validx</span><span class="p">)</span>
            <span class="n">extval</span>  <span class="o">=</span> <span class="n">tvalidx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">iidx</span>    <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="n">tvalidx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">iidx</span><span class="p">)</span>

<span class="c1">#%% special</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return ival and iidx&#39;&#39;&#39;</span>
        <span class="n">texLis</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="p">:</span> <span class="n">texLis</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ival</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">texLis</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return valname, extval, idxname and extidx&#39;&#39;&#39;</span>
        <span class="n">texLis</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">option</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encoded&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;encode_format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">nam</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">texLis</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">nam</span> <span class="o">+</span> <span class="s1">&#39; : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="o">**</span><span class="n">option</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">valname</span> <span class="o">+</span> <span class="s1">&#39; : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="o">**</span><span class="n">option</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">texLis</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; equal if extval and extidx are equal&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">extval</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">extidx</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; len of extval&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; item of extval&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return extval item&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; modify extval item&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">ind</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ind</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;out of bounds&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add other&#39;s values to self&#39;s values in a new Ilist&#39;&#39;&#39;</span>
        <span class="n">newilist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>
        <span class="n">newilist</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newilist</span>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add other&#39;s values to self&#39;s values&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">iadd</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add other&#39;s index to self&#39;s index in a new Ilist&#39;&#39;&#39;</span>
        <span class="n">newilist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>
        <span class="n">newilist</span><span class="o">.</span><span class="fm">__ior__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newilist</span>

    <span class="k">def</span> <span class="fm">__ior__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add other&#39;s index to self&#39;s index&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;the sizes are not equal&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">lenidx</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addlistidx</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">other</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">other</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Copy all the data (deepcopy)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="c1">#%% property</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>             <span class="c1">#!!!!trop long, à clarifier</span>
        <span class="sd">&#39;&#39;&#39; return the list of independant axes (not coupled and not unique)&#39;&#39;&#39;</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span>
        <span class="n">idxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxref</span>
        <span class="n">idxcoupled</span> <span class="o">=</span> <span class="p">[</span><span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>  <span class="c1"># temps de réponse</span>
        <span class="c1">#idxcoupled = self.idxcoupled</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
                                <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">y</span><span class="p">)</span> <span class="k">else</span> <span class="n">z</span><span class="p">,</span>
                                <span class="n">idxlen</span><span class="p">,</span> <span class="n">idxcoupled</span><span class="p">,</span> <span class="n">idxref</span><span class="p">)))))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">axes</span> <span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">axes</span>
        <span class="c1">#return self.axesmin</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axesall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return the list of all axes &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">))</span>

    <span class="sd">&quot;&quot;&quot;@property</span>
<span class="sd">    def axeslen(self):</span>
<span class="sd">        &#39;&#39;&#39; return the list of axes lenght &#39;&#39;&#39;</span>
<span class="sd">        idxlen = self.idxlen</span>
<span class="sd">        return [idxlen[axe] for axe in self.axes]&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axesmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return the list of independant axes (not coupled, not derived and not unique)&#39;&#39;&#39;</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">idxcoupled</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxcoupled</span>
        <span class="n">idxunique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxunique</span>
        <span class="n">idxderived</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxderived</span>
        <span class="n">lenidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">idxcoupled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">idxunique</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">idxderived</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lenidx</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">axes</span> <span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">axes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axesmono</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return the list of axes with one value &#39;&#39;&#39;</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxlen</span><span class="p">))</span> <span class="k">if</span> <span class="n">idxlen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axesmulti</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return the list of axes with more than one value &#39;&#39;&#39;</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxlen</span><span class="p">))</span> <span class="k">if</span> <span class="n">idxlen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a boolean (True if Ilist is complete and consistent)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lencomplete</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">consistent</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">completefull</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a boolean (True if Ilist is full complete and consistent)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lencompletefull</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">consistent</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">consistent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a boolean (True if Ilist is consistent : only one extval</span>
<span class="sd">        for one list of index values&#39;&#39;&#39;</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tuple</span><span class="p">(</span><span class="n">tiidx</span><span class="p">)))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">dicidxref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a dict with pair of coupled index (index name)&#39;&#39;&#39;</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span>
        <span class="n">idxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxref</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxref</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">idxlen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">dic</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return an integer : the number of index non coupled and non unique&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">extidx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return extidx (see data model)&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="p">[</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">]))]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">))]</span>

    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">idicidxref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a dict with pair of coupled index (index row)&#39;&#39;&#39;</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span>
        <span class="n">idxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxref</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxref</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">idxlen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dic</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">idxcoupled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a list of boolean for each index (True if coupled)&#39;&#39;&#39;</span>
        <span class="n">idxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxref</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>
 
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">idxder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the list of derived index&#39;&#39;&#39;</span>
        <span class="n">lenidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_derived</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                    <span class="n">lis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
                    <span class="k">break</span>
        <span class="k">while</span> <span class="n">lis</span> <span class="o">!=</span> <span class="p">[</span><span class="n">lis</span><span class="p">[</span><span class="n">lis</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)]</span> <span class="p">:</span>
            <span class="n">lis</span> <span class="o">=</span> <span class="p">[</span><span class="n">lis</span><span class="p">[</span><span class="n">lis</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">lis</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">idxderived</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a list of boolean for each index (True if derived)&#39;&#39;&#39;</span>
        <span class="n">idxder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxder</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">idxder</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">idxlen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return the list of setidx lenght &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">seti</span><span class="p">)</span> <span class="k">for</span> <span class="n">seti</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">idxref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the list of reference index&#39;&#39;&#39;</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coupled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                    <span class="n">lis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="n">lis</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">idxunique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a list of boolean for each index (True if unique)&#39;&#39;&#39;</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span>
        <span class="k">return</span> <span class="p">[</span> <span class="n">idl</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">idl</span> <span class="ow">in</span> <span class="n">idxlen</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the textidx (see data model)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ival</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the ival (see data model)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setval</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lencomplete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return an integer : number of values if complete (prod(idxlen,not coupled))&#39;&#39;&#39;</span>
        <span class="n">idxcoupled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxcoupled</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mul</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="nb">max</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">idxcoupled</span><span class="p">,</span> <span class="n">idxlen</span><span class="p">)))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lencompletefull</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return an integer : number of values if full complete (prod(idxlen,not coupled, not derived))&#39;&#39;&#39;</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span>    
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mul</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lenidx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return an integer : number of index&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">minMaxIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return a list : [ minimal value of index, maximal value of index]&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">maxInd</span> <span class="o">=</span> <span class="n">minInd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">:</span>
                <span class="n">minInd</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minInd</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
                <span class="n">maxInd</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxInd</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minInd</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">maxInd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">minInd</span><span class="p">,</span> <span class="n">maxInd</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the float ratio : len / lencompletefull&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">lencompletefull</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">setval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the setval (see data model)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">setvallen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return the integer lenght of setval (see data model)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setval</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">textidx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the textidx (see data model)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tiidx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the tiidx (see data model)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a zip format for textidx : tuple(tuple(idx)&#39;&#39;&#39;</span>
        <span class="n">textidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textidx</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">textidx</span><span class="p">)</span>

<span class="c1">#%% methods</span>
    <span class="k">def</span> <span class="nf">addextidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">extidx</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add a new index with name = idxname and extidx.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **idxname** : string - name of index list (see data model)</span>
<span class="sd">        - **extidx** : list - new index list (see data model)</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addlistidx</span><span class="p">(</span><span class="n">idxname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">extidx</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toint</span><span class="p">(</span><span class="n">extidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">extidx</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">addlistidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add a new index with name = idxname and setidx / iidx.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **idxname** : string - name of index list (see data model)</span>
<span class="sd">        - **setidx** :  list - external different values of index (see data model)</span>
<span class="sd">        - **iidx** :  list - integer value of index (see data model)</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">iidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">iidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;listindex out of bounds&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">setidx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="o">=</span> <span class="n">iidx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">idxname</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span> <span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">setidx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>   <span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iidx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idxname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extval</span><span class="p">,</span> <span class="n">extind</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add a new value extval with index extind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : new object value</span>
<span class="sd">        - **extind** :  list - new index values to add to extidx</span>
<span class="sd">        - **unique** :  boolean (default False) - If True and extidx present</span>
<span class="sd">        - **fast** : boolean (default False) - Update whithout reindex</span>
<span class="sd">        in textidx append is refuse.</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iseIndex</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">unique</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">isValue</span><span class="p">(</span><span class="n">extval</span><span class="p">)):</span> <span class="k">return</span>
        <span class="k">if</span> <span class="n">fast</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span>
            <span class="n">iind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateset</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">iind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">)</span> <span class="p">:</span> <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="n">tiidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_updateset</span><span class="p">(</span><span class="n">extind</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="n">tiidx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">appendi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extval</span><span class="p">,</span> <span class="n">intind</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add a new value extval with index intind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : new object value</span>
<span class="sd">        - **intind** :  list - new index values to add to iidx</span>
<span class="sd">        - **unique** :  boolean (default False) - If True and intind present</span>
<span class="sd">        in tiidx append is refuse.</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isiIndex</span><span class="p">(</span><span class="n">intind</span><span class="p">)</span> <span class="ow">and</span> <span class="n">unique</span><span class="p">)</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isValue</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isiIndex</span><span class="p">(</span><span class="n">intind</span><span class="p">)):</span> <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="n">tiidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="n">tiidx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">axescoupling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return the list of independant axes (not coupled, not derived and not unique)</span>
<span class="sd">        with coupling order (most coupling first)</span>
<span class="sd">        </span>
<span class="sd">        *Parameters*</span>

<span class="sd">        - **axes** : list of int (default None) - list of axes </span>

<span class="sd">        *Returns* : list  &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span><span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="n">axes</span>
        <span class="n">axe</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span> <span class="k">if</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span><span class="p">]</span>
        <span class="n">order</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">couplingmatrix</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axe</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">axe</span><span class="p">,</span> <span class="n">axe</span><span class="p">]</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  
            <span class="n">order</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
            <span class="n">axe</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">order</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">axe</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">order</span>
    
    <span class="k">def</span> <span class="nf">couplingmatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a matrix ratio with coupling ratio between each axes.</span>
<span class="sd">        The matrix is return or stored in a file (csv format).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **file** : string (default None) - name of the file. If None, the array </span>
<span class="sd">        is returned.</span>

<span class="sd">        *Returns* : array or None&#39;&#39;&#39;</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">_couplinginfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">j</span><span class="p">])[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span> 
             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="p">:</span> <span class="k">return</span> <span class="n">mat</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">):</span> <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
           
    <span class="k">def</span> <span class="nf">derived_to_coupled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idxder</span><span class="p">,</span> <span class="n">idxref</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Transform a derived index in a coupled index (new setidx).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **idxder** : number of the derived index.</span>
<span class="sd">        - **idxref** : number of the index to be coupled.</span>

<span class="sd">        *Returns* : None&#39;&#39;&#39;</span>
        <span class="n">dic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_idxlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idxref</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idxder</span><span class="p">],</span> <span class="n">coupled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">derived</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dic</span><span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;idx is not derived from the other&quot;</span><span class="p">)</span>
        <span class="n">setidx</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">idxder</span><span class="p">][</span><span class="n">dic</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span><span class="p">[</span><span class="n">idxref</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">idxder</span><span class="p">]</span> <span class="o">=</span> <span class="n">setidx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idxder</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idxref</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">extidxtoi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        convert an extind (value for each extidx) to an intind (value for each iidx).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extind** : value for each extidx</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **list** : intind, value for each iidx&#39;&#39;&#39;</span>
        <span class="k">try</span> <span class="p">:</span>  <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">extind</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extind</span><span class="p">))]</span>
        <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_obj</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate an Ilist Object from a bytes, json or dict value</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **bs** : bytes or string data to convert</span>

<span class="sd">        *Returns* : Ilist &#39;&#39;&#39;</span>
        <span class="n">setidx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">extval</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">bs</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x00</span> <span class="ow">and</span> <span class="p">(</span><span class="n">bs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mb">0b11100000</span><span class="p">)</span><span class="o">==</span> <span class="mb">0b10100000</span><span class="p">:</span>
                <span class="n">dic2</span> <span class="o">=</span> <span class="n">cbor2</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">dic2</span> <span class="o">=</span> <span class="n">bson</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="p">:</span> <span class="n">dic2</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">object_hook</span><span class="o">=</span><span class="n">CborDecoder</span><span class="p">()</span><span class="o">.</span><span class="n">codecbor</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="n">dic2</span> <span class="o">=</span> <span class="n">bs</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;the type of parameter is not available&quot;</span><span class="p">)</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">dic2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ES</span><span class="o">.</span><span class="n">invcodeb</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="n">ES</span><span class="o">.</span><span class="n">invcodeb</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">if</span> <span class="s1">&#39;_id&#39;</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span> <span class="n">dic</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;order&#39;</span> <span class="ow">in</span> <span class="n">dic</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> 
            <span class="n">idxname</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span>
            <span class="n">setidx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">idxname</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">setidx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s1">&#39;idxref&#39;</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span> <span class="n">idxref</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;idxref&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">idxref</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">valname</span> <span class="o">=</span> <span class="s1">&#39;default value&#39;</span>
        <span class="k">for</span> <span class="n">elmt</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>    
            <span class="k">if</span> <span class="n">elmt</span> <span class="ow">in</span> <span class="n">idxname</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="n">elmt</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span> 
                <span class="n">setidx</span><span class="p">[</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elmt</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="n">elmt</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">elmt</span> <span class="ow">in</span> <span class="n">idxname</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="n">elmt</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span> 
                <span class="n">setidx</span><span class="p">[</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elmt</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="n">elmt</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="n">elmt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;idxref&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">]:</span> 
                <span class="n">valname</span> <span class="o">=</span> <span class="n">elmt</span>
                <span class="n">extval</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="n">elmt</span><span class="p">]</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">setid</span><span class="p">)</span> <span class="k">for</span> <span class="n">setid</span> <span class="ow">in</span> <span class="n">setidx</span><span class="p">]</span>  
        <span class="n">axesmulti</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxlen</span><span class="p">))</span> <span class="k">if</span> <span class="n">idxlen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;index&#39;</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>
            <span class="sd">&#39;&#39;&#39;if isinstance(dic[&#39;index&#39;], list): iidx = dic[&#39;index&#39;]</span>
<span class="sd">            else: iidx = np.frombuffer(dic[&#39;index&#39;], dtype=&#39;u2&#39;) \</span>
<span class="sd">                         .reshape((len(idxname),len(extval))).tolist()&#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span> <span class="n">iidxmulti</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">iidxmulti</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;u2&#39;</span><span class="p">)</span> \
                         <span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">axesmulti</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">)))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">lismono</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">))]</span>
            <span class="n">iidx</span> <span class="o">=</span> <span class="p">[</span><span class="n">iidxmulti</span><span class="p">[</span><span class="n">axesmulti</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axesmulti</span> \
                    <span class="k">else</span> <span class="n">lismono</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">))]</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iidxref</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">idxref</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">:</span>
                <span class="n">keyn</span> <span class="o">=</span> <span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">valn</span> <span class="o">=</span> <span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="n">iidxref</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">keyn</span><span class="p">,</span> <span class="n">valn</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">keyn</span><span class="p">,</span> <span class="n">valn</span><span class="p">)</span>
            <span class="n">iidx</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_initiidx</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">),</span> <span class="n">idxlen</span><span class="p">,</span> <span class="n">iidxref</span><span class="p">,</span> 
                                 <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">))),</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot;@classmethod</span>
<span class="sd">    def from_bytes(cls, bs):</span>
<span class="sd">        &#39;&#39;&#39;</span>
<span class="sd">        Generate an Ilist Object from a bytes value</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **bson** : bytes data to convert</span>

<span class="sd">        *Returns* : Ilist &#39;&#39;&#39;</span>
<span class="sd">        setidx = []</span>
<span class="sd">        if isinstance(bs, bytes) : dic = bson.decode(bs)</span>
<span class="sd">        else : dic = bs</span>
<span class="sd">        if &#39;_id&#39; in dic : dic.pop(&#39;_id&#39;)</span>
<span class="sd">        names = list(dic)</span>
<span class="sd">        valname = names[0]</span>
<span class="sd">        idxname = names[2:len(dic)]</span>
<span class="sd">        extval = Ilist._frombytes(dic[names[0]])</span>
<span class="sd">        for name in idxname : setidx.append(Ilist._frombytes(dic[name]))</span>
<span class="sd">        if isinstance(dic[names[1]], list): iidx = dic[names[1]]</span>
<span class="sd">        else: iidx = np.frombuffer(dic[names[1]], dtype=&#39;u2&#39;).reshape((len(idxname), len(extval))).tolist()</span>
<span class="sd">        return cls(extval, setidx, iidx, valname, idxname)&quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_csv</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;ilist.csv&#39;</span><span class="p">,</span> <span class="n">valfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (from a csv file). Each column represents extidx or extval values.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **filename** : string (default &#39;ilist.csv&#39;), name of the file to read</span>
<span class="sd">        - **valfirst** : boolean (default False). If False extval is the last columns</span>
<span class="sd">        else it&#39;s the first</span>
<span class="sd">        - **header** : boolean (default True). If True, the first raw is dedicated to names</span>
<span class="sd">        - **dtype** : list of string (default None) - data type for each column (default str) : str, int, float, datetime, coord</span>
<span class="sd">        - **kwargs** : see csv.reader options</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="n">extval</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">extidx</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span>
        <span class="n">idxname</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dtype</span> <span class="p">:</span> <span class="n">dtype</span> <span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">first</span><span class="o">=</span><span class="kc">True</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">first</span> <span class="p">:</span>
                    <span class="k">for</span> <span class="n">vrow</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">:</span> <span class="n">extidx</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="k">if</span> <span class="n">first</span> <span class="ow">and</span> <span class="n">header</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="n">valfirst</span>      <span class="p">:</span>
                        <span class="n">valname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">vrow</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">:</span> <span class="n">idxname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">vrow</span><span class="p">))</span>
                    <span class="k">else</span> <span class="p">:</span>
                        <span class="n">valname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">vrow</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="n">idxname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">vrow</span><span class="p">))</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="n">valfirst</span>      <span class="p">:</span>
                        <span class="n">extval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="n">extidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]))</span>
                    <span class="k">else</span> <span class="p">:</span>
                        <span class="n">extval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]))</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="n">extidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dtype</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]))</span>
                <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">Iext</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">extidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">forcestring</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate `Ilist` object from file storage.</span>

<span class="sd">         *Parameters*</span>

<span class="sd">        - **file** : string - file name (with path)</span>
<span class="sd">        - **forcestring** : boolean (default False) - if True, forces the UTF-8 data format, else the format is calculated</span>

<span class="sd">        *Returns* : Ilist object&#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">btype</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">btype</span><span class="o">==</span><span class="nb">bytes</span><span class="p">(</span><span class="s1">&#39;{&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">forcestring</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">bjson</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">bjson</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_obj</span><span class="p">(</span><span class="n">bjson</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">full</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[],</span> <span class="n">fillvalue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add new extval with new extidx to have a complet Ilist</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **axes** : list (default []) - list of index to be completed. If [], self.axesmin is used.</span>
<span class="sd">        - **fillvalue** : object value used for the new extval</span>
<span class="sd">        - **inplace** : boolean (default True) - if True, new values are added,</span>
<span class="sd">        if False a new Ilist is created.</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **None**, if inplace. Ilist if not inplace&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">consistent</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;unable to generate full Ilist with inconsistent Ilist&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span> <span class="p">:</span> <span class="n">axe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="n">iidxadd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idxfull</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">iidxadd</span> <span class="ow">and</span> <span class="n">inplace</span> <span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">iidxadd</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">inplace</span> <span class="p">:</span> <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">iidxfull</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">idxadd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">,</span> <span class="n">iidxadd</span><span class="p">)</span> <span class="p">:</span> <span class="n">iidxfull</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="n">idxadd</span><span class="p">)</span>
        <span class="n">extvalfull</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">)</span>
        <span class="n">extvalfull</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_nullValue</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">extvalfull</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">fillvalue</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iidxadd</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
        <span class="sd">&#39;&#39;&#39;tiidxfull = self.tiidx</span>
<span class="sd">        extvalfull = copy(self.extval)</span>
<span class="sd">        for ind in self._transpose(self._idxfull(axes=axe)) :</span>
<span class="sd">            if ind not in tiidxfull :</span>
<span class="sd">                tiidxfull.append(ind)</span>
<span class="sd">                extvalfull.append(self._nullValue(type(extvalfull[0]), fillvalue))</span>
<span class="sd">        iidxfull = self._transpose(tiidxfull)&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">inplace</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extval</span> <span class="o">=</span> <span class="n">extvalfull</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>   <span class="o">=</span> <span class="n">iidxfull</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">Ilist</span><span class="p">(</span><span class="n">extvalfull</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">,</span> <span class="n">iidxfull</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">iadd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add other&#39;s values to self&#39;s values</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **other** : Ilist to be copied</span>
<span class="sd">        - **unique** :  boolean (default False) - If True and iidx present in tiidx,</span>
<span class="sd">        append is refuse.</span>

<span class="sd">        *Returns* : None&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">lenidx</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;the index lenght have to be equal&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">val</span><span class="p">,</span><span class="n">extidx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">textidx</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">extidx</span><span class="p">,</span> <span class="n">unique</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;idx&#39;</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;idx&#39;</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;value&#39;</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">valname</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;value&#39;</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valname</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">valname</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">iidxtoext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        convert an intind (value for each iidx) to an extind (value for each extidx).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **intind** : value for each iidx</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **list** : extind, value for each extidx&#39;&#39;&#39;</span>
        <span class="k">try</span> <span class="p">:</span>  <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">intind</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intind</span><span class="p">))]</span>
        <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">iloc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return extval corresponding to intind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **intind** : list - value for each iidx</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **object** : extval value &#39;&#39;&#39;</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="n">ival</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">intind</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s1">&#39;index not found&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">iseIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return True if extind is present in extidx.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extind** : list - value for each extidx</span>

<span class="sd">        *Returns* : boolean - True if found&#39;&#39;&#39;</span>
        <span class="n">intind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidxtoi</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">intind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">intind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">isiIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return True if intind is present in iidx.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **intind** : list - value for each iidx</span>

<span class="sd">        *Returns* : boolean - True if found&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">intind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">intind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">isValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extval</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return True if present in extval.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : value to test</span>

<span class="sd">        *Returns* : boolean - True if found&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">extval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return json dict or string.</span>

<span class="sd">        *Parameters (kwargs)*</span>

<span class="sd">        - **encoded** : boolean (default False) - choice for return format (bynary if True, dict else)</span>
<span class="sd">        - **encode_format** : string (default &#39;json&#39;) - choice for return format (json, bson or cbor)</span>
<span class="sd">        - **json_res_index** : default False - if True add the index to the value</span>
<span class="sd">        - **order** : default [] - list of ordered index</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **codif** : dict (default {}). Numerical value for string in CBOR encoder</span>

<span class="sd">        *Returns* : string or dict&#39;&#39;&#39;</span>

        <span class="c1">#option = kwargs | {&#39;bjson_bson&#39;: False} </span>
        <span class="n">option</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encode_format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;encoded&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;codif&#39;</span> <span class="p">:</span> <span class="p">{}}</span> <span class="o">|</span> <span class="n">kwargs</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_obj</span><span class="p">(</span><span class="o">**</span><span class="n">option</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return extval corresponding to extind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extind** : list - value for each extidx</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **object** : extval value &#39;&#39;&#39;</span>
        <span class="n">intind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidxtoi</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="n">ival</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">intind</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s1">&#39;index not found&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;merge&#39;</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Merge replaces Ilist objects included in extval data into its constituents.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **valname** : str (default &#39;merge&#39;) - name of the new Ilist object</span>
<span class="sd">        - **fillvalue** : object (default None) - value used for the new data </span>
<span class="sd">        (e.g. apply a new index to another Ilist)</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist** : merged Ilist &#39;&#39;&#39;</span>        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Ilist</span><span class="p">):</span> <span class="k">return</span> <span class="kc">None</span>
        <span class="n">idxname</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="o">+</span> <span class="p">[</span><span class="n">nam</span> <span class="k">for</span> <span class="n">il</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span> <span class="k">for</span> <span class="n">nam</span> <span class="ow">in</span> <span class="n">il</span><span class="o">.</span><span class="n">idxname</span><span class="p">])))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="s1">&#39;default index&#39;</span> <span class="ow">in</span> <span class="n">idxname</span><span class="p">:</span> <span class="n">idxname</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;default index&#39;</span><span class="p">)</span>
        <span class="n">extidx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">)))</span>
        <span class="n">extval</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">il</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">extval</span> <span class="o">+=</span> <span class="n">il</span><span class="o">.</span><span class="n">extval</span>
            <span class="k">for</span> <span class="n">nam</span> <span class="ow">in</span> <span class="n">idxname</span><span class="p">:</span>
                <span class="n">extiidx</span> <span class="o">=</span> <span class="n">extidx</span><span class="p">[</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nam</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">nam</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="ow">and</span> <span class="n">nam</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">il</span><span class="o">.</span><span class="n">idxname</span><span class="p">:</span>
                    <span class="n">extiidx</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nam</span><span class="p">)][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">il</span><span class="p">))]</span>                         
                <span class="k">elif</span> <span class="n">nam</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="ow">and</span> <span class="n">nam</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">il</span><span class="o">.</span><span class="n">idxname</span><span class="p">:</span>
                    <span class="n">extiidx</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fillvalue</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">il</span><span class="p">))]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">extiidx</span> <span class="o">+=</span> <span class="n">il</span><span class="o">.</span><span class="n">extidx</span><span class="p">[</span><span class="n">il</span><span class="o">.</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nam</span><span class="p">)]</span>                
        <span class="n">ilm</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">Iext</span><span class="p">(</span><span class="n">valname</span><span class="o">=</span><span class="n">valname</span><span class="p">,</span> <span class="n">extval</span><span class="o">=</span><span class="n">extval</span><span class="p">,</span> <span class="n">idxname</span><span class="o">=</span><span class="n">idxname</span><span class="p">,</span> <span class="n">extidx</span><span class="o">=</span><span class="n">extidx</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ilm</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Ilist</span><span class="p">):</span> 
            <span class="k">return</span> <span class="n">ilm</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">valname</span><span class="o">=</span><span class="n">valname</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">fillvalue</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">ilm</span>

    <span class="k">def</span> <span class="nf">mergeidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listidx</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a new index with tuple built from the indexes in listidx.</span>
<span class="sd">        Append the new index to ilist</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **listidx** : list - list of index row to be merged</span>

<span class="sd">        *Returns* : None&#39;&#39;&#39;</span>   
        <span class="n">name</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">listidx</span><span class="p">])</span>
        <span class="n">extidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">listidx</span><span class="p">])))</span>
        <span class="c1">#extidx = self._mergeidx([self.iidx[i] for i in listidx])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addextidx</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">extidx</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="k">def</span> <span class="nf">reindex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[],</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Define new sorted index.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **index** : list (default [])- list of the index to reindex.</span>
<span class="sd">        If [] all the index are reindexed.</span>

<span class="sd">        *Returns* : None&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span> <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">index</span> <span class="p">:</span>
            <span class="n">oldidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>   <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_reindexidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">oldidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">fast</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="p">[],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Change the order of extval and iidx with a new order define by sort</span>
<span class="sd">        (sort can be a subset of the items list).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **sort** : list (default [])- new record order to apply. If [], no change.</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **inplace** : boolean (default True) - if True, new order is apply to self,</span>
<span class="sd">        if False a new Ilist is created.</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **None**, if inplace. **Ilist** if not inplace&#39;&#39;&#39;</span>
        <span class="n">selfextidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span>
        <span class="n">extval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reorder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">sort</span><span class="p">)</span>
        <span class="n">iidx</span> <span class="o">=</span>  <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_reorder</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">sort</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">]</span>
        <span class="n">extidx</span> <span class="o">=</span>  <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_reorder</span><span class="p">(</span><span class="n">eidx</span><span class="p">,</span> <span class="n">sort</span><span class="p">)</span> <span class="k">for</span> <span class="n">eidx</span> <span class="ow">in</span> <span class="n">selfextidx</span><span class="p">]</span>
        <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="n">extidx</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inplace</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extval</span> <span class="o">=</span> <span class="n">extval</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>   <span class="o">=</span> <span class="n">iidx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span> <span class="o">=</span> <span class="n">setidx</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">Ilist</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        return setidx for the idx define by name</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **name** : str - name of the index in idxname </span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **List** : list if name in idxname, None else&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>
        <span class="k">return</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">setfilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setidxfilt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove values that does not match the indexes filter.</span>
<span class="sd">        The filter is a reduced list of indexes.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **setidxfilt** : list of lists (default None) - new reduced setidx. If None, no change.</span>
<span class="sd">        - **index** : boolean (default True) - indicates if setidxfilt is a list of values (False)</span>
<span class="sd">        or indexes (True).</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **inplace** : boolean (default True) - if True, new setidx is apply to self,</span>
<span class="sd">        if False a new Ilist is created.</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **None**, if inplace. **Ilist** if not inplace&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">setidxfilt</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">setidxfilt</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="p">:</span> <span class="k">return</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="n">lenidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span>
        <span class="k">if</span> <span class="n">index</span> <span class="p">:</span> <span class="n">setidxf</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">setidxfilt</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">setidxf</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">setidxfilt</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="n">sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isinset</span><span class="p">(</span><span class="n">tiidx</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">setidxf</span><span class="p">)]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="n">sort</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="p">[],</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">reindex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; sort : calculate a new list order</span>
<span class="sd">        Change the order of extval and iidx with a new order (order can be a subset of the items list).or a specific sort</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **order** : list (default [])- new order of index to apply. If [], the sort </span>
<span class="sd">        function is applied to extval.</span>
<span class="sd">        - **sort** : list (default [])- new order of resval to apply. If [], the new order</span>
<span class="sd">        is calculated.</span>
<span class="sd">        - **reindex** : boolean (default True) - if True, the index are reindexed.</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **inplace** : boolean (default True) - if True, new order is apply to self,</span>
<span class="sd">        if False a new Ilist is created.</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **None**, if inplace. **Ilist** if not inplace&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sortidx</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">sort</span><span class="p">,</span> <span class="n">reindex</span><span class="p">,</span> <span class="n">fast</span><span class="p">),</span> <span class="n">inplace</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sortidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">sort</span><span class="o">=</span><span class="p">[],</span> <span class="n">reindex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Define a new order to apply to extval and iidx (reorder method).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **order** : list (default [])- new order of index to apply in sort function.</span>
<span class="sd">        If [], the sort function is applied to extval.</span>
<span class="sd">        - **sort** : list (default [])- new order of resval to apply. If [], the new order</span>
<span class="sd">        is calculated.</span>
<span class="sd">        - **reindex** : boolean (default True) - if True, the index are reindexed.</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **list** : sort - new order to apply&#39;&#39;&#39;</span>
        <span class="c1">#if sorted(sort) == sorted(self.extval): return sort</span>
        <span class="k">if</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sort</span><span class="p">])</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">]):</span> <span class="k">return</span> <span class="n">sort</span>
        <span class="n">newsetidx</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">))]</span>
        <span class="n">newiidx</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_reindexidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">newsetidx</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">fast</span><span class="p">)</span>
                   <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">reindex</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="n">newiidx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span> <span class="o">=</span> <span class="n">newsetidx</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="p">:</span> <span class="n">idx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">newiidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">order</span><span class="p">]</span>
        <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">)</span>
        <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))))</span>
        <span class="k">return</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="n">idx</span><span class="p">)))[</span><span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">swapindex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Change the order of the index (iidx, setidx, idxname).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **order** : list - new order of index to apply.</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="c1">#if not isinstance(order, list) or len(order) != self.lenidx :</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;order lenght not correct&quot;</span><span class="p">)</span>
        <span class="n">iidx</span>    <span class="o">=</span> <span class="p">[]</span>
        <span class="n">setidx</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="n">idxname</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order</span> <span class="p">:</span>
            <span class="n">iidx</span><span class="o">.</span><span class="n">append</span>  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>  <span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">setidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">idxname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>   <span class="o">=</span> <span class="n">iidx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span> <span class="o">=</span> <span class="n">setidx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="o">=</span> <span class="n">idxname</span>

    <span class="sd">&quot;&quot;&quot;def to_bytes(self, encoded=True, bin_iidx=True):</span>
<span class="sd">        &#39;&#39;&#39;</span>
<span class="sd">        Generate a bytes Object</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **encoded** : boolean (default True) - if True return bson format, if False return dict.</span>
<span class="sd">        - **bin_iidx** : boolean (default True) - if True iidx is converted to bytes with numpy.tobytes method</span>

<span class="sd">        *Returns* : bytes ou dict &#39;&#39;&#39;</span>
<span class="sd">        dic = {}</span>
<span class="sd">        dic[self.valname] = Ilist._tobytes(self.extval, encoded=False)</span>
<span class="sd">        if bin_iidx:    dic[&#39;iidx&#39;] = np.array(self.iidx,  dtype=&#39;u2&#39;).tobytes()</span>
<span class="sd">        else:           dic[&#39;iidx&#39;] = self.iidx</span>
<span class="sd">        for i, name in enumerate(self.idxname) :</span>
<span class="sd">            dic[name] = Ilist._tobytes(self.setidx[i], encoded=False)</span>
<span class="sd">        if not encoded : return dic</span>
<span class="sd">        return bson.encode(dic)&quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate il file to display `Ilist` data.</span>

<span class="sd">         *Parameters (kwargs)*</span>

<span class="sd">        - **file** : string - file name (with path)</span>
<span class="sd">        - **kwargs** : see &#39;to_obj&#39; parameters</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Integer** : file lenght (bytes)  &#39;&#39;&#39;</span>
        <span class="n">option</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encode_format&#39;</span><span class="p">:</span> <span class="s1">&#39;cbor&#39;</span><span class="p">,</span> <span class="s1">&#39;json_res_index&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span> <span class="o">|</span> <span class="n">kwargs</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;encoded&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_obj</span><span class="p">(</span><span class="o">**</span><span class="n">option</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bson&#39;</span><span class="p">,</span> <span class="s1">&#39;cbor&#39;</span><span class="p">]:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">size</span>

    <span class="k">def</span> <span class="nf">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;ilist.csv&#39;</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ifunc</span><span class="o">=</span><span class="p">[],</span> <span class="n">valfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate a csv file with Ilist data (a column for extval and each extidx)</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **filename** : string (default &#39;ilist.csv&#39;) - name of the file to create</span>
<span class="sd">        - **func** : function (default none) - function to apply to extval before writting csv file</span>
<span class="sd">        - **ifunc** : list of function (default []) - function to apply to extidx</span>
<span class="sd">        before writting csv file</span>
<span class="sd">        - **valfirst** : boolean (default False). If False extval is the last columns,</span>
<span class="sd">         else it&#39;s the first</span>
<span class="sd">        - **order** : list of integer (default []) - ordered list of index in columns</span>
<span class="sd">        - **header** : boolean (default True). If True, the first raw is dedicated to names</span>
<span class="sd">        - **kwargs** : parameter for csv.writer or func</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span> <span class="n">order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONNUMERIC</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">extidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span>
            <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">valfirst</span>      <span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">order</span> <span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">valfirst</span>  <span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">)</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ifunc</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span> <span class="n">funci</span> <span class="o">=</span> <span class="n">func</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span> <span class="p">:</span> <span class="n">funci</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">valfirst</span>      <span class="p">:</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">func</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">order</span> <span class="p">:</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="n">extidx</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">funci</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">valfirst</span>  <span class="p">:</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">func</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">size</span>

    <span class="k">def</span> <span class="nf">to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="s1">&#39;axe&#39;</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Complete the Ilist and generate a Numpy array with the dimension define by ind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **func** : function (default none) - function to apply to extval before export</span>
<span class="sd">        - **ind** : string (default &#39;axe&#39;) - &#39;axe&#39; -&gt; independant axes,</span>
<span class="sd">        &#39;all&#39; -&gt; all axes, &#39;flat&#39; -&gt; one list</span>
<span class="sd">        - **fillvalue** : object (default &#39;?&#39;) - value used for the new extval</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **kwargs** : parameter for func</span>

<span class="sd">        *Returns* : </span>
<span class="sd">            </span>
<span class="sd">        - **np.array** : if ind=&#39;flat</span>
<span class="sd">        - **tuple (np.array, list of index)** : if ind = &#39;axe&#39; or &#39;all&#39;</span>
<span class="sd">        - **none** :  else&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">consistent</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;unable to generate numpy array with inconsistent Ilist&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ind</span> <span class="o">==</span> <span class="s1">&#39;flat&#39;</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tonumpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ind</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]</span>  <span class="p">:</span>
            <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="s1">&#39;axe&#39;</span> <span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span> <span class="c1">#!!!axes</span>
            <span class="k">else</span> <span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">))</span>
            <span class="n">ilf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">fillvalue</span><span class="p">)</span>
            <span class="n">ilf</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tonumpy</span><span class="p">(</span><span class="n">ilf</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">ilf</span><span class="o">.</span><span class="n">idxlen</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">]),</span>
                    <span class="p">[</span><span class="n">ilf</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">])</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">to_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return a formatted object with val (extval or ival) and idx (extidx or iidx or none).</span>
<span class="sd">        Format can be json, bson or cbor</span>
<span class="sd">        object can be string, bytes or dict</span>

<span class="sd">        *Parameters (kwargs)*</span>

<span class="sd">        - **encoded** : boolean (default False) - choice for return format (string/bytes if True, dict else)</span>
<span class="sd">        - **encode_format**  : string (default &#39;json&#39;)- choice for return format (bson, json, cbor)</span>
<span class="sd">        - **json_res_index** : default False - if True add the index to the value</span>
<span class="sd">        - **order** : default [] - list of ordered index</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **codif** : dict (default ES.codeb). Numerical value for string in CBOR encoder</span>

<span class="sd">        *Returns* : string, bytes or dict&#39;&#39;&#39;</span>
        <span class="n">option</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encoded&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;encode_format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span>  <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="p">[],</span>
                  <span class="s1">&#39;json_res_index&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;fast&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;codif&#39;</span><span class="p">:</span> <span class="p">{}}</span> <span class="o">|</span> <span class="n">kwargs</span>
        <span class="n">option2</span> <span class="o">=</span> <span class="n">option</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;encoded&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="n">optidxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">complete</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;json_res_index&#39;</span><span class="p">]</span>
        <span class="n">nulres</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valname</span> <span class="o">==</span> <span class="s1">&#39;default value&#39;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span>
        <span class="c1">#print(&#39;optidxref nulres &#39;, optidxref, nulres)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]:</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">))</span>
        <span class="c1">#if not nulres and (option[&#39;order&#39;] == list(range(self.lenidx)) or optidxref):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nulres</span> <span class="ow">and</span> <span class="n">optidxref</span><span class="p">:</span>
            <span class="n">ils</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">option</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ils</span><span class="o">.</span><span class="n">swapindex</span><span class="p">(</span><span class="n">option</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">ils</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">js</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">js</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;fast&#39;</span><span class="p">]</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ils</span><span class="o">.</span><span class="n">setidx</span><span class="p">)):</span> 
                <span class="k">if</span> <span class="n">ils</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;default index&#39;</span><span class="p">:</span> <span class="n">js</span><span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ils</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="c1">#js[ils.idxname[i]] = ils.setidx[i]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nulres</span><span class="p">:</span> <span class="n">js</span><span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">valname</span><span class="p">]</span> <span class="o">=</span> <span class="n">ils</span><span class="o">.</span><span class="n">extval</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ils</span><span class="o">.</span><span class="n">setidx</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">ils</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;default index&#39;</span><span class="p">:</span> <span class="n">js</span><span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_json</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="o">**</span><span class="n">option2</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">ils</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="c1">#js[ils.idxname[i]] = [self._json(idx, **option2) for idx in ils.setidx[i]]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nulres</span><span class="p">:</span> 
                <span class="n">js</span><span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">valname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_json</span><span class="p">(</span><span class="n">ils</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">**</span><span class="n">option2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ils</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">optidxref</span><span class="p">:</span>
            <span class="n">dicidxref</span> <span class="o">=</span> <span class="n">ils</span><span class="o">.</span><span class="n">dicidxref</span>
            <span class="k">if</span> <span class="n">dicidxref</span> <span class="p">:</span> <span class="n">js</span><span class="p">[</span><span class="s1">&#39;idxref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dicidxref</span>
        <span class="c1">#elif option[&#39;encoded&#39;] and option[&#39;bjson_bson&#39;] and not nulres:</span>
        <span class="k">elif</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;bson&#39;</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encoded&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">nulres</span><span class="p">:</span>
            <span class="n">js</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ils</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ils</span><span class="o">.</span><span class="n">axesmulti</span><span class="p">],</span>  <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;u2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
            <span class="c1">#js[&#39;index&#39;] = np.array(ils.iidx,  dtype=&#39;u2&#39;).tobytes()</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">nulres</span><span class="p">:</span> <span class="n">js</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ils</span><span class="o">.</span><span class="n">axesmulti</span><span class="p">]</span>
        <span class="c1">#elif not nulres: js[&#39;index&#39;] = [ils.iidx[i] if i in ils.axesmulti else [0] for i in ils.axesall]</span>
        <span class="c1">#elif not nulres: js[&#39;index&#39;] = ils.iidx</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;codif&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;bson&#39;</span><span class="p">:</span>
            <span class="n">js2</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">js</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;codif&#39;</span><span class="p">]:</span> <span class="n">js2</span><span class="p">[</span><span class="n">option</span><span class="p">[</span><span class="s1">&#39;codif&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">js2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">js2</span> <span class="o">=</span> <span class="n">js</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encoded&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span> 
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span> <span class="n">js2</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">IlistEncoder</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encoded&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bson&#39;</span><span class="p">:</span> 
            <span class="k">return</span> <span class="n">bson</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">js2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encoded&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;cbor&#39;</span><span class="p">:</span> 
            <span class="k">return</span> <span class="n">cbor2</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">js2</span><span class="p">,</span> <span class="n">datetime_as_timestamp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                               <span class="n">timezone</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">,</span> <span class="n">canonical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">js2</span>

    <span class="k">def</span> <span class="nf">to_xarray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[],</span> <span class="n">dimmax</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                  <span class="n">ifunc</span><span class="o">=</span><span class="p">[],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ilist&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Complete the Ilist and generate a Xarray DataArray with the dimension define by ind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **info** : boolean (default False) - if True, add _dict attributes to attrs Xarray</span>
<span class="sd">        - **axes** : list (default []) - list of index to be completed. If [],</span>
<span class="sd">        self.axes is used.</span>
<span class="sd">        - **dimmax** : int (default -1) - max Xarray dimension (only if axes=[])</span>
<span class="sd">        - **fillvalue** : object (default &#39;?&#39;) - value used for the new extval</span>
<span class="sd">        - **func** : function (default none) - function to apply to extval before export</span>
<span class="sd">        - **ifunc** : list of function (default []) - function to apply to</span>
<span class="sd">        extidx before export</span>
<span class="sd">        - **name** : string (default &#39;Ilist&#39;) - DataArray name</span>
<span class="sd">        - **kwargs** : parameter for func and ifunc</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">consistent</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;Ilist not consistent&quot;</span><span class="p">)</span>
        <span class="n">lenidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span>
        <span class="k">if</span> <span class="n">axes</span><span class="o">==</span><span class="p">[]</span> <span class="p">:</span> 
            <span class="n">axe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span>
            <span class="n">coup</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axe</span><span class="p">)</span> <span class="o">-</span> <span class="n">dimmax</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">coup</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">coup</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">axe</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mergeidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axescoupling</span><span class="p">(</span><span class="n">axe</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">coup</span><span class="p">])</span>
                <span class="n">axe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="n">ilf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axe</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">fillvalue</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swapindex</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)))</span>
        <span class="n">ilf</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">ilf</span><span class="o">.</span><span class="n">_xcoord</span><span class="p">(</span><span class="n">axe</span><span class="p">,</span> <span class="n">ifunc</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="n">ilf</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ilf</span><span class="o">.</span><span class="n">_tonumpy</span><span class="p">(</span><span class="n">ilf</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">ilf</span><span class="o">.</span><span class="n">idxlen</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">info</span> <span class="p">:</span> <span class="k">return</span> <span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">ilf</span><span class="o">.</span><span class="n">_dict</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">unconsistent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return a key/value dict with the number of occurences (value) for each</span>
<span class="sd">        indice-tuple (key) with multi-occurences&#39;&#39;&#39;</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="c1">#act = {tuple(self._indtoext(list(it))) for it in Counter(self._tuple(tiidx)).items() if it[1] &gt;1}</span>
        <span class="k">return</span> <span class="p">{</span><span class="nb">tuple</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_indtoext</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">])))):</span> <span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
                <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tuple</span><span class="p">(</span><span class="n">tiidx</span><span class="p">))</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span><span class="mi">1</span><span class="p">}</span>
        <span class="c1">#return dict(self._list(act))</span>

    <span class="k">def</span> <span class="nf">updateidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indval</span><span class="p">,</span> <span class="n">extind</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update the index of an extval.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **indval** : integer - row of the value in extval</span>
<span class="sd">        - **extind** : list - new value for each extidx</span>
<span class="sd">        - **unique** :  boolean (default False) - If True and extind present in textidx,</span>
<span class="sd">        update is refuse.</span>

<span class="sd">        *Returns* : none&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="ow">or</span> <span class="n">indval</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">indval</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;out of bounds&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iseIndex</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span> <span class="ow">and</span> <span class="n">unique</span> <span class="p">:</span> <span class="k">return</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="n">tiidx</span><span class="p">[</span><span class="n">indval</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateset</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="n">tiidx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">updatelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extlist</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update extval or extidx.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extlist** : list of list - list of values to update</span>
<span class="sd">        - **idx** : list of integer - list of index to update (idx=-1 for extval)</span>

<span class="sd">        *Returns* : none&#39;&#39;&#39;</span>
        <span class="n">extlis</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkidxlist</span><span class="p">(</span><span class="n">extlist</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">extlis</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;out of bounds&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">extl</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">extlis</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">extval</span>      <span class="o">=</span> <span class="n">extl</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">extl</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toint</span><span class="p">(</span><span class="n">extl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">vlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Apply a function to extval or extidx and return the result.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **func** : function (default none) - function to apply to extval or extidx</span>
<span class="sd">        - **args, kwargs** : parameters for the function</span>
<span class="sd">        - **idx** : integer - index to update (idx=-1 for extval)</span>

<span class="sd">        *Returns* : list of func result&#39;&#39;&#39;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkidxlist</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">extidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="n">extidx</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c1">#%% internal</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_cast</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; convert val in the type defined by the string dtype&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dtype</span> <span class="p">:</span>      <span class="k">return</span> <span class="n">val</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span>      <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="c1">#if val.lstrip() == &#39;&#39; and dtype in [&#39;int&#39;, &#39;float&#39;]: return 0</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
            <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;float&#39;</span><span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
            <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;datetime&#39;</span><span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="c1">#except : return datetime.datetime.min</span>
            <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;coord&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_c1</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_c2</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_c1</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">val</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_c2</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">val</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])]</span>
            <span class="k">else</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;dtype : &quot;</span> <span class="o">+</span> <span class="n">dtype</span> <span class="o">+</span> <span class="s2">&quot; inconsistent with data&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_checkidxlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listidx</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; check if listidx and idx are consistent and return a list for each&#39;&#39;&#39;</span>
        <span class="c1"># idx=-1 -&gt; val</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="p">:</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>    <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>                <span class="n">index</span> <span class="o">=</span>  <span class="n">idx</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;index out of bounds&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">listidx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="k">return</span> <span class="n">index</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">listidx</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;listindex not a list&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">listidx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span>   <span class="n">listindex</span> <span class="o">=</span> <span class="p">[</span><span class="n">listidx</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>                          <span class="n">listindex</span> <span class="o">=</span>  <span class="n">listidx</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">listindex</span><span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;listindex out of bounds&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">listindex</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_coupled</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">l2</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return boolean if l2 is coupled to ref&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_idxlink</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">l2</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_couplinginfo</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the coupling info between two list (dict)&#39;&#39;&#39;</span>
        <span class="n">set1</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span>
        <span class="n">set2</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">set1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">set2</span><span class="p">))</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">set1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">set2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">set1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">set2</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;distlinked&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;distcrossed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;distmin&#39;</span><span class="p">:</span> <span class="n">x0</span><span class="p">,</span> <span class="s1">&#39;distmax&#39;</span><span class="p">:</span> <span class="n">x1</span><span class="p">}</span>
        <span class="n">set3</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_toset</span><span class="p">([</span><span class="nb">tuple</span><span class="p">((</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">))</span> <span class="k">for</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">)])</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">set3</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">),</span>
                <span class="s1">&#39;disttomin&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">set3</span><span class="p">)</span> <span class="o">-</span> <span class="n">x0</span><span class="p">,</span>
                <span class="s1">&#39;disttomax&#39;</span><span class="p">:</span> <span class="n">x1</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">set3</span><span class="p">),</span>
                <span class="s1">&#39;distmin&#39;</span><span class="p">:</span> <span class="n">x0</span><span class="p">,</span> <span class="s1">&#39;distmax&#39;</span><span class="p">:</span> <span class="n">x1</span><span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_derived</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">l2</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return boolean if ref is derived from l2&#39;&#39;&#39;</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_tuple</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_transpose</span><span class="p">([</span><span class="n">ref</span><span class="p">,</span> <span class="n">l2</span><span class="p">])))</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">l2</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">l2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addproperty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">addaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">addlist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">addother</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">long</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the value of the properties&#39;&#39;&#39;</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;valname&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">,</span> <span class="s1">&#39;idxname&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">addproperty</span> <span class="p">:</span>
            <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;complete&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">complete</span><span class="p">,</span><span class="s1">&#39;completefull&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">completefull</span><span class="p">,</span> <span class="s1">&#39;consistent&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">consistent</span><span class="p">,</span>
                    <span class="s1">&#39;dimension&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">,</span> <span class="s1">&#39;lenidx&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">,</span> <span class="s1">&#39;len&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                    <span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">,</span> <span class="s1">&#39;setvallen&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">setvallen</span> <span class="p">}</span>
        <span class="k">if</span> <span class="n">addaxes</span><span class="p">:</span>
            <span class="n">lenidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span>
            <span class="n">idxcoupled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxcoupled</span>
            <span class="n">idxderived</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxderived</span>
            <span class="n">idxunique</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxunique</span>
            <span class="n">idxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxref</span>
            <span class="n">idxder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxder</span>
            <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;primary axes&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">idxcoupled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">idxunique</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">idxderived</span><span class="p">[</span><span class="n">i</span><span class="p">]]}</span>
            <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;single axes&#39;</span>  <span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)</span> <span class="k">if</span> <span class="n">idxunique</span><span class="p">[</span><span class="n">i</span><span class="p">]]}</span>
            <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;coupled axes&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &lt;-&gt; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>  
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)</span> <span class="k">if</span> <span class="n">idxcoupled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">idxunique</span><span class="p">[</span><span class="n">i</span><span class="p">]]}</span>
            <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;derived axes&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;  -&gt; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">idxder</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                                      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)</span> <span class="k">if</span> <span class="n">idxderived</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">idxunique</span><span class="p">[</span><span class="n">i</span><span class="p">]]}</span>
            <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;minimal axes&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span><span class="p">]}</span>   
        <span class="k">if</span> <span class="n">long</span> <span class="p">:</span>
            <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;extval&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="s1">&#39;iidx&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">,</span> <span class="s1">&#39;setidx&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span> <span class="p">}</span>
        <span class="k">if</span> <span class="n">addlist</span> <span class="p">:</span>
            <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;axes&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="s1">&#39;axeslen&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">axeslen</span><span class="p">,</span> <span class="s1">&#39;axesmin&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span><span class="p">,</span>
            <span class="s1">&#39;idxcoupled&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">idxcoupled</span><span class="p">,</span> <span class="s1">&#39;idxderived&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">idxderived</span><span class="p">,</span> <span class="s1">&#39;idxlen&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span><span class="p">,</span>
            <span class="s1">&#39;idxunique&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">idxunique</span><span class="p">,</span> <span class="s1">&#39;idxder&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">idxder</span><span class="p">,</span> <span class="s1">&#39;idxref&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">idxref</span><span class="p">,</span>
            <span class="s1">&#39;minMaxIndex&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">minMaxIndex</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">long</span> <span class="p">:</span>
                <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span> <span class="s1">&#39;extidx&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">,</span> <span class="s1">&#39;ind&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">ind</span><span class="p">,</span> <span class="s1">&#39;ival&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">ival</span><span class="p">,</span>
                        <span class="s1">&#39;setval&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">setval</span><span class="p">,</span> <span class="s1">&#39;tiidx&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span><span class="p">,</span> <span class="s1">&#39;textidx&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">textidx</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">addother</span><span class="p">:</span>
                <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;axesall&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">axesall</span><span class="p">,</span> <span class="s1">&#39;lencomplete&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">lencomplete</span><span class="p">,</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">dic</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_filter</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">lis</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;apply &quot;func&quot; to each value of &quot;lis&quot; and tests if equals &quot;res&quot;.</span>
<span class="sd">        Return the list of index with True result.&#39;&#39;&#39;</span>
        <span class="n">lisf</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="n">lis</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">))</span> <span class="k">if</span> <span class="n">lisf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">res</span><span class="p">]</span>

    <span class="sd">&#39;&#39;&#39;@staticmethod</span>
<span class="sd">    def _frombytes(listbson):</span>
<span class="sd">        if not isinstance(listbson, list) :</span>
<span class="sd">            raise IlistError(&quot;the object to convert is not a list&quot;)</span>
<span class="sd">        listvalue = []</span>
<span class="sd">        for bs in listbson :</span>
<span class="sd">            if isinstance(bs, (int, str, float, bool, list, datetime.datetime, type(None))) :</span>
<span class="sd">                listvalue.append(bs)</span>
<span class="sd">            elif isinstance(bs, dict) :</span>
<span class="sd">                try: listvalue.append(eval(list(bs.keys())[0])(bs[list(bs.keys())[0]]))</span>
<span class="sd">                except: listvalue.append(bs)</span>
<span class="sd">            else :</span>
<span class="sd">                try :</span>
<span class="sd">                    dic = bson.decode(bs)</span>
<span class="sd">                    listvalue.append(eval(list(dic.keys())[0])(dic[list(dic.keys())[0]]))</span>
<span class="sd">                except : raise IlistError(&quot;impossible to decode a bson object&quot;)</span>
<span class="sd">        return listvalue&#39;&#39;&#39;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_funclist</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the function func applied to the object value with parameters args and kwargs&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[])</span> <span class="p">:</span> <span class="k">return</span> <span class="n">value</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="n">listval</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">listval</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">listval</span> <span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> <span class="n">lis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">:</span>
                <span class="k">try</span> <span class="p">:</span> <span class="n">lis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="k">except</span> <span class="p">:</span>
                    <span class="k">try</span> <span class="p">:</span> <span class="n">lis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">listval</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                    <span class="k">except</span> <span class="p">:</span>
                        <span class="k">try</span> <span class="p">:</span> <span class="n">lis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">listval</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                        <span class="k">except</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;unable to apply func&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> <span class="k">return</span> <span class="n">lis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">lis</span>

    <span class="k">def</span> <span class="nf">_idxfilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">):</span>
        <span class="c1"># méthode à conserver (attr : extidx, iidx, setidx) ??</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;extidx&#39;</span><span class="p">,</span> <span class="s1">&#39;iidx&#39;</span><span class="p">,</span> <span class="s1">&#39;setidx&#39;</span><span class="p">]</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;attr not supported&quot;</span><span class="p">)</span>
        <span class="n">listidx</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">try</span> <span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">listidx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">func</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;function not available with the index&quot;</span><span class="p">)</span>
        <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listidx</span><span class="p">))</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">listidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">func</span><span class="p">)(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">except</span> <span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listidx</span><span class="p">))</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">listidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">func</span><span class="p">)(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="k">except</span> <span class="p">:</span>
                <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listidx</span><span class="p">))</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">listidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">func</span><span class="p">)(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span>
                <span class="k">except</span> <span class="p">:</span> <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_idxfull</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[]):</span> <span class="c1">#!!!!!!</span>
        <span class="sd">&#39;&#39;&#39;return additional iidx with full index in the axes&#39;&#39;&#39;</span>
        <span class="c1">#if    axes==[] : axe = [i for i in range(self.lenidx) if not self.idxcoupled[i]]</span>
        <span class="k">if</span>    <span class="n">axes</span><span class="o">==</span><span class="p">[]</span> <span class="p">:</span> <span class="n">axe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span>
        <span class="k">else</span>           <span class="p">:</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="n">iidxr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">]</span>
        <span class="n">lenfull</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_mul</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">iidxr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iidxr</span><span class="p">))])</span>
        <span class="k">if</span> <span class="n">lenfull</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[]</span>
        <span class="c1">#if [len(iidxr[i]) for i in range(len(iidxr))] == self.idxlen: return []</span>
        <span class="n">cnind</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">iidxr</span><span class="p">)))</span> <span class="c1"># tiidx réduit aux axes et complet</span>
        <span class="n">cnind</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">]))))</span>
        <span class="n">iidxadd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cnind</span><span class="o">.</span><span class="n">elements</span><span class="p">())))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">iidxadd</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[]</span>
        <span class="n">iidxfull</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="n">lenidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span>
        <span class="n">idxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxref</span>
        <span class="c1">#idxcoupled = self.idxcoupled</span>
        <span class="n">idxcoupled</span> <span class="o">=</span> <span class="p">[</span><span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="n">idxder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxder</span>
        <span class="c1">#idxderived = self.idxderived</span>
        <span class="n">idxderived</span> <span class="o">=</span> <span class="p">[</span><span class="n">idxder</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="n">idxunique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxunique</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">axe</span> <span class="p">:</span>
                <span class="n">iidxfull</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">iidxadd</span><span class="p">[</span><span class="n">axe</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span>
            <span class="k">elif</span> <span class="n">idxunique</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="p">:</span>
                <span class="n">iidxfull</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iidxadd</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
            <span class="k">elif</span> <span class="n">idxcoupled</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">and</span> <span class="n">idxref</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">:</span>
                <span class="n">dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idxlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idxref</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="n">iidxfull</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iidxadd</span><span class="p">[</span><span class="n">axe</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idxref</span><span class="p">[</span><span class="n">idx</span><span class="p">])]]</span>
            <span class="k">elif</span> <span class="n">idxderived</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">and</span> <span class="n">idxder</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">:</span>
                <span class="n">dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idxlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idxder</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">coupled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">iidxfull</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iidxadd</span><span class="p">[</span><span class="n">axe</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idxder</span><span class="p">[</span><span class="n">idx</span><span class="p">])]]</span>
            <span class="k">else</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;index : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; have to be in axes&quot;</span> <span class="p">)</span>
            <span class="sd">&#39;&#39;&#39;if idx in axe :</span>
<span class="sd">                iidxfull[idx] = iidxadd[axe.index(idx)]</span>
<span class="sd">            elif idx not in axe and idxcoupled[idx] and idxref[idx] in axe:</span>
<span class="sd">                dic = self._idxlink(self.iidx[idxref[idx]], self.iidx[idx])</span>
<span class="sd">                iidxfull[idx] = [dic[i] for i in iidxadd[axe.index(idxref[idx])]]</span>
<span class="sd">            elif idx not in axe and not idxcoupled[idx] and not idxunique[idx] \</span>
<span class="sd">                and idxderived[idx] and idxder[idx] in axe:</span>
<span class="sd">                dic = self._idxlink(self.iidx[idxder[idx]], self.iidx[idx], coupled=False)</span>
<span class="sd">                iidxfull[idx] = [dic[i] for i in iidxadd[axe.index(idxder[idx])]]</span>
<span class="sd">            elif idx not in axe and not idxcoupled[idx] and idxunique[idx] :</span>
<span class="sd">                iidxfull[idx] = [self.iidx[idx][0] for i in range(len(iidxadd[0]))]</span>
<span class="sd">            else : raise IlistError(&quot;index : &quot; + str(idx) + &quot; have to be in axes&quot; )&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">iidxfull</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_idxlink</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">coupled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">derived</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return dic ={ref i : l2 i} pour chaque tuple différent&#39;&#39;&#39;</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_tuple</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_transpose</span><span class="p">([</span><span class="n">ref</span><span class="p">,</span> <span class="n">l2</span><span class="p">])))</span>
        <span class="k">if</span> <span class="n">coupled</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">l2</span><span class="p">))</span> <span class="p">:</span> <span class="k">return</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">derived</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span> <span class="p">:</span> <span class="k">return</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_index</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the index of val in idx&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="k">return</span> <span class="n">idx</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">idx</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_indtoext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return ext value for an indice&#39;&#39;&#39;</span>
        <span class="n">lenidx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">ind</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_isinset</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">setidxfilt</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; tests if each index value in &quot;ind&quot; is present in the list of indexes &quot;setidxfilt&quot;&#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">setidxfilt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_json</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">option</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the json format of val (if function json() or to_json() exists&#39;&#39;&#39;</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encoded&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">IlistEncoder</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encoded&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bson&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="n">bson</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">bytes</span><span class="p">))</span> <span class="p">:</span> <span class="k">return</span> <span class="n">val</span>
            <span class="k">else</span> <span class="p">:</span> <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="o">**</span><span class="n">option</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span>     <span class="p">:</span> <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="o">**</span><span class="n">option</span><span class="p">)</span>
            <span class="k">except</span>  <span class="p">:</span> <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="o">**</span><span class="n">option</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_list</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span> <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">idx</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_mul</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
        <span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span> <span class="p">:</span> <span class="n">mul</span> <span class="o">*=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">mul</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_nullValue</span><span class="p">(</span><span class="n">Class</span><span class="p">,</span> <span class="n">fillvalue</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fillvalue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">fillvalue</span>
        <span class="c1">#if isinstance(fillvalue, Class) : return fillvalue</span>
        <span class="k">if</span> <span class="n">Class</span> <span class="o">==</span> <span class="nb">int</span>                 <span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">Class</span> <span class="o">==</span> <span class="nb">float</span>               <span class="p">:</span> <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Class</span> <span class="o">==</span> <span class="nb">str</span>                 <span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;-&#39;</span>
        <span class="k">if</span> <span class="n">Class</span> <span class="o">==</span> <span class="nb">bool</span>                <span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">Class</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_reindexidx</span><span class="p">(</span><span class="n">iidx</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">newsetidx</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">fast</span> <span class="p">:</span>
            <span class="n">dic</span><span class="o">=</span> <span class="p">{</span><span class="n">newsetidx</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">newsetidx</span><span class="p">))}</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="n">setidx</span><span class="p">[</span><span class="n">indb</span><span class="p">]]</span> <span class="k">for</span> <span class="n">indb</span> <span class="ow">in</span> <span class="n">iidx</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">newsetidx</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">setidx</span><span class="p">[</span><span class="n">indb</span><span class="p">])</span> <span class="k">for</span> <span class="n">indb</span> <span class="ow">in</span> <span class="n">iidx</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_reorder</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">if</span> <span class="n">sort</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span> <span class="k">return</span> <span class="n">val</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">sort</span><span class="p">]</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_resetidx</span><span class="p">(</span><span class="n">extidx</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return setidx and iidx from extidx&#39;&#39;&#39;</span>
        <span class="n">setidx</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">extidx</span><span class="p">]</span>
        <span class="n">iidx</span>   <span class="o">=</span> <span class="p">[</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_toint</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">setind</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">setind</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">extidx</span><span class="p">,</span> <span class="n">setidx</span><span class="p">)]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">)</span>

    <span class="sd">&#39;&#39;&#39;@staticmethod</span>
<span class="sd">    def _setable(extv):</span>
<span class="sd">        try :</span>
<span class="sd">            set(extv)</span>
<span class="sd">            return extv</span>
<span class="sd">        except :</span>
<span class="sd">            return Ilist._tuple(extv)&#39;&#39;&#39;</span>

    <span class="sd">&#39;&#39;&#39;@staticmethod</span>
<span class="sd">    def _tobytes(listvalue, encoded=True):</span>
<span class="sd">        res = []</span>
<span class="sd">        if not isinstance(listvalue, list) :</span>
<span class="sd">            raise IlistError(&quot;the objetc to convert to bytes is not a list&quot;)</span>
<span class="sd">        for value in listvalue :</span>
<span class="sd">            if isinstance(value, (int, str, float, bool, list, dict, datetime.datetime, type(None), bytes)):</span>
<span class="sd">                res.append(value)</span>
<span class="sd">            else :</span>
<span class="sd">                try : res.append(value.__to_bytes__(encoded=encoded))</span>
<span class="sd">                except : raise IlistError(&quot;impossible to apply __to_bytes__ method to object &quot;</span>
<span class="sd">                                          + str(type(value)))</span>
<span class="sd">        return res&#39;&#39;&#39;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_str</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_toint</span><span class="p">(</span><span class="n">extv</span><span class="p">,</span> <span class="n">extset</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return index of extv in extset&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">fast</span> <span class="p">:</span>
            <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span><span class="n">extset</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extset</span><span class="p">))}</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">extv</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">extset</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">extv</span><span class="p">]</span>
        <span class="sd">&#39;&#39;&#39;if not extv : return []</span>
<span class="sd">        ext = Ilist._setable(extv)</span>
<span class="sd">        if isinstance(ext[0], tuple) : return [extset.index(list(val)) for val in ext]</span>
<span class="sd">        return [extset.index(val) for val in ext]&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_toival</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extval</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return index of extval&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setval</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_toext</span><span class="p">(</span><span class="n">iidx</span><span class="p">,</span> <span class="n">extset</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a list of extset[idx] for idx in iidx&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">extset</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">iidx</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_tonumpy</span><span class="p">(</span><span class="n">lis</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">identity</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">func</span> <span class="o">=</span> <span class="n">identity</span>
        <span class="k">if</span> <span class="n">func</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span> <span class="p">:</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">))))</span>
        <span class="n">valList</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="n">lis</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">valList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span> <span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">valList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">valList</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">valList</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">valList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="p">:</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">valList</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">valList</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_toset</span><span class="p">(</span><span class="n">extv</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fast</span> <span class="p">:</span> <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">extv</span><span class="p">))</span>
        <span class="n">setidx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">extv</span> <span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">setidx</span> <span class="p">:</span> <span class="n">setidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">setidx</span>
        <span class="sd">&#39;&#39;&#39;ext = Ilist._setable(extv)</span>
<span class="sd">        setext = list(set(ext))</span>
<span class="sd">        if setext == [] or not isinstance(setext[0], tuple): return setext</span>
<span class="sd">        return list(map(list, setext))&#39;&#39;&#39;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_transpose</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s1">&#39;index not transposable&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="p">[[</span><span class="n">ix</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_tuple</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">[</span><span class="n">val</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>
    <span class="c1">#def _tuple(idx): return list(map(tuple, idx))</span>

    <span class="k">def</span> <span class="nf">_updateset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extind</span><span class="p">):</span>
        <span class="c1"># ajouter à la fin un recalcul de iidx en fonction de sorted(extset)</span>
        <span class="n">iind</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extind</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">if</span> <span class="n">extind</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extind</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">iind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">extind</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">iind</span>

    <span class="k">def</span> <span class="nf">_xcoord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axe</span><span class="p">,</span> <span class="n">funcidx</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&#39;&#39;&#39; Coords generation for Xarray&#39;&#39;&#39;</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">idxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxref</span>
        <span class="n">idxunique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxunique</span>
        <span class="n">idxcoupled</span> <span class="o">=</span> <span class="p">[</span><span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="n">idxder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxder</span>
        <span class="n">idxderived</span> <span class="o">=</span> <span class="p">[</span><span class="n">idxder</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idxunique</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">funcidx</span><span class="o">==</span><span class="p">[]</span> <span class="p">:</span> <span class="n">funci</span><span class="o">=</span><span class="n">identity</span>
            <span class="k">else</span> <span class="p">:</span> <span class="n">funci</span><span class="o">=</span> <span class="n">funcidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axe</span> <span class="p">:</span>
                <span class="n">xlisti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tonumpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">func</span><span class="o">=</span><span class="n">funci</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">xlisti</span>
            <span class="k">elif</span> <span class="n">idxcoupled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">:</span>
                <span class="n">xlisti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tonumpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xderived</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">func</span><span class="o">=</span><span class="n">funci</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">xlisti</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxderived</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">idxder</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">:</span>
                <span class="n">xlisti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tonumpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xderived</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">idxder</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">func</span><span class="o">=</span><span class="n">funci</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">idxder</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">xlisti</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;index : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; have to be in axes&quot;</span> <span class="p">)</span>
            <span class="sd">&#39;&#39;&#39;if idxunique[i] : continue</span>
<span class="sd">            if funcidx==[] : funci=identity</span>
<span class="sd">            else : funci= funcidx[i]</span>
<span class="sd">            if   idxcoupled[i] :</span>
<span class="sd">                xlisti = self._tonumpy(self._xderived(i, idxref[i]), func=funci, **kwargs)</span>
<span class="sd">                coord[self.idxname[i]] = (self.idxname[idxref[i]], xlisti)</span>
<span class="sd">            elif self.idxderived[i] :</span>
<span class="sd">                xlisti = self._tonumpy(self._xderived(i, idxder[i]), func=funci, **kwargs)</span>
<span class="sd">                coord[self.idxname[i]] = (self.idxname[idxder[i]], xlisti)</span>
<span class="sd">            else :</span>
<span class="sd">                xlisti = self._tonumpy(self.setidx[i], func=funci, **kwargs)</span>
<span class="sd">                coord[self.idxname[i]] = xlisti&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">coord</span>

    <span class="k">def</span> <span class="nf">_xderived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idxder</span><span class="p">,</span> <span class="n">idxori</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idxlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">[</span><span class="n">idxori</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">[</span><span class="n">idxder</span><span class="p">],</span> <span class="n">coupled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">idxori</span><span class="p">]]</span>


<span class="k">class</span> <span class="nc">IlistError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Ilist Exception&#39;&#39;&#39;</span>
    <span class="c1">#pass</span>
</pre></div>

        </details>

            </section>
                <section id="identity">
                            <div class="attr function"><a class="headerlink" href="#identity">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">identity</span><span class="signature">(*args, **kwargs)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;return the same value as args or kwargs&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span> <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span> <span class="k">return</span> <span class="n">kwargs</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">return</span> <span class="kc">None</span>
</pre></div>

        </details>

            <div class="docstring"><p>return the same value as args or kwargs</p>
</div>


                </section>
                <section id="IlistEncoder">
                                <div class="attr class">
        <a class="headerlink" href="#IlistEncoder">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">IlistEncoder</span><wbr>(<span class="base">json.encoder.JSONEncoder</span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">class</span> <span class="nc">IlistEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;add a new json encoder for Ilist&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="p">:</span> <span class="k">return</span> <span class="n">o</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">option</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encoded&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;encode_format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">}</span>
        <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="n">o</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="o">**</span><span class="n">option</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="n">o</span><span class="o">.</span><span class="n">__to_json__</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>add a new json encoder for Ilist</p>
</div>


                            <div id="IlistEncoder.default" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#IlistEncoder.default">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">default</span><span class="signature">(self, o)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="p">:</span> <span class="k">return</span> <span class="n">o</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">option</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encoded&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;encode_format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">}</span>
        <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="n">o</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="o">**</span><span class="n">option</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="n">o</span><span class="o">.</span><span class="n">__to_json__</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Implement this method in a subclass such that it returns
a serializable object for <code>o</code>, or calls the base implementation
(to raise a <code>TypeError</code>).</p>

<p>For example, to support arbitrary iterators, you could
implement default like this::</p>

<pre><code>def default(self, o):
    try:
        iterable = iter(o)
    except TypeError:
        pass
    else:
        return list(iterable)
    # Let the base class default method raise the TypeError
    return JSONEncoder.default(self, o)
</code></pre>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>json.encoder.JSONEncoder</dt>
                                <dd id="IlistEncoder.__init__" class="function">JSONEncoder</dd>
                <dd id="IlistEncoder.item_separator" class="variable">item_separator</dd>
                <dd id="IlistEncoder.key_separator" class="variable">key_separator</dd>
                <dd id="IlistEncoder.encode" class="function">encode</dd>
                <dd id="IlistEncoder.iterencode" class="function">iterencode</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="CborDecoder">
                                <div class="attr class">
        <a class="headerlink" href="#CborDecoder">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">CborDecoder</span><wbr>(<span class="base">json.decoder.JSONDecoder</span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">class</span> <span class="nc">CborDecoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONDecoder</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">json</span><span class="o">.</span><span class="n">JSONDecoder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">object_hook</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">codecbor</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">codecbor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dic</span><span class="p">):</span>
        <span class="n">dic2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
            <span class="k">try</span><span class="p">:</span> <span class="n">k2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="n">k2</span> <span class="o">=</span> <span class="n">k</span>
            <span class="n">dic2</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> 
        <span class="k">return</span> <span class="n">dic2</span>
</pre></div>

        </details>

            <div class="docstring"><p>Simple JSON <a href="http://json.org">http://json.org</a> decoder</p>

<p>Performs the following translations in decoding by default:</p>

<p>+---------------+-------------------+
| JSON          | Python            |
+===============+===================+
| object        | dict              |
+---------------+-------------------+
| array         | list              |
+---------------+-------------------+
| string        | str               |
+---------------+-------------------+
| number (int)  | int               |
+---------------+-------------------+
| number (real) | float             |
+---------------+-------------------+
| true          | True              |
+---------------+-------------------+
| false         | False             |
+---------------+-------------------+
| null          | None              |
+---------------+-------------------+</p>

<p>It also understands <code>NaN</code>, <code>Infinity</code>, and <code>-Infinity</code> as
their corresponding <code>float</code> values, which is outside the JSON spec.</p>
</div>


                            <div id="CborDecoder.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#CborDecoder.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">CborDecoder</span><span class="signature">()</span>
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">json</span><span class="o">.</span><span class="n">JSONDecoder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">object_hook</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">codecbor</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p><code>object_hook</code>, if specified, will be called with the result
of every JSON object decoded and its return value will be used in
place of the given <code>dict</code>.  This can be used to provide custom
deserializations (e.g. to support JSON-RPC class hinting).</p>

<p><code>object_pairs_hook</code>, if specified will be called with the result of
every JSON object decoded with an ordered list of pairs.  The return
value of <code>object_pairs_hook</code> will be used instead of the <code>dict</code>.
This feature can be used to implement custom decoders.
If <code>object_hook</code> is also defined, the <code>object_pairs_hook</code> takes
priority.</p>

<p><code>parse_float</code>, if specified, will be called with the string
of every JSON float to be decoded. By default this is equivalent to
float(num_str). This can be used to use another datatype or parser
for JSON floats (e.g. decimal.Decimal).</p>

<p><code>parse_int</code>, if specified, will be called with the string
of every JSON int to be decoded. By default this is equivalent to
int(num_str). This can be used to use another datatype or parser
for JSON integers (e.g. float).</p>

<p><code>parse_constant</code>, if specified, will be called with one of the
following strings: -Infinity, Infinity, NaN.
This can be used to raise an exception if invalid JSON numbers
are encountered.</p>

<p>If <code>strict</code> is false (true is the default), then control
characters will be allowed inside strings.  Control characters in
this context are those with character codes in the 0-31 range,
including <code>'\t'</code> (tab), <code>'\n'</code>, <code>'\r'</code> and <code>'\0'</code>.</p>
</div>


                            </div>
                            <div id="CborDecoder.codecbor" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#CborDecoder.codecbor">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">codecbor</span><span class="signature">(self, dic)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">codecbor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dic</span><span class="p">):</span>
        <span class="n">dic2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
            <span class="k">try</span><span class="p">:</span> <span class="n">k2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="n">k2</span> <span class="o">=</span> <span class="n">k</span>
            <span class="n">dic2</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> 
        <span class="k">return</span> <span class="n">dic2</span>
</pre></div>

        </details>

    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>json.decoder.JSONDecoder</dt>
                                <dd id="CborDecoder.decode" class="function">decode</dd>
                <dd id="CborDecoder.raw_decode" class="function">raw_decode</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Ilist">
                                <div class="attr class">
        <a class="headerlink" href="#Ilist">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Ilist</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Ilist</span><span class="p">:</span>
<span class="c1">#%% intro</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    An `Ilist` is a representation of an indexed list (a list is indexed by others list).</span>
<span class="sd">    E.g. python zip or csv file.</span>

<span class="sd">    *Attributes (for @property see methods)* :</span>

<span class="sd">    - **extval** : list of data to be indexed</span>
<span class="sd">    - **valname** : name of the extval list</span>
<span class="sd">    - **setval** : list of the different extval values (dynamic value)</span>
<span class="sd">    - **ival** : index of the extval (dynamic value)</span>
<span class="sd">    - **extidx** : list of index (dynamic value)</span>
<span class="sd">    - **idxname** : list of the index name</span>
<span class="sd">    - **setidx** : list of the different idxval values</span>
<span class="sd">    - **iidx** : index of the extidx list of values</span>

<span class="sd">    The methods defined in this class are :</span>

<span class="sd">    *constructor (classmethod))*</span>

<span class="sd">    - `Ilist.Iidic`</span>
<span class="sd">    - `Ilist.Iext`</span>
<span class="sd">    - `Ilist.Iidx`</span>
<span class="sd">    - `Ilist.Iset`</span>
<span class="sd">    - `Ilist.Izip`</span>

<span class="sd">    *dynamic value property (getters)*</span>

<span class="sd">    - `Ilist.ival`</span>
<span class="sd">    - `Ilist.setval`</span>
<span class="sd">    - `Ilist.extidx`</span>
<span class="sd">    - `Ilist.tiidx`</span>
<span class="sd">    - `Ilist.textidx`</span>

<span class="sd">    *global property (getters)*</span>

<span class="sd">    - `Ilist.axes`</span>
<span class="sd">    - `Ilist.axesall`</span>
<span class="sd">    - `Ilist.axesmin`</span>
<span class="sd">    - `Ilist.axesmono`</span>
<span class="sd">    - `Ilist.axesmulti`</span>
<span class="sd">    - `Ilist.complete`</span>
<span class="sd">    - `Ilist.completefull`</span>
<span class="sd">    - `Ilist.consistent`</span>
<span class="sd">    - `Ilist.dimension`</span>
<span class="sd">    - `Ilist.lencomplete`</span>
<span class="sd">    - `Ilist.lencompletefull`</span>
<span class="sd">    - `Ilist.rate`</span>
<span class="sd">    - `Ilist.setvallen`</span>
<span class="sd">    - `Ilist.zip`</span>

<span class="sd">    *idx property (getters)*</span>

<span class="sd">    - `Ilist.dicidxref`</span>
<span class="sd">    - `Ilist.idxcoupled`</span>
<span class="sd">    - `Ilist.idxderived`</span>
<span class="sd">    - `Ilist.idxder`</span>
<span class="sd">    - `Ilist.idxlen`</span>
<span class="sd">    - `Ilist.idxref`</span>
<span class="sd">    - `Ilist.idxunique`</span>
<span class="sd">    - `Ilist.ind`</span>
<span class="sd">    - `Ilist.lenidx`</span>
<span class="sd">    - `Ilist.minMaxIndex`</span>

<span class="sd">    *add - update methods*</span>

<span class="sd">    - `Ilist.addextidx`</span>
<span class="sd">    - `Ilist.addlistidx`</span>
<span class="sd">    - `Ilist.append`</span>
<span class="sd">    - `Ilist.appendi`</span>
<span class="sd">    - `Ilist.updateidx`</span>
<span class="sd">    - `Ilist.updatelist`</span>

<span class="sd">    *selecting methods*</span>

<span class="sd">    - `Ilist.extidxtoi`</span>
<span class="sd">    - `Ilist.iidxtoext`</span>
<span class="sd">    - `Ilist.iloc`</span>
<span class="sd">    - `Ilist.iseIndex`</span>
<span class="sd">    - `Ilist.isiIndex`</span>
<span class="sd">    - `Ilist.isValue`</span>
<span class="sd">    - `Ilist.loc`</span>
<span class="sd">    - `Ilist.setname`</span>
<span class="sd">    - `Ilist.unconsistent`</span>

<span class="sd">    *management - conversion methods*</span>

<span class="sd">    - `Ilist.axescoupling`</span>
<span class="sd">    - `Ilist.couplingmatrix`</span>
<span class="sd">    - `Ilist.derived_to_coupled`</span>
<span class="sd">    - `Ilist.full`</span>
<span class="sd">    - `Ilist.merge`</span>
<span class="sd">    - `Ilist.mergeidx`</span>
<span class="sd">    - `Ilist.reindex`</span>
<span class="sd">    - `Ilist.reorder`</span>
<span class="sd">    - `Ilist.setfilter`</span>
<span class="sd">    - `Ilist.sort`</span>
<span class="sd">    - `Ilist.sortidx`</span>
<span class="sd">    - `Ilist.swapindex`</span>

<span class="sd">    *exports methods*</span>

<span class="sd">    - `Ilist.from_obj` (classmethod)</span>
<span class="sd">    - `Ilist.from_csv` (classmethod)</span>
<span class="sd">    - `Ilist.from_file` (classmethod)</span>
<span class="sd">    - `Ilist.json`</span>
<span class="sd">    - `Ilist.to_obj`</span>
<span class="sd">    - `Ilist.to_csv`</span>
<span class="sd">    - `Ilist.to_file`</span>
<span class="sd">    - `Ilist.to_numpy`</span>
<span class="sd">    - `Ilist.to_xarray`</span>
<span class="sd">    - `Ilist.vlist`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="s1">&#39;extval&#39;</span><span class="p">,</span> <span class="s1">&#39;iidx&#39;</span><span class="p">,</span> <span class="s1">&#39;setidx&#39;</span><span class="p">,</span> <span class="s1">&#39;valname&#39;</span><span class="p">,</span> <span class="s1">&#39;idxname&#39;</span>
    <span class="n">_c1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;\d+\.?\d*[,\-_ ;:]&#39;</span><span class="p">)</span>
    <span class="n">_c2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[,\-_ ;:]\d+\.?\d*&#39;</span><span class="p">)</span>

<span class="c1">#%% constructor</span>
    <span class="nd">@classmethod</span>     <span class="c1"># !!! class methods</span>
    <span class="k">def</span> <span class="nf">Iidic</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dictvaliidx</span><span class="p">,</span> <span class="n">dictsetidx</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">idxref</span><span class="o">=</span><span class="p">[],</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (dictionnary data).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **dictvaliidx** :  {valname : valiidx} with valiidx=list(list(val, indexval))</span>
<span class="sd">        - **dictsetidx** :  {idxname0 : setidx0, ... , idxnamen : setidxn}</span>
<span class="sd">        - **order** : list (default []) of axes used if there is no indexval in valiidx</span>
<span class="sd">        - **idxref** : list (default []) of reference axes used if there is no indexval</span>
<span class="sd">        in valiidx</span>
<span class="sd">        - **defaultidx** : boolean (default True). If True, a generic index is generated</span>
<span class="sd">        if no index is defined</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_initdict</span><span class="p">(</span><span class="n">dictvaliidx</span><span class="p">,</span> <span class="n">dictsetidx</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">idxref</span><span class="p">),</span> <span class="n">defaultidx</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Iset</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">valiidx</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">idxref</span><span class="o">=</span><span class="p">[],</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span>
             <span class="n">idxname</span><span class="o">=</span><span class="p">[],</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (list data with indexed values ).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **valiidx** :  coupled val / index list : list(list(val, indexval))</span>
<span class="sd">        - **setidx** :  external different values of index (see data model)</span>
<span class="sd">        - **order** : list (default []) of axes used if there is no indexval in valiidx</span>
<span class="sd">        - **idxref** : list (default []) of reference axes used if there is no indexval in valiidx</span>
<span class="sd">        - **valname** : string (default &#39;value&#39;) name of indexed list (see data model)</span>
<span class="sd">        - **idxname** : list of string (default []) name of index list (see data model)</span>
<span class="sd">        - **defaultidx** : boolean (default True). If True, a generic index is generated</span>
<span class="sd">        if no index is defined</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">valiidx</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="p">:</span> <span class="n">validx</span> <span class="o">=</span> <span class="p">[</span><span class="n">valiidx</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">validx</span> <span class="o">=</span> <span class="n">valiidx</span>
        <span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">iidx</span><span class="p">)</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_initset</span><span class="p">(</span><span class="n">validx</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">idxref</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Iidx</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">extval</span><span class="p">,</span> <span class="n">idxlen</span><span class="p">,</span> <span class="n">idxref</span><span class="o">=</span><span class="p">[],</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">idxname</span><span class="o">=</span><span class="p">[],</span>
             <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (automatic index).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : indexed list (see data model)</span>
<span class="sd">        - **idxlen** : integer - number of index</span>
<span class="sd">        - **idxref** : list (default []) of reference axes used</span>
<span class="sd">        - **order** : list (default []) of axes used to order the index</span>
<span class="sd">        - **valname** : string (default &#39;value&#39;) name of indexed list (see data model)</span>
<span class="sd">        - **idxname** : list of string (default []) name of index list (see data model)</span>
<span class="sd">        - **defaultidx** : boolean (default True). If True, a generic index</span>
<span class="sd">        is generated if no index is defined</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="n">iidx</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_initiidx</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">),</span> <span class="n">idxlen</span><span class="p">,</span> <span class="n">idxref</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="p">[],</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Iedic</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dicval</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:[]},</span> <span class="n">dicidx</span><span class="o">=</span><span class="p">{},</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (external dictionnary).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **dicval** : {valname : extval}  (see data model)</span>
<span class="sd">        - **dicidx** : {idxname[0] : extidx[0], ... , idxname[n] : extidx[n]} (see data model)</span>
<span class="sd">        - **defaultidx** : boolean (default True). If True, a generic index</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        is generated if no index is defined</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="n">valname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dicval</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">extval</span> <span class="o">=</span> <span class="n">dicval</span><span class="p">[</span><span class="n">valname</span><span class="p">]</span>
        <span class="n">idxname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dicidx</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">extidx</span> <span class="o">=</span> <span class="p">[</span><span class="n">dicidx</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">idxname</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">Iext</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">extidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Iext</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">extval</span><span class="o">=</span><span class="p">[],</span> <span class="n">extidx</span><span class="o">=</span><span class="p">[],</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">idxname</span><span class="o">=</span><span class="p">[],</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (external index).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : indexed list (see data model)</span>
<span class="sd">        - **extidx** : index list (see data model)</span>
<span class="sd">        - **valname** : string (default &#39;value&#39;) name of indexed list (see data model)</span>
<span class="sd">        - **idxname** : list of string (default []) name of index list (see data model)</span>
<span class="sd">        - **defaultidx** : boolean (default True). If True, a generic index</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        is generated if no index is defined</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">extidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">defaultidx</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">extidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">or</span> <span class="n">extidx</span> <span class="o">==</span> <span class="p">[])</span> <span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">)))]</span>
            <span class="n">idxname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;default index&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">extidx</span> <span class="o">!=</span> <span class="p">[]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">extidx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="n">ext</span> <span class="o">=</span> <span class="p">[</span><span class="n">extidx</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>                                          <span class="n">ext</span> <span class="o">=</span> <span class="n">extidx</span>
        <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Izip</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (external index only).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **args** : index list extidx=list(args) (see data model)</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">Iext</span><span class="p">(</span><span class="n">extval</span><span class="o">=</span><span class="p">[],</span> <span class="n">extidx</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">idxname</span><span class="o">=</span><span class="p">[],</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extval</span><span class="o">=</span><span class="p">[],</span> <span class="n">setidx</span><span class="o">=</span><span class="p">[],</span> <span class="n">iidx</span><span class="o">=</span><span class="p">[],</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">idxname</span><span class="o">=</span><span class="p">[],</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : list (default []) - indexed list (see data model)</span>
<span class="sd">        - **setidx** :  list (default []) - external different values of index (see data model)</span>
<span class="sd">        - **iidx** :  list (default [])  - integer value of index (see data model)</span>
<span class="sd">        - **valname** : string (default &#39;value&#39;) - name of indexed list (see data model)</span>
<span class="sd">        - **idxname** : list of string (default []) - name of index list (see data model)</span>
<span class="sd">        - **defaultidx** : boolean (default True) - If True, a generic index</span>
<span class="sd">        is generated if no index is defined</span>

<span class="sd">        *Returns* : None&#39;&#39;&#39;</span>
        <span class="k">if</span>   <span class="nb">type</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span>  <span class="o">!=</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">iidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span>   <span class="n">defaultidx</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">iidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">or</span> <span class="n">iidx</span> <span class="o">==</span> <span class="p">[])</span> <span class="p">:</span>
            <span class="n">iindex</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">)))]</span>
            <span class="k">if</span> <span class="n">idxname</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span>                      <span class="n">idxname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;default index&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">iidx</span> <span class="o">!=</span> <span class="p">[]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">iidx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="n">iindex</span> <span class="o">=</span> <span class="p">[</span><span class="n">iidx</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>                                      <span class="n">iindex</span> <span class="o">=</span> <span class="n">iidx</span>
        <span class="k">if</span>   <span class="nb">type</span><span class="p">(</span><span class="n">setidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">or</span> <span class="n">setidx</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span> <span class="n">setindex</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">iindex</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">setidx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span>              <span class="n">setindex</span> <span class="o">=</span> <span class="p">[</span><span class="n">setidx</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>                                      <span class="n">setindex</span> <span class="o">=</span>  <span class="n">setidx</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span>                   <span class="p">:</span> <span class="n">extvalue</span> <span class="o">=</span> <span class="p">[</span><span class="n">extval</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">extval</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">and</span> <span class="n">iindex</span> <span class="o">==</span> <span class="p">[]</span>        <span class="p">:</span> <span class="n">extvalue</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="n">extval</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">iindex</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                                                    <span class="n">extvalue</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">iindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                                                    <span class="n">valname</span> <span class="o">=</span> <span class="s1">&#39;default value&#39;</span>
        <span class="k">else</span> <span class="p">:</span>                                      <span class="n">extvalue</span> <span class="o">=</span> <span class="n">extval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extval</span>  <span class="o">=</span> <span class="n">extvalue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>    <span class="o">=</span> <span class="n">iindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span>  <span class="o">=</span> <span class="n">setindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valname</span> <span class="o">=</span> <span class="n">valname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;idx&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iindex</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">setindex</span><span class="p">)))]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">idxname</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">))</span> <span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_initdict</span><span class="p">(</span><span class="n">dictvaliidx</span><span class="p">,</span> <span class="n">dictsetidx</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">idxref</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&#39;&#39;&#39; generate extval, setidx, iidx, valname and idxname&#39;&#39;&#39;</span>
        <span class="n">valname</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>
        <span class="n">validx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dictvaliidx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span>
            <span class="n">valname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dictvaliidx</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">validx</span> <span class="o">=</span> <span class="n">dictvaliidx</span><span class="p">[</span><span class="n">valname</span><span class="p">]</span>
        <span class="n">setidx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">idxname</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">dictsetidx</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="p">:</span> <span class="n">vl</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span> <span class="p">:</span> <span class="n">vl</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span>
            <span class="n">idxname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">setidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>
        <span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">iidx</span><span class="p">)</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_initset</span><span class="p">(</span><span class="n">validx</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">idxref</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_initiidx</span><span class="p">(</span><span class="n">vallen</span><span class="p">,</span> <span class="n">idxlen</span><span class="p">,</span> <span class="n">idxref</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; generate a generic iidx&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">vallen</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">idxlen</span> <span class="o">==</span> <span class="p">[]:</span> <span class="k">return</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">idxlen</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span>          <span class="k">return</span> <span class="p">[</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span> <span class="p">]</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">idxlen</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>           <span class="k">return</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">idxref</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">and</span> <span class="n">defaultidx</span> <span class="p">:</span> <span class="n">ref</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxlen</span><span class="p">)))</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">ref</span> <span class="o">=</span> <span class="n">idxref</span>
        <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span> <span class="n">orde</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxlen</span><span class="p">)))</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">orde</span> <span class="o">=</span> <span class="n">order</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">idxlen</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ref</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;idxref and idxlen should have the same lenght&quot;</span><span class="p">)</span>
        <span class="n">idxcoupled</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxlen</span><span class="p">))</span> <span class="k">if</span> <span class="n">ref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">axes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span>
        <span class="n">axesord</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">orde</span> <span class="p">:</span>
            <span class="n">iref</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">iref</span> <span class="ow">in</span> <span class="n">axes</span> <span class="ow">and</span> <span class="n">iref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axesord</span> <span class="p">:</span> <span class="n">axesord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iref</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axes</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axesord</span> <span class="p">:</span> <span class="n">axesord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">iiord</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">idxlen</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axesord</span><span class="p">]</span>
        <span class="n">iidxord</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">iiord</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">vallen</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">iidxord</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;val lenght is not consistent with index lenght&quot;</span><span class="p">)</span>
        <span class="n">iidx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iidxord</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axes</span> <span class="p">:</span> <span class="n">iidx</span><span class="p">[</span><span class="n">axes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">iidxord</span><span class="p">[</span><span class="n">axesord</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxcoupled</span> <span class="p">:</span>
            <span class="n">iidx</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iidx</span><span class="p">[</span><span class="n">ref</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">iidx</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_initset</span><span class="p">(</span><span class="n">validx</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">idxref</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; generate extval and iidx &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">validx</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span>
            <span class="n">extval</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">iidx</span>   <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">setidx</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">validx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span>
            <span class="n">extval</span> <span class="o">=</span> <span class="n">validx</span>
            <span class="n">idxlen</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">setidx</span><span class="p">]</span>
            <span class="n">iidx</span>   <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_initiidx</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">),</span> <span class="n">idxlen</span><span class="p">,</span> <span class="n">idxref</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">tvalidx</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="n">validx</span><span class="p">)</span>
            <span class="n">extval</span>  <span class="o">=</span> <span class="n">tvalidx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">iidx</span>    <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="n">tvalidx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">iidx</span><span class="p">)</span>

<span class="c1">#%% special</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return ival and iidx&#39;&#39;&#39;</span>
        <span class="n">texLis</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="p">:</span> <span class="n">texLis</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ival</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">texLis</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return valname, extval, idxname and extidx&#39;&#39;&#39;</span>
        <span class="n">texLis</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">option</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encoded&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;encode_format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">nam</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">texLis</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">nam</span> <span class="o">+</span> <span class="s1">&#39; : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="o">**</span><span class="n">option</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">valname</span> <span class="o">+</span> <span class="s1">&#39; : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="o">**</span><span class="n">option</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">texLis</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; equal if extval and extidx are equal&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">extval</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">extidx</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; len of extval&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; item of extval&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return extval item&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; modify extval item&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">ind</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ind</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;out of bounds&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add other&#39;s values to self&#39;s values in a new Ilist&#39;&#39;&#39;</span>
        <span class="n">newilist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>
        <span class="n">newilist</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newilist</span>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add other&#39;s values to self&#39;s values&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">iadd</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add other&#39;s index to self&#39;s index in a new Ilist&#39;&#39;&#39;</span>
        <span class="n">newilist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>
        <span class="n">newilist</span><span class="o">.</span><span class="fm">__ior__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newilist</span>

    <span class="k">def</span> <span class="fm">__ior__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add other&#39;s index to self&#39;s index&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;the sizes are not equal&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">lenidx</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addlistidx</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">other</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">other</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Copy all the data (deepcopy)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="c1">#%% property</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>             <span class="c1">#!!!!trop long, à clarifier</span>
        <span class="sd">&#39;&#39;&#39; return the list of independant axes (not coupled and not unique)&#39;&#39;&#39;</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span>
        <span class="n">idxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxref</span>
        <span class="n">idxcoupled</span> <span class="o">=</span> <span class="p">[</span><span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>  <span class="c1"># temps de réponse</span>
        <span class="c1">#idxcoupled = self.idxcoupled</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
                                <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">y</span><span class="p">)</span> <span class="k">else</span> <span class="n">z</span><span class="p">,</span>
                                <span class="n">idxlen</span><span class="p">,</span> <span class="n">idxcoupled</span><span class="p">,</span> <span class="n">idxref</span><span class="p">)))))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">axes</span> <span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">axes</span>
        <span class="c1">#return self.axesmin</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axesall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return the list of all axes &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">))</span>

    <span class="sd">&quot;&quot;&quot;@property</span>
<span class="sd">    def axeslen(self):</span>
<span class="sd">        &#39;&#39;&#39; return the list of axes lenght &#39;&#39;&#39;</span>
<span class="sd">        idxlen = self.idxlen</span>
<span class="sd">        return [idxlen[axe] for axe in self.axes]&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axesmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return the list of independant axes (not coupled, not derived and not unique)&#39;&#39;&#39;</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">idxcoupled</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxcoupled</span>
        <span class="n">idxunique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxunique</span>
        <span class="n">idxderived</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxderived</span>
        <span class="n">lenidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">idxcoupled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">idxunique</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">idxderived</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lenidx</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">axes</span> <span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">axes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axesmono</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return the list of axes with one value &#39;&#39;&#39;</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxlen</span><span class="p">))</span> <span class="k">if</span> <span class="n">idxlen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axesmulti</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return the list of axes with more than one value &#39;&#39;&#39;</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxlen</span><span class="p">))</span> <span class="k">if</span> <span class="n">idxlen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a boolean (True if Ilist is complete and consistent)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lencomplete</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">consistent</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">completefull</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a boolean (True if Ilist is full complete and consistent)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lencompletefull</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">consistent</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">consistent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a boolean (True if Ilist is consistent : only one extval</span>
<span class="sd">        for one list of index values&#39;&#39;&#39;</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tuple</span><span class="p">(</span><span class="n">tiidx</span><span class="p">)))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">dicidxref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a dict with pair of coupled index (index name)&#39;&#39;&#39;</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span>
        <span class="n">idxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxref</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxref</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">idxlen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">dic</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return an integer : the number of index non coupled and non unique&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">extidx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return extidx (see data model)&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="p">[</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">]))]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">))]</span>

    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">idicidxref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a dict with pair of coupled index (index row)&#39;&#39;&#39;</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span>
        <span class="n">idxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxref</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxref</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">idxlen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dic</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">idxcoupled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a list of boolean for each index (True if coupled)&#39;&#39;&#39;</span>
        <span class="n">idxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxref</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>
 
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">idxder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the list of derived index&#39;&#39;&#39;</span>
        <span class="n">lenidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_derived</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                    <span class="n">lis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
                    <span class="k">break</span>
        <span class="k">while</span> <span class="n">lis</span> <span class="o">!=</span> <span class="p">[</span><span class="n">lis</span><span class="p">[</span><span class="n">lis</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)]</span> <span class="p">:</span>
            <span class="n">lis</span> <span class="o">=</span> <span class="p">[</span><span class="n">lis</span><span class="p">[</span><span class="n">lis</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">lis</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">idxderived</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a list of boolean for each index (True if derived)&#39;&#39;&#39;</span>
        <span class="n">idxder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxder</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">idxder</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">idxlen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return the list of setidx lenght &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">seti</span><span class="p">)</span> <span class="k">for</span> <span class="n">seti</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">idxref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the list of reference index&#39;&#39;&#39;</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coupled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                    <span class="n">lis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="n">lis</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">idxunique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a list of boolean for each index (True if unique)&#39;&#39;&#39;</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span>
        <span class="k">return</span> <span class="p">[</span> <span class="n">idl</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">idl</span> <span class="ow">in</span> <span class="n">idxlen</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the textidx (see data model)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ival</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the ival (see data model)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setval</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lencomplete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return an integer : number of values if complete (prod(idxlen,not coupled))&#39;&#39;&#39;</span>
        <span class="n">idxcoupled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxcoupled</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mul</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="nb">max</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">idxcoupled</span><span class="p">,</span> <span class="n">idxlen</span><span class="p">)))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lencompletefull</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return an integer : number of values if full complete (prod(idxlen,not coupled, not derived))&#39;&#39;&#39;</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span>    
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mul</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lenidx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return an integer : number of index&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">minMaxIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return a list : [ minimal value of index, maximal value of index]&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">maxInd</span> <span class="o">=</span> <span class="n">minInd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">:</span>
                <span class="n">minInd</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minInd</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
                <span class="n">maxInd</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxInd</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minInd</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">maxInd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">minInd</span><span class="p">,</span> <span class="n">maxInd</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the float ratio : len / lencompletefull&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">lencompletefull</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">setval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the setval (see data model)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">setvallen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return the integer lenght of setval (see data model)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setval</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">textidx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the textidx (see data model)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tiidx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the tiidx (see data model)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a zip format for textidx : tuple(tuple(idx)&#39;&#39;&#39;</span>
        <span class="n">textidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textidx</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">textidx</span><span class="p">)</span>

<span class="c1">#%% methods</span>
    <span class="k">def</span> <span class="nf">addextidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">extidx</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add a new index with name = idxname and extidx.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **idxname** : string - name of index list (see data model)</span>
<span class="sd">        - **extidx** : list - new index list (see data model)</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addlistidx</span><span class="p">(</span><span class="n">idxname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">extidx</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toint</span><span class="p">(</span><span class="n">extidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">extidx</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">addlistidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add a new index with name = idxname and setidx / iidx.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **idxname** : string - name of index list (see data model)</span>
<span class="sd">        - **setidx** :  list - external different values of index (see data model)</span>
<span class="sd">        - **iidx** :  list - integer value of index (see data model)</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">iidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">iidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;listindex out of bounds&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">setidx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="o">=</span> <span class="n">iidx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">idxname</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span> <span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">setidx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>   <span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iidx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idxname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extval</span><span class="p">,</span> <span class="n">extind</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add a new value extval with index extind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : new object value</span>
<span class="sd">        - **extind** :  list - new index values to add to extidx</span>
<span class="sd">        - **unique** :  boolean (default False) - If True and extidx present</span>
<span class="sd">        - **fast** : boolean (default False) - Update whithout reindex</span>
<span class="sd">        in textidx append is refuse.</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iseIndex</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">unique</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">isValue</span><span class="p">(</span><span class="n">extval</span><span class="p">)):</span> <span class="k">return</span>
        <span class="k">if</span> <span class="n">fast</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span>
            <span class="n">iind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateset</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">iind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">)</span> <span class="p">:</span> <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="n">tiidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_updateset</span><span class="p">(</span><span class="n">extind</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="n">tiidx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">appendi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extval</span><span class="p">,</span> <span class="n">intind</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add a new value extval with index intind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : new object value</span>
<span class="sd">        - **intind** :  list - new index values to add to iidx</span>
<span class="sd">        - **unique** :  boolean (default False) - If True and intind present</span>
<span class="sd">        in tiidx append is refuse.</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isiIndex</span><span class="p">(</span><span class="n">intind</span><span class="p">)</span> <span class="ow">and</span> <span class="n">unique</span><span class="p">)</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isValue</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isiIndex</span><span class="p">(</span><span class="n">intind</span><span class="p">)):</span> <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="n">tiidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="n">tiidx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">axescoupling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return the list of independant axes (not coupled, not derived and not unique)</span>
<span class="sd">        with coupling order (most coupling first)</span>
<span class="sd">        </span>
<span class="sd">        *Parameters*</span>

<span class="sd">        - **axes** : list of int (default None) - list of axes </span>

<span class="sd">        *Returns* : list  &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span><span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="n">axes</span>
        <span class="n">axe</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span> <span class="k">if</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span><span class="p">]</span>
        <span class="n">order</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">couplingmatrix</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axe</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">axe</span><span class="p">,</span> <span class="n">axe</span><span class="p">]</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  
            <span class="n">order</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
            <span class="n">axe</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">order</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">axe</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">order</span>
    
    <span class="k">def</span> <span class="nf">couplingmatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a matrix ratio with coupling ratio between each axes.</span>
<span class="sd">        The matrix is return or stored in a file (csv format).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **file** : string (default None) - name of the file. If None, the array </span>
<span class="sd">        is returned.</span>

<span class="sd">        *Returns* : array or None&#39;&#39;&#39;</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">_couplinginfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">j</span><span class="p">])[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span> 
             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="p">:</span> <span class="k">return</span> <span class="n">mat</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">):</span> <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
           
    <span class="k">def</span> <span class="nf">derived_to_coupled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idxder</span><span class="p">,</span> <span class="n">idxref</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Transform a derived index in a coupled index (new setidx).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **idxder** : number of the derived index.</span>
<span class="sd">        - **idxref** : number of the index to be coupled.</span>

<span class="sd">        *Returns* : None&#39;&#39;&#39;</span>
        <span class="n">dic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_idxlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idxref</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idxder</span><span class="p">],</span> <span class="n">coupled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">derived</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dic</span><span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;idx is not derived from the other&quot;</span><span class="p">)</span>
        <span class="n">setidx</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">idxder</span><span class="p">][</span><span class="n">dic</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span><span class="p">[</span><span class="n">idxref</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">idxder</span><span class="p">]</span> <span class="o">=</span> <span class="n">setidx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idxder</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idxref</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">extidxtoi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        convert an extind (value for each extidx) to an intind (value for each iidx).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extind** : value for each extidx</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **list** : intind, value for each iidx&#39;&#39;&#39;</span>
        <span class="k">try</span> <span class="p">:</span>  <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">extind</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extind</span><span class="p">))]</span>
        <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_obj</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate an Ilist Object from a bytes, json or dict value</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **bs** : bytes or string data to convert</span>

<span class="sd">        *Returns* : Ilist &#39;&#39;&#39;</span>
        <span class="n">setidx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">extval</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">bs</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x00</span> <span class="ow">and</span> <span class="p">(</span><span class="n">bs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mb">0b11100000</span><span class="p">)</span><span class="o">==</span> <span class="mb">0b10100000</span><span class="p">:</span>
                <span class="n">dic2</span> <span class="o">=</span> <span class="n">cbor2</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">dic2</span> <span class="o">=</span> <span class="n">bson</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="p">:</span> <span class="n">dic2</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">object_hook</span><span class="o">=</span><span class="n">CborDecoder</span><span class="p">()</span><span class="o">.</span><span class="n">codecbor</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="n">dic2</span> <span class="o">=</span> <span class="n">bs</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;the type of parameter is not available&quot;</span><span class="p">)</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">dic2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ES</span><span class="o">.</span><span class="n">invcodeb</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="n">ES</span><span class="o">.</span><span class="n">invcodeb</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">if</span> <span class="s1">&#39;_id&#39;</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span> <span class="n">dic</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;order&#39;</span> <span class="ow">in</span> <span class="n">dic</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> 
            <span class="n">idxname</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span>
            <span class="n">setidx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">idxname</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">setidx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s1">&#39;idxref&#39;</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span> <span class="n">idxref</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;idxref&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">idxref</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">valname</span> <span class="o">=</span> <span class="s1">&#39;default value&#39;</span>
        <span class="k">for</span> <span class="n">elmt</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>    
            <span class="k">if</span> <span class="n">elmt</span> <span class="ow">in</span> <span class="n">idxname</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="n">elmt</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span> 
                <span class="n">setidx</span><span class="p">[</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elmt</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="n">elmt</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">elmt</span> <span class="ow">in</span> <span class="n">idxname</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="n">elmt</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span> 
                <span class="n">setidx</span><span class="p">[</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elmt</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="n">elmt</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="n">elmt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;idxref&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">]:</span> 
                <span class="n">valname</span> <span class="o">=</span> <span class="n">elmt</span>
                <span class="n">extval</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="n">elmt</span><span class="p">]</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">setid</span><span class="p">)</span> <span class="k">for</span> <span class="n">setid</span> <span class="ow">in</span> <span class="n">setidx</span><span class="p">]</span>  
        <span class="n">axesmulti</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxlen</span><span class="p">))</span> <span class="k">if</span> <span class="n">idxlen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;index&#39;</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>
            <span class="sd">&#39;&#39;&#39;if isinstance(dic[&#39;index&#39;], list): iidx = dic[&#39;index&#39;]</span>
<span class="sd">            else: iidx = np.frombuffer(dic[&#39;index&#39;], dtype=&#39;u2&#39;) \</span>
<span class="sd">                         .reshape((len(idxname),len(extval))).tolist()&#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span> <span class="n">iidxmulti</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">iidxmulti</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;u2&#39;</span><span class="p">)</span> \
                         <span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">axesmulti</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">)))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">lismono</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">))]</span>
            <span class="n">iidx</span> <span class="o">=</span> <span class="p">[</span><span class="n">iidxmulti</span><span class="p">[</span><span class="n">axesmulti</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axesmulti</span> \
                    <span class="k">else</span> <span class="n">lismono</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">))]</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iidxref</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">idxref</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">:</span>
                <span class="n">keyn</span> <span class="o">=</span> <span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">valn</span> <span class="o">=</span> <span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="n">iidxref</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">keyn</span><span class="p">,</span> <span class="n">valn</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">keyn</span><span class="p">,</span> <span class="n">valn</span><span class="p">)</span>
            <span class="n">iidx</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_initiidx</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">),</span> <span class="n">idxlen</span><span class="p">,</span> <span class="n">iidxref</span><span class="p">,</span> 
                                 <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">))),</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot;@classmethod</span>
<span class="sd">    def from_bytes(cls, bs):</span>
<span class="sd">        &#39;&#39;&#39;</span>
<span class="sd">        Generate an Ilist Object from a bytes value</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **bson** : bytes data to convert</span>

<span class="sd">        *Returns* : Ilist &#39;&#39;&#39;</span>
<span class="sd">        setidx = []</span>
<span class="sd">        if isinstance(bs, bytes) : dic = bson.decode(bs)</span>
<span class="sd">        else : dic = bs</span>
<span class="sd">        if &#39;_id&#39; in dic : dic.pop(&#39;_id&#39;)</span>
<span class="sd">        names = list(dic)</span>
<span class="sd">        valname = names[0]</span>
<span class="sd">        idxname = names[2:len(dic)]</span>
<span class="sd">        extval = Ilist._frombytes(dic[names[0]])</span>
<span class="sd">        for name in idxname : setidx.append(Ilist._frombytes(dic[name]))</span>
<span class="sd">        if isinstance(dic[names[1]], list): iidx = dic[names[1]]</span>
<span class="sd">        else: iidx = np.frombuffer(dic[names[1]], dtype=&#39;u2&#39;).reshape((len(idxname), len(extval))).tolist()</span>
<span class="sd">        return cls(extval, setidx, iidx, valname, idxname)&quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_csv</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;ilist.csv&#39;</span><span class="p">,</span> <span class="n">valfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (from a csv file). Each column represents extidx or extval values.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **filename** : string (default &#39;ilist.csv&#39;), name of the file to read</span>
<span class="sd">        - **valfirst** : boolean (default False). If False extval is the last columns</span>
<span class="sd">        else it&#39;s the first</span>
<span class="sd">        - **header** : boolean (default True). If True, the first raw is dedicated to names</span>
<span class="sd">        - **dtype** : list of string (default None) - data type for each column (default str) : str, int, float, datetime, coord</span>
<span class="sd">        - **kwargs** : see csv.reader options</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="n">extval</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">extidx</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span>
        <span class="n">idxname</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dtype</span> <span class="p">:</span> <span class="n">dtype</span> <span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">first</span><span class="o">=</span><span class="kc">True</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">first</span> <span class="p">:</span>
                    <span class="k">for</span> <span class="n">vrow</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">:</span> <span class="n">extidx</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="k">if</span> <span class="n">first</span> <span class="ow">and</span> <span class="n">header</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="n">valfirst</span>      <span class="p">:</span>
                        <span class="n">valname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">vrow</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">:</span> <span class="n">idxname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">vrow</span><span class="p">))</span>
                    <span class="k">else</span> <span class="p">:</span>
                        <span class="n">valname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">vrow</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="n">idxname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">vrow</span><span class="p">))</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="n">valfirst</span>      <span class="p">:</span>
                        <span class="n">extval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="n">extidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]))</span>
                    <span class="k">else</span> <span class="p">:</span>
                        <span class="n">extval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]))</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="n">extidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dtype</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]))</span>
                <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">Iext</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">extidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">forcestring</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate `Ilist` object from file storage.</span>

<span class="sd">         *Parameters*</span>

<span class="sd">        - **file** : string - file name (with path)</span>
<span class="sd">        - **forcestring** : boolean (default False) - if True, forces the UTF-8 data format, else the format is calculated</span>

<span class="sd">        *Returns* : Ilist object&#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">btype</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">btype</span><span class="o">==</span><span class="nb">bytes</span><span class="p">(</span><span class="s1">&#39;{&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">forcestring</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">bjson</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">bjson</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_obj</span><span class="p">(</span><span class="n">bjson</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">full</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[],</span> <span class="n">fillvalue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add new extval with new extidx to have a complet Ilist</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **axes** : list (default []) - list of index to be completed. If [], self.axesmin is used.</span>
<span class="sd">        - **fillvalue** : object value used for the new extval</span>
<span class="sd">        - **inplace** : boolean (default True) - if True, new values are added,</span>
<span class="sd">        if False a new Ilist is created.</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **None**, if inplace. Ilist if not inplace&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">consistent</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;unable to generate full Ilist with inconsistent Ilist&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span> <span class="p">:</span> <span class="n">axe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="n">iidxadd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idxfull</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">iidxadd</span> <span class="ow">and</span> <span class="n">inplace</span> <span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">iidxadd</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">inplace</span> <span class="p">:</span> <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">iidxfull</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">idxadd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">,</span> <span class="n">iidxadd</span><span class="p">)</span> <span class="p">:</span> <span class="n">iidxfull</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="n">idxadd</span><span class="p">)</span>
        <span class="n">extvalfull</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">)</span>
        <span class="n">extvalfull</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_nullValue</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">extvalfull</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">fillvalue</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iidxadd</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
        <span class="sd">&#39;&#39;&#39;tiidxfull = self.tiidx</span>
<span class="sd">        extvalfull = copy(self.extval)</span>
<span class="sd">        for ind in self._transpose(self._idxfull(axes=axe)) :</span>
<span class="sd">            if ind not in tiidxfull :</span>
<span class="sd">                tiidxfull.append(ind)</span>
<span class="sd">                extvalfull.append(self._nullValue(type(extvalfull[0]), fillvalue))</span>
<span class="sd">        iidxfull = self._transpose(tiidxfull)&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">inplace</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extval</span> <span class="o">=</span> <span class="n">extvalfull</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>   <span class="o">=</span> <span class="n">iidxfull</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">Ilist</span><span class="p">(</span><span class="n">extvalfull</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">,</span> <span class="n">iidxfull</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">iadd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add other&#39;s values to self&#39;s values</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **other** : Ilist to be copied</span>
<span class="sd">        - **unique** :  boolean (default False) - If True and iidx present in tiidx,</span>
<span class="sd">        append is refuse.</span>

<span class="sd">        *Returns* : None&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">lenidx</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;the index lenght have to be equal&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">val</span><span class="p">,</span><span class="n">extidx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">textidx</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">extidx</span><span class="p">,</span> <span class="n">unique</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;idx&#39;</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;idx&#39;</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;value&#39;</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">valname</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;value&#39;</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valname</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">valname</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">iidxtoext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        convert an intind (value for each iidx) to an extind (value for each extidx).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **intind** : value for each iidx</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **list** : extind, value for each extidx&#39;&#39;&#39;</span>
        <span class="k">try</span> <span class="p">:</span>  <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">intind</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intind</span><span class="p">))]</span>
        <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">iloc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return extval corresponding to intind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **intind** : list - value for each iidx</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **object** : extval value &#39;&#39;&#39;</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="n">ival</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">intind</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s1">&#39;index not found&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">iseIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return True if extind is present in extidx.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extind** : list - value for each extidx</span>

<span class="sd">        *Returns* : boolean - True if found&#39;&#39;&#39;</span>
        <span class="n">intind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidxtoi</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">intind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">intind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">isiIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return True if intind is present in iidx.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **intind** : list - value for each iidx</span>

<span class="sd">        *Returns* : boolean - True if found&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">intind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">intind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">isValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extval</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return True if present in extval.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : value to test</span>

<span class="sd">        *Returns* : boolean - True if found&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">extval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return json dict or string.</span>

<span class="sd">        *Parameters (kwargs)*</span>

<span class="sd">        - **encoded** : boolean (default False) - choice for return format (bynary if True, dict else)</span>
<span class="sd">        - **encode_format** : string (default &#39;json&#39;) - choice for return format (json, bson or cbor)</span>
<span class="sd">        - **json_res_index** : default False - if True add the index to the value</span>
<span class="sd">        - **order** : default [] - list of ordered index</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **codif** : dict (default {}). Numerical value for string in CBOR encoder</span>

<span class="sd">        *Returns* : string or dict&#39;&#39;&#39;</span>

        <span class="c1">#option = kwargs | {&#39;bjson_bson&#39;: False} </span>
        <span class="n">option</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encode_format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;encoded&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;codif&#39;</span> <span class="p">:</span> <span class="p">{}}</span> <span class="o">|</span> <span class="n">kwargs</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_obj</span><span class="p">(</span><span class="o">**</span><span class="n">option</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return extval corresponding to extind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extind** : list - value for each extidx</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **object** : extval value &#39;&#39;&#39;</span>
        <span class="n">intind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidxtoi</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="n">ival</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">intind</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s1">&#39;index not found&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;merge&#39;</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Merge replaces Ilist objects included in extval data into its constituents.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **valname** : str (default &#39;merge&#39;) - name of the new Ilist object</span>
<span class="sd">        - **fillvalue** : object (default None) - value used for the new data </span>
<span class="sd">        (e.g. apply a new index to another Ilist)</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist** : merged Ilist &#39;&#39;&#39;</span>        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Ilist</span><span class="p">):</span> <span class="k">return</span> <span class="kc">None</span>
        <span class="n">idxname</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="o">+</span> <span class="p">[</span><span class="n">nam</span> <span class="k">for</span> <span class="n">il</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span> <span class="k">for</span> <span class="n">nam</span> <span class="ow">in</span> <span class="n">il</span><span class="o">.</span><span class="n">idxname</span><span class="p">])))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="s1">&#39;default index&#39;</span> <span class="ow">in</span> <span class="n">idxname</span><span class="p">:</span> <span class="n">idxname</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;default index&#39;</span><span class="p">)</span>
        <span class="n">extidx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">)))</span>
        <span class="n">extval</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">il</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">extval</span> <span class="o">+=</span> <span class="n">il</span><span class="o">.</span><span class="n">extval</span>
            <span class="k">for</span> <span class="n">nam</span> <span class="ow">in</span> <span class="n">idxname</span><span class="p">:</span>
                <span class="n">extiidx</span> <span class="o">=</span> <span class="n">extidx</span><span class="p">[</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nam</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">nam</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="ow">and</span> <span class="n">nam</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">il</span><span class="o">.</span><span class="n">idxname</span><span class="p">:</span>
                    <span class="n">extiidx</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nam</span><span class="p">)][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">il</span><span class="p">))]</span>                         
                <span class="k">elif</span> <span class="n">nam</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="ow">and</span> <span class="n">nam</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">il</span><span class="o">.</span><span class="n">idxname</span><span class="p">:</span>
                    <span class="n">extiidx</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fillvalue</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">il</span><span class="p">))]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">extiidx</span> <span class="o">+=</span> <span class="n">il</span><span class="o">.</span><span class="n">extidx</span><span class="p">[</span><span class="n">il</span><span class="o">.</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nam</span><span class="p">)]</span>                
        <span class="n">ilm</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">Iext</span><span class="p">(</span><span class="n">valname</span><span class="o">=</span><span class="n">valname</span><span class="p">,</span> <span class="n">extval</span><span class="o">=</span><span class="n">extval</span><span class="p">,</span> <span class="n">idxname</span><span class="o">=</span><span class="n">idxname</span><span class="p">,</span> <span class="n">extidx</span><span class="o">=</span><span class="n">extidx</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ilm</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Ilist</span><span class="p">):</span> 
            <span class="k">return</span> <span class="n">ilm</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">valname</span><span class="o">=</span><span class="n">valname</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">fillvalue</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">ilm</span>

    <span class="k">def</span> <span class="nf">mergeidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listidx</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a new index with tuple built from the indexes in listidx.</span>
<span class="sd">        Append the new index to ilist</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **listidx** : list - list of index row to be merged</span>

<span class="sd">        *Returns* : None&#39;&#39;&#39;</span>   
        <span class="n">name</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">listidx</span><span class="p">])</span>
        <span class="n">extidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">listidx</span><span class="p">])))</span>
        <span class="c1">#extidx = self._mergeidx([self.iidx[i] for i in listidx])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addextidx</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">extidx</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="k">def</span> <span class="nf">reindex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[],</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Define new sorted index.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **index** : list (default [])- list of the index to reindex.</span>
<span class="sd">        If [] all the index are reindexed.</span>

<span class="sd">        *Returns* : None&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span> <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">index</span> <span class="p">:</span>
            <span class="n">oldidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>   <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_reindexidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">oldidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">fast</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="p">[],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Change the order of extval and iidx with a new order define by sort</span>
<span class="sd">        (sort can be a subset of the items list).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **sort** : list (default [])- new record order to apply. If [], no change.</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **inplace** : boolean (default True) - if True, new order is apply to self,</span>
<span class="sd">        if False a new Ilist is created.</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **None**, if inplace. **Ilist** if not inplace&#39;&#39;&#39;</span>
        <span class="n">selfextidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span>
        <span class="n">extval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reorder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">sort</span><span class="p">)</span>
        <span class="n">iidx</span> <span class="o">=</span>  <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_reorder</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">sort</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">]</span>
        <span class="n">extidx</span> <span class="o">=</span>  <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_reorder</span><span class="p">(</span><span class="n">eidx</span><span class="p">,</span> <span class="n">sort</span><span class="p">)</span> <span class="k">for</span> <span class="n">eidx</span> <span class="ow">in</span> <span class="n">selfextidx</span><span class="p">]</span>
        <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="n">extidx</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inplace</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extval</span> <span class="o">=</span> <span class="n">extval</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>   <span class="o">=</span> <span class="n">iidx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span> <span class="o">=</span> <span class="n">setidx</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">Ilist</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        return setidx for the idx define by name</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **name** : str - name of the index in idxname </span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **List** : list if name in idxname, None else&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>
        <span class="k">return</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">setfilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setidxfilt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove values that does not match the indexes filter.</span>
<span class="sd">        The filter is a reduced list of indexes.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **setidxfilt** : list of lists (default None) - new reduced setidx. If None, no change.</span>
<span class="sd">        - **index** : boolean (default True) - indicates if setidxfilt is a list of values (False)</span>
<span class="sd">        or indexes (True).</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **inplace** : boolean (default True) - if True, new setidx is apply to self,</span>
<span class="sd">        if False a new Ilist is created.</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **None**, if inplace. **Ilist** if not inplace&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">setidxfilt</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">setidxfilt</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="p">:</span> <span class="k">return</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="n">lenidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span>
        <span class="k">if</span> <span class="n">index</span> <span class="p">:</span> <span class="n">setidxf</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">setidxfilt</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">setidxf</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">setidxfilt</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="n">sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isinset</span><span class="p">(</span><span class="n">tiidx</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">setidxf</span><span class="p">)]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="n">sort</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="p">[],</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">reindex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; sort : calculate a new list order</span>
<span class="sd">        Change the order of extval and iidx with a new order (order can be a subset of the items list).or a specific sort</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **order** : list (default [])- new order of index to apply. If [], the sort </span>
<span class="sd">        function is applied to extval.</span>
<span class="sd">        - **sort** : list (default [])- new order of resval to apply. If [], the new order</span>
<span class="sd">        is calculated.</span>
<span class="sd">        - **reindex** : boolean (default True) - if True, the index are reindexed.</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **inplace** : boolean (default True) - if True, new order is apply to self,</span>
<span class="sd">        if False a new Ilist is created.</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **None**, if inplace. **Ilist** if not inplace&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sortidx</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">sort</span><span class="p">,</span> <span class="n">reindex</span><span class="p">,</span> <span class="n">fast</span><span class="p">),</span> <span class="n">inplace</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sortidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">sort</span><span class="o">=</span><span class="p">[],</span> <span class="n">reindex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Define a new order to apply to extval and iidx (reorder method).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **order** : list (default [])- new order of index to apply in sort function.</span>
<span class="sd">        If [], the sort function is applied to extval.</span>
<span class="sd">        - **sort** : list (default [])- new order of resval to apply. If [], the new order</span>
<span class="sd">        is calculated.</span>
<span class="sd">        - **reindex** : boolean (default True) - if True, the index are reindexed.</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **list** : sort - new order to apply&#39;&#39;&#39;</span>
        <span class="c1">#if sorted(sort) == sorted(self.extval): return sort</span>
        <span class="k">if</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sort</span><span class="p">])</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">]):</span> <span class="k">return</span> <span class="n">sort</span>
        <span class="n">newsetidx</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">))]</span>
        <span class="n">newiidx</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_reindexidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">newsetidx</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">fast</span><span class="p">)</span>
                   <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">reindex</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="n">newiidx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span> <span class="o">=</span> <span class="n">newsetidx</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="p">:</span> <span class="n">idx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">newiidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">order</span><span class="p">]</span>
        <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">)</span>
        <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))))</span>
        <span class="k">return</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="n">idx</span><span class="p">)))[</span><span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">swapindex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Change the order of the index (iidx, setidx, idxname).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **order** : list - new order of index to apply.</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="c1">#if not isinstance(order, list) or len(order) != self.lenidx :</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;order lenght not correct&quot;</span><span class="p">)</span>
        <span class="n">iidx</span>    <span class="o">=</span> <span class="p">[]</span>
        <span class="n">setidx</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="n">idxname</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order</span> <span class="p">:</span>
            <span class="n">iidx</span><span class="o">.</span><span class="n">append</span>  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>  <span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">setidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">idxname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>   <span class="o">=</span> <span class="n">iidx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span> <span class="o">=</span> <span class="n">setidx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="o">=</span> <span class="n">idxname</span>

    <span class="sd">&quot;&quot;&quot;def to_bytes(self, encoded=True, bin_iidx=True):</span>
<span class="sd">        &#39;&#39;&#39;</span>
<span class="sd">        Generate a bytes Object</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **encoded** : boolean (default True) - if True return bson format, if False return dict.</span>
<span class="sd">        - **bin_iidx** : boolean (default True) - if True iidx is converted to bytes with numpy.tobytes method</span>

<span class="sd">        *Returns* : bytes ou dict &#39;&#39;&#39;</span>
<span class="sd">        dic = {}</span>
<span class="sd">        dic[self.valname] = Ilist._tobytes(self.extval, encoded=False)</span>
<span class="sd">        if bin_iidx:    dic[&#39;iidx&#39;] = np.array(self.iidx,  dtype=&#39;u2&#39;).tobytes()</span>
<span class="sd">        else:           dic[&#39;iidx&#39;] = self.iidx</span>
<span class="sd">        for i, name in enumerate(self.idxname) :</span>
<span class="sd">            dic[name] = Ilist._tobytes(self.setidx[i], encoded=False)</span>
<span class="sd">        if not encoded : return dic</span>
<span class="sd">        return bson.encode(dic)&quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate il file to display `Ilist` data.</span>

<span class="sd">         *Parameters (kwargs)*</span>

<span class="sd">        - **file** : string - file name (with path)</span>
<span class="sd">        - **kwargs** : see &#39;to_obj&#39; parameters</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Integer** : file lenght (bytes)  &#39;&#39;&#39;</span>
        <span class="n">option</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encode_format&#39;</span><span class="p">:</span> <span class="s1">&#39;cbor&#39;</span><span class="p">,</span> <span class="s1">&#39;json_res_index&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span> <span class="o">|</span> <span class="n">kwargs</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;encoded&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_obj</span><span class="p">(</span><span class="o">**</span><span class="n">option</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bson&#39;</span><span class="p">,</span> <span class="s1">&#39;cbor&#39;</span><span class="p">]:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">size</span>

    <span class="k">def</span> <span class="nf">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;ilist.csv&#39;</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ifunc</span><span class="o">=</span><span class="p">[],</span> <span class="n">valfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate a csv file with Ilist data (a column for extval and each extidx)</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **filename** : string (default &#39;ilist.csv&#39;) - name of the file to create</span>
<span class="sd">        - **func** : function (default none) - function to apply to extval before writting csv file</span>
<span class="sd">        - **ifunc** : list of function (default []) - function to apply to extidx</span>
<span class="sd">        before writting csv file</span>
<span class="sd">        - **valfirst** : boolean (default False). If False extval is the last columns,</span>
<span class="sd">         else it&#39;s the first</span>
<span class="sd">        - **order** : list of integer (default []) - ordered list of index in columns</span>
<span class="sd">        - **header** : boolean (default True). If True, the first raw is dedicated to names</span>
<span class="sd">        - **kwargs** : parameter for csv.writer or func</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span> <span class="n">order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONNUMERIC</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">extidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span>
            <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">valfirst</span>      <span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">order</span> <span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">valfirst</span>  <span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">)</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ifunc</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span> <span class="n">funci</span> <span class="o">=</span> <span class="n">func</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span> <span class="p">:</span> <span class="n">funci</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">valfirst</span>      <span class="p">:</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">func</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">order</span> <span class="p">:</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="n">extidx</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">funci</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">valfirst</span>  <span class="p">:</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">func</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">size</span>

    <span class="k">def</span> <span class="nf">to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="s1">&#39;axe&#39;</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Complete the Ilist and generate a Numpy array with the dimension define by ind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **func** : function (default none) - function to apply to extval before export</span>
<span class="sd">        - **ind** : string (default &#39;axe&#39;) - &#39;axe&#39; -&gt; independant axes,</span>
<span class="sd">        &#39;all&#39; -&gt; all axes, &#39;flat&#39; -&gt; one list</span>
<span class="sd">        - **fillvalue** : object (default &#39;?&#39;) - value used for the new extval</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **kwargs** : parameter for func</span>

<span class="sd">        *Returns* : </span>
<span class="sd">            </span>
<span class="sd">        - **np.array** : if ind=&#39;flat</span>
<span class="sd">        - **tuple (np.array, list of index)** : if ind = &#39;axe&#39; or &#39;all&#39;</span>
<span class="sd">        - **none** :  else&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">consistent</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;unable to generate numpy array with inconsistent Ilist&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ind</span> <span class="o">==</span> <span class="s1">&#39;flat&#39;</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tonumpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ind</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]</span>  <span class="p">:</span>
            <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="s1">&#39;axe&#39;</span> <span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span> <span class="c1">#!!!axes</span>
            <span class="k">else</span> <span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">))</span>
            <span class="n">ilf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">fillvalue</span><span class="p">)</span>
            <span class="n">ilf</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tonumpy</span><span class="p">(</span><span class="n">ilf</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">ilf</span><span class="o">.</span><span class="n">idxlen</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">]),</span>
                    <span class="p">[</span><span class="n">ilf</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">])</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">to_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return a formatted object with val (extval or ival) and idx (extidx or iidx or none).</span>
<span class="sd">        Format can be json, bson or cbor</span>
<span class="sd">        object can be string, bytes or dict</span>

<span class="sd">        *Parameters (kwargs)*</span>

<span class="sd">        - **encoded** : boolean (default False) - choice for return format (string/bytes if True, dict else)</span>
<span class="sd">        - **encode_format**  : string (default &#39;json&#39;)- choice for return format (bson, json, cbor)</span>
<span class="sd">        - **json_res_index** : default False - if True add the index to the value</span>
<span class="sd">        - **order** : default [] - list of ordered index</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **codif** : dict (default ES.codeb). Numerical value for string in CBOR encoder</span>

<span class="sd">        *Returns* : string, bytes or dict&#39;&#39;&#39;</span>
        <span class="n">option</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encoded&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;encode_format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span>  <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="p">[],</span>
                  <span class="s1">&#39;json_res_index&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;fast&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;codif&#39;</span><span class="p">:</span> <span class="p">{}}</span> <span class="o">|</span> <span class="n">kwargs</span>
        <span class="n">option2</span> <span class="o">=</span> <span class="n">option</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;encoded&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="n">optidxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">complete</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;json_res_index&#39;</span><span class="p">]</span>
        <span class="n">nulres</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valname</span> <span class="o">==</span> <span class="s1">&#39;default value&#39;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span>
        <span class="c1">#print(&#39;optidxref nulres &#39;, optidxref, nulres)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]:</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">))</span>
        <span class="c1">#if not nulres and (option[&#39;order&#39;] == list(range(self.lenidx)) or optidxref):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nulres</span> <span class="ow">and</span> <span class="n">optidxref</span><span class="p">:</span>
            <span class="n">ils</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">option</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ils</span><span class="o">.</span><span class="n">swapindex</span><span class="p">(</span><span class="n">option</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">ils</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">js</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">js</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;fast&#39;</span><span class="p">]</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ils</span><span class="o">.</span><span class="n">setidx</span><span class="p">)):</span> 
                <span class="k">if</span> <span class="n">ils</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;default index&#39;</span><span class="p">:</span> <span class="n">js</span><span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ils</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="c1">#js[ils.idxname[i]] = ils.setidx[i]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nulres</span><span class="p">:</span> <span class="n">js</span><span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">valname</span><span class="p">]</span> <span class="o">=</span> <span class="n">ils</span><span class="o">.</span><span class="n">extval</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ils</span><span class="o">.</span><span class="n">setidx</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">ils</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;default index&#39;</span><span class="p">:</span> <span class="n">js</span><span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_json</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="o">**</span><span class="n">option2</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">ils</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="c1">#js[ils.idxname[i]] = [self._json(idx, **option2) for idx in ils.setidx[i]]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nulres</span><span class="p">:</span> 
                <span class="n">js</span><span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">valname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_json</span><span class="p">(</span><span class="n">ils</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">**</span><span class="n">option2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ils</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">optidxref</span><span class="p">:</span>
            <span class="n">dicidxref</span> <span class="o">=</span> <span class="n">ils</span><span class="o">.</span><span class="n">dicidxref</span>
            <span class="k">if</span> <span class="n">dicidxref</span> <span class="p">:</span> <span class="n">js</span><span class="p">[</span><span class="s1">&#39;idxref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dicidxref</span>
        <span class="c1">#elif option[&#39;encoded&#39;] and option[&#39;bjson_bson&#39;] and not nulres:</span>
        <span class="k">elif</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;bson&#39;</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encoded&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">nulres</span><span class="p">:</span>
            <span class="n">js</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ils</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ils</span><span class="o">.</span><span class="n">axesmulti</span><span class="p">],</span>  <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;u2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
            <span class="c1">#js[&#39;index&#39;] = np.array(ils.iidx,  dtype=&#39;u2&#39;).tobytes()</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">nulres</span><span class="p">:</span> <span class="n">js</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ils</span><span class="o">.</span><span class="n">axesmulti</span><span class="p">]</span>
        <span class="c1">#elif not nulres: js[&#39;index&#39;] = [ils.iidx[i] if i in ils.axesmulti else [0] for i in ils.axesall]</span>
        <span class="c1">#elif not nulres: js[&#39;index&#39;] = ils.iidx</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;codif&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;bson&#39;</span><span class="p">:</span>
            <span class="n">js2</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">js</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;codif&#39;</span><span class="p">]:</span> <span class="n">js2</span><span class="p">[</span><span class="n">option</span><span class="p">[</span><span class="s1">&#39;codif&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">js2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">js2</span> <span class="o">=</span> <span class="n">js</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encoded&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span> 
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span> <span class="n">js2</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">IlistEncoder</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encoded&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bson&#39;</span><span class="p">:</span> 
            <span class="k">return</span> <span class="n">bson</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">js2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encoded&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;cbor&#39;</span><span class="p">:</span> 
            <span class="k">return</span> <span class="n">cbor2</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">js2</span><span class="p">,</span> <span class="n">datetime_as_timestamp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                               <span class="n">timezone</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">,</span> <span class="n">canonical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">js2</span>

    <span class="k">def</span> <span class="nf">to_xarray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[],</span> <span class="n">dimmax</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                  <span class="n">ifunc</span><span class="o">=</span><span class="p">[],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ilist&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Complete the Ilist and generate a Xarray DataArray with the dimension define by ind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **info** : boolean (default False) - if True, add _dict attributes to attrs Xarray</span>
<span class="sd">        - **axes** : list (default []) - list of index to be completed. If [],</span>
<span class="sd">        self.axes is used.</span>
<span class="sd">        - **dimmax** : int (default -1) - max Xarray dimension (only if axes=[])</span>
<span class="sd">        - **fillvalue** : object (default &#39;?&#39;) - value used for the new extval</span>
<span class="sd">        - **func** : function (default none) - function to apply to extval before export</span>
<span class="sd">        - **ifunc** : list of function (default []) - function to apply to</span>
<span class="sd">        extidx before export</span>
<span class="sd">        - **name** : string (default &#39;Ilist&#39;) - DataArray name</span>
<span class="sd">        - **kwargs** : parameter for func and ifunc</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">consistent</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;Ilist not consistent&quot;</span><span class="p">)</span>
        <span class="n">lenidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span>
        <span class="k">if</span> <span class="n">axes</span><span class="o">==</span><span class="p">[]</span> <span class="p">:</span> 
            <span class="n">axe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span>
            <span class="n">coup</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axe</span><span class="p">)</span> <span class="o">-</span> <span class="n">dimmax</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">coup</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">coup</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">axe</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mergeidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axescoupling</span><span class="p">(</span><span class="n">axe</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">coup</span><span class="p">])</span>
                <span class="n">axe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="n">ilf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axe</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">fillvalue</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swapindex</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)))</span>
        <span class="n">ilf</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">ilf</span><span class="o">.</span><span class="n">_xcoord</span><span class="p">(</span><span class="n">axe</span><span class="p">,</span> <span class="n">ifunc</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="n">ilf</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ilf</span><span class="o">.</span><span class="n">_tonumpy</span><span class="p">(</span><span class="n">ilf</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">ilf</span><span class="o">.</span><span class="n">idxlen</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">info</span> <span class="p">:</span> <span class="k">return</span> <span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">ilf</span><span class="o">.</span><span class="n">_dict</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">unconsistent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return a key/value dict with the number of occurences (value) for each</span>
<span class="sd">        indice-tuple (key) with multi-occurences&#39;&#39;&#39;</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="c1">#act = {tuple(self._indtoext(list(it))) for it in Counter(self._tuple(tiidx)).items() if it[1] &gt;1}</span>
        <span class="k">return</span> <span class="p">{</span><span class="nb">tuple</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_indtoext</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">])))):</span> <span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
                <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tuple</span><span class="p">(</span><span class="n">tiidx</span><span class="p">))</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span><span class="mi">1</span><span class="p">}</span>
        <span class="c1">#return dict(self._list(act))</span>

    <span class="k">def</span> <span class="nf">updateidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indval</span><span class="p">,</span> <span class="n">extind</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update the index of an extval.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **indval** : integer - row of the value in extval</span>
<span class="sd">        - **extind** : list - new value for each extidx</span>
<span class="sd">        - **unique** :  boolean (default False) - If True and extind present in textidx,</span>
<span class="sd">        update is refuse.</span>

<span class="sd">        *Returns* : none&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="ow">or</span> <span class="n">indval</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">indval</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;out of bounds&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iseIndex</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span> <span class="ow">and</span> <span class="n">unique</span> <span class="p">:</span> <span class="k">return</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="n">tiidx</span><span class="p">[</span><span class="n">indval</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateset</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="n">tiidx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">updatelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extlist</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update extval or extidx.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extlist** : list of list - list of values to update</span>
<span class="sd">        - **idx** : list of integer - list of index to update (idx=-1 for extval)</span>

<span class="sd">        *Returns* : none&#39;&#39;&#39;</span>
        <span class="n">extlis</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkidxlist</span><span class="p">(</span><span class="n">extlist</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">extlis</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;out of bounds&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">extl</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">extlis</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">extval</span>      <span class="o">=</span> <span class="n">extl</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">extl</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toint</span><span class="p">(</span><span class="n">extl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">vlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Apply a function to extval or extidx and return the result.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **func** : function (default none) - function to apply to extval or extidx</span>
<span class="sd">        - **args, kwargs** : parameters for the function</span>
<span class="sd">        - **idx** : integer - index to update (idx=-1 for extval)</span>

<span class="sd">        *Returns* : list of func result&#39;&#39;&#39;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkidxlist</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">extidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="n">extidx</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c1">#%% internal</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_cast</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; convert val in the type defined by the string dtype&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dtype</span> <span class="p">:</span>      <span class="k">return</span> <span class="n">val</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span>      <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="c1">#if val.lstrip() == &#39;&#39; and dtype in [&#39;int&#39;, &#39;float&#39;]: return 0</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
            <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;float&#39;</span><span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
            <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;datetime&#39;</span><span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="c1">#except : return datetime.datetime.min</span>
            <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;coord&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_c1</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_c2</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_c1</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">val</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_c2</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">val</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])]</span>
            <span class="k">else</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;dtype : &quot;</span> <span class="o">+</span> <span class="n">dtype</span> <span class="o">+</span> <span class="s2">&quot; inconsistent with data&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_checkidxlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listidx</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; check if listidx and idx are consistent and return a list for each&#39;&#39;&#39;</span>
        <span class="c1"># idx=-1 -&gt; val</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="p">:</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>    <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>                <span class="n">index</span> <span class="o">=</span>  <span class="n">idx</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;index out of bounds&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">listidx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="k">return</span> <span class="n">index</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">listidx</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;listindex not a list&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">listidx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span>   <span class="n">listindex</span> <span class="o">=</span> <span class="p">[</span><span class="n">listidx</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>                          <span class="n">listindex</span> <span class="o">=</span>  <span class="n">listidx</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">listindex</span><span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;listindex out of bounds&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">listindex</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_coupled</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">l2</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return boolean if l2 is coupled to ref&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_idxlink</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">l2</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_couplinginfo</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the coupling info between two list (dict)&#39;&#39;&#39;</span>
        <span class="n">set1</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span>
        <span class="n">set2</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">set1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">set2</span><span class="p">))</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">set1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">set2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">set1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">set2</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;distlinked&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;distcrossed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;distmin&#39;</span><span class="p">:</span> <span class="n">x0</span><span class="p">,</span> <span class="s1">&#39;distmax&#39;</span><span class="p">:</span> <span class="n">x1</span><span class="p">}</span>
        <span class="n">set3</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_toset</span><span class="p">([</span><span class="nb">tuple</span><span class="p">((</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">))</span> <span class="k">for</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">)])</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">set3</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">),</span>
                <span class="s1">&#39;disttomin&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">set3</span><span class="p">)</span> <span class="o">-</span> <span class="n">x0</span><span class="p">,</span>
                <span class="s1">&#39;disttomax&#39;</span><span class="p">:</span> <span class="n">x1</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">set3</span><span class="p">),</span>
                <span class="s1">&#39;distmin&#39;</span><span class="p">:</span> <span class="n">x0</span><span class="p">,</span> <span class="s1">&#39;distmax&#39;</span><span class="p">:</span> <span class="n">x1</span><span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_derived</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">l2</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return boolean if ref is derived from l2&#39;&#39;&#39;</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_tuple</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_transpose</span><span class="p">([</span><span class="n">ref</span><span class="p">,</span> <span class="n">l2</span><span class="p">])))</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">l2</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">l2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addproperty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">addaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">addlist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">addother</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">long</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the value of the properties&#39;&#39;&#39;</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;valname&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">,</span> <span class="s1">&#39;idxname&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">addproperty</span> <span class="p">:</span>
            <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;complete&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">complete</span><span class="p">,</span><span class="s1">&#39;completefull&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">completefull</span><span class="p">,</span> <span class="s1">&#39;consistent&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">consistent</span><span class="p">,</span>
                    <span class="s1">&#39;dimension&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">,</span> <span class="s1">&#39;lenidx&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">,</span> <span class="s1">&#39;len&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                    <span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">,</span> <span class="s1">&#39;setvallen&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">setvallen</span> <span class="p">}</span>
        <span class="k">if</span> <span class="n">addaxes</span><span class="p">:</span>
            <span class="n">lenidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span>
            <span class="n">idxcoupled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxcoupled</span>
            <span class="n">idxderived</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxderived</span>
            <span class="n">idxunique</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxunique</span>
            <span class="n">idxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxref</span>
            <span class="n">idxder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxder</span>
            <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;primary axes&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">idxcoupled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">idxunique</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">idxderived</span><span class="p">[</span><span class="n">i</span><span class="p">]]}</span>
            <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;single axes&#39;</span>  <span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)</span> <span class="k">if</span> <span class="n">idxunique</span><span class="p">[</span><span class="n">i</span><span class="p">]]}</span>
            <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;coupled axes&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &lt;-&gt; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>  
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)</span> <span class="k">if</span> <span class="n">idxcoupled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">idxunique</span><span class="p">[</span><span class="n">i</span><span class="p">]]}</span>
            <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;derived axes&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;  -&gt; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">idxder</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                                      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)</span> <span class="k">if</span> <span class="n">idxderived</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">idxunique</span><span class="p">[</span><span class="n">i</span><span class="p">]]}</span>
            <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;minimal axes&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span><span class="p">]}</span>   
        <span class="k">if</span> <span class="n">long</span> <span class="p">:</span>
            <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;extval&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="s1">&#39;iidx&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">,</span> <span class="s1">&#39;setidx&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span> <span class="p">}</span>
        <span class="k">if</span> <span class="n">addlist</span> <span class="p">:</span>
            <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;axes&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="s1">&#39;axeslen&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">axeslen</span><span class="p">,</span> <span class="s1">&#39;axesmin&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span><span class="p">,</span>
            <span class="s1">&#39;idxcoupled&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">idxcoupled</span><span class="p">,</span> <span class="s1">&#39;idxderived&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">idxderived</span><span class="p">,</span> <span class="s1">&#39;idxlen&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span><span class="p">,</span>
            <span class="s1">&#39;idxunique&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">idxunique</span><span class="p">,</span> <span class="s1">&#39;idxder&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">idxder</span><span class="p">,</span> <span class="s1">&#39;idxref&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">idxref</span><span class="p">,</span>
            <span class="s1">&#39;minMaxIndex&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">minMaxIndex</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">long</span> <span class="p">:</span>
                <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span> <span class="s1">&#39;extidx&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">,</span> <span class="s1">&#39;ind&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">ind</span><span class="p">,</span> <span class="s1">&#39;ival&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">ival</span><span class="p">,</span>
                        <span class="s1">&#39;setval&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">setval</span><span class="p">,</span> <span class="s1">&#39;tiidx&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span><span class="p">,</span> <span class="s1">&#39;textidx&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">textidx</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">addother</span><span class="p">:</span>
                <span class="n">dic</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;axesall&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">axesall</span><span class="p">,</span> <span class="s1">&#39;lencomplete&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">lencomplete</span><span class="p">,</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">dic</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_filter</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">lis</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;apply &quot;func&quot; to each value of &quot;lis&quot; and tests if equals &quot;res&quot;.</span>
<span class="sd">        Return the list of index with True result.&#39;&#39;&#39;</span>
        <span class="n">lisf</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="n">lis</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">))</span> <span class="k">if</span> <span class="n">lisf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">res</span><span class="p">]</span>

    <span class="sd">&#39;&#39;&#39;@staticmethod</span>
<span class="sd">    def _frombytes(listbson):</span>
<span class="sd">        if not isinstance(listbson, list) :</span>
<span class="sd">            raise IlistError(&quot;the object to convert is not a list&quot;)</span>
<span class="sd">        listvalue = []</span>
<span class="sd">        for bs in listbson :</span>
<span class="sd">            if isinstance(bs, (int, str, float, bool, list, datetime.datetime, type(None))) :</span>
<span class="sd">                listvalue.append(bs)</span>
<span class="sd">            elif isinstance(bs, dict) :</span>
<span class="sd">                try: listvalue.append(eval(list(bs.keys())[0])(bs[list(bs.keys())[0]]))</span>
<span class="sd">                except: listvalue.append(bs)</span>
<span class="sd">            else :</span>
<span class="sd">                try :</span>
<span class="sd">                    dic = bson.decode(bs)</span>
<span class="sd">                    listvalue.append(eval(list(dic.keys())[0])(dic[list(dic.keys())[0]]))</span>
<span class="sd">                except : raise IlistError(&quot;impossible to decode a bson object&quot;)</span>
<span class="sd">        return listvalue&#39;&#39;&#39;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_funclist</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the function func applied to the object value with parameters args and kwargs&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[])</span> <span class="p">:</span> <span class="k">return</span> <span class="n">value</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="n">listval</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">listval</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">listval</span> <span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> <span class="n">lis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">:</span>
                <span class="k">try</span> <span class="p">:</span> <span class="n">lis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="k">except</span> <span class="p">:</span>
                    <span class="k">try</span> <span class="p">:</span> <span class="n">lis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">listval</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                    <span class="k">except</span> <span class="p">:</span>
                        <span class="k">try</span> <span class="p">:</span> <span class="n">lis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">listval</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                        <span class="k">except</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;unable to apply func&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> <span class="k">return</span> <span class="n">lis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">lis</span>

    <span class="k">def</span> <span class="nf">_idxfilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">):</span>
        <span class="c1"># méthode à conserver (attr : extidx, iidx, setidx) ??</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;extidx&#39;</span><span class="p">,</span> <span class="s1">&#39;iidx&#39;</span><span class="p">,</span> <span class="s1">&#39;setidx&#39;</span><span class="p">]</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;attr not supported&quot;</span><span class="p">)</span>
        <span class="n">listidx</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">try</span> <span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">listidx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">func</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;function not available with the index&quot;</span><span class="p">)</span>
        <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listidx</span><span class="p">))</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">listidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">func</span><span class="p">)(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">except</span> <span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listidx</span><span class="p">))</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">listidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">func</span><span class="p">)(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="k">except</span> <span class="p">:</span>
                <span class="k">try</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listidx</span><span class="p">))</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">listidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">func</span><span class="p">)(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span>
                <span class="k">except</span> <span class="p">:</span> <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_idxfull</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[]):</span> <span class="c1">#!!!!!!</span>
        <span class="sd">&#39;&#39;&#39;return additional iidx with full index in the axes&#39;&#39;&#39;</span>
        <span class="c1">#if    axes==[] : axe = [i for i in range(self.lenidx) if not self.idxcoupled[i]]</span>
        <span class="k">if</span>    <span class="n">axes</span><span class="o">==</span><span class="p">[]</span> <span class="p">:</span> <span class="n">axe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span>
        <span class="k">else</span>           <span class="p">:</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="n">iidxr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">]</span>
        <span class="n">lenfull</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_mul</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">iidxr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iidxr</span><span class="p">))])</span>
        <span class="k">if</span> <span class="n">lenfull</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[]</span>
        <span class="c1">#if [len(iidxr[i]) for i in range(len(iidxr))] == self.idxlen: return []</span>
        <span class="n">cnind</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">iidxr</span><span class="p">)))</span> <span class="c1"># tiidx réduit aux axes et complet</span>
        <span class="n">cnind</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">]))))</span>
        <span class="n">iidxadd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cnind</span><span class="o">.</span><span class="n">elements</span><span class="p">())))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">iidxadd</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[]</span>
        <span class="n">iidxfull</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="n">lenidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span>
        <span class="n">idxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxref</span>
        <span class="c1">#idxcoupled = self.idxcoupled</span>
        <span class="n">idxcoupled</span> <span class="o">=</span> <span class="p">[</span><span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="n">idxder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxder</span>
        <span class="c1">#idxderived = self.idxderived</span>
        <span class="n">idxderived</span> <span class="o">=</span> <span class="p">[</span><span class="n">idxder</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="n">idxunique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxunique</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">axe</span> <span class="p">:</span>
                <span class="n">iidxfull</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">iidxadd</span><span class="p">[</span><span class="n">axe</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span>
            <span class="k">elif</span> <span class="n">idxunique</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="p">:</span>
                <span class="n">iidxfull</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iidxadd</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
            <span class="k">elif</span> <span class="n">idxcoupled</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">and</span> <span class="n">idxref</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">:</span>
                <span class="n">dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idxlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idxref</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="n">iidxfull</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iidxadd</span><span class="p">[</span><span class="n">axe</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idxref</span><span class="p">[</span><span class="n">idx</span><span class="p">])]]</span>
            <span class="k">elif</span> <span class="n">idxderived</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">and</span> <span class="n">idxder</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">:</span>
                <span class="n">dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idxlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idxder</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">coupled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">iidxfull</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iidxadd</span><span class="p">[</span><span class="n">axe</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idxder</span><span class="p">[</span><span class="n">idx</span><span class="p">])]]</span>
            <span class="k">else</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;index : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; have to be in axes&quot;</span> <span class="p">)</span>
            <span class="sd">&#39;&#39;&#39;if idx in axe :</span>
<span class="sd">                iidxfull[idx] = iidxadd[axe.index(idx)]</span>
<span class="sd">            elif idx not in axe and idxcoupled[idx] and idxref[idx] in axe:</span>
<span class="sd">                dic = self._idxlink(self.iidx[idxref[idx]], self.iidx[idx])</span>
<span class="sd">                iidxfull[idx] = [dic[i] for i in iidxadd[axe.index(idxref[idx])]]</span>
<span class="sd">            elif idx not in axe and not idxcoupled[idx] and not idxunique[idx] \</span>
<span class="sd">                and idxderived[idx] and idxder[idx] in axe:</span>
<span class="sd">                dic = self._idxlink(self.iidx[idxder[idx]], self.iidx[idx], coupled=False)</span>
<span class="sd">                iidxfull[idx] = [dic[i] for i in iidxadd[axe.index(idxder[idx])]]</span>
<span class="sd">            elif idx not in axe and not idxcoupled[idx] and idxunique[idx] :</span>
<span class="sd">                iidxfull[idx] = [self.iidx[idx][0] for i in range(len(iidxadd[0]))]</span>
<span class="sd">            else : raise IlistError(&quot;index : &quot; + str(idx) + &quot; have to be in axes&quot; )&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">iidxfull</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_idxlink</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">coupled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">derived</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return dic ={ref i : l2 i} pour chaque tuple différent&#39;&#39;&#39;</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_tuple</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_transpose</span><span class="p">([</span><span class="n">ref</span><span class="p">,</span> <span class="n">l2</span><span class="p">])))</span>
        <span class="k">if</span> <span class="n">coupled</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">l2</span><span class="p">))</span> <span class="p">:</span> <span class="k">return</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">derived</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span> <span class="p">:</span> <span class="k">return</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_index</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the index of val in idx&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="k">return</span> <span class="n">idx</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">idx</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_indtoext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return ext value for an indice&#39;&#39;&#39;</span>
        <span class="n">lenidx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">ind</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_isinset</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">setidxfilt</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; tests if each index value in &quot;ind&quot; is present in the list of indexes &quot;setidxfilt&quot;&#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">setidxfilt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_json</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">option</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return the json format of val (if function json() or to_json() exists&#39;&#39;&#39;</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encoded&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">IlistEncoder</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encoded&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bson&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="n">bson</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">bytes</span><span class="p">))</span> <span class="p">:</span> <span class="k">return</span> <span class="n">val</span>
            <span class="k">else</span> <span class="p">:</span> <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="o">**</span><span class="n">option</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span>     <span class="p">:</span> <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="o">**</span><span class="n">option</span><span class="p">)</span>
            <span class="k">except</span>  <span class="p">:</span> <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="o">**</span><span class="n">option</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_list</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span> <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">idx</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_mul</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
        <span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span> <span class="p">:</span> <span class="n">mul</span> <span class="o">*=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">mul</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_nullValue</span><span class="p">(</span><span class="n">Class</span><span class="p">,</span> <span class="n">fillvalue</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fillvalue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">fillvalue</span>
        <span class="c1">#if isinstance(fillvalue, Class) : return fillvalue</span>
        <span class="k">if</span> <span class="n">Class</span> <span class="o">==</span> <span class="nb">int</span>                 <span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">Class</span> <span class="o">==</span> <span class="nb">float</span>               <span class="p">:</span> <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Class</span> <span class="o">==</span> <span class="nb">str</span>                 <span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;-&#39;</span>
        <span class="k">if</span> <span class="n">Class</span> <span class="o">==</span> <span class="nb">bool</span>                <span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">Class</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_reindexidx</span><span class="p">(</span><span class="n">iidx</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">newsetidx</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">fast</span> <span class="p">:</span>
            <span class="n">dic</span><span class="o">=</span> <span class="p">{</span><span class="n">newsetidx</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">newsetidx</span><span class="p">))}</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="n">setidx</span><span class="p">[</span><span class="n">indb</span><span class="p">]]</span> <span class="k">for</span> <span class="n">indb</span> <span class="ow">in</span> <span class="n">iidx</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">newsetidx</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">setidx</span><span class="p">[</span><span class="n">indb</span><span class="p">])</span> <span class="k">for</span> <span class="n">indb</span> <span class="ow">in</span> <span class="n">iidx</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_reorder</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">if</span> <span class="n">sort</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span> <span class="k">return</span> <span class="n">val</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">sort</span><span class="p">]</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_resetidx</span><span class="p">(</span><span class="n">extidx</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return setidx and iidx from extidx&#39;&#39;&#39;</span>
        <span class="n">setidx</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">extidx</span><span class="p">]</span>
        <span class="n">iidx</span>   <span class="o">=</span> <span class="p">[</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_toint</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">setind</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">setind</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">extidx</span><span class="p">,</span> <span class="n">setidx</span><span class="p">)]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">)</span>

    <span class="sd">&#39;&#39;&#39;@staticmethod</span>
<span class="sd">    def _setable(extv):</span>
<span class="sd">        try :</span>
<span class="sd">            set(extv)</span>
<span class="sd">            return extv</span>
<span class="sd">        except :</span>
<span class="sd">            return Ilist._tuple(extv)&#39;&#39;&#39;</span>

    <span class="sd">&#39;&#39;&#39;@staticmethod</span>
<span class="sd">    def _tobytes(listvalue, encoded=True):</span>
<span class="sd">        res = []</span>
<span class="sd">        if not isinstance(listvalue, list) :</span>
<span class="sd">            raise IlistError(&quot;the objetc to convert to bytes is not a list&quot;)</span>
<span class="sd">        for value in listvalue :</span>
<span class="sd">            if isinstance(value, (int, str, float, bool, list, dict, datetime.datetime, type(None), bytes)):</span>
<span class="sd">                res.append(value)</span>
<span class="sd">            else :</span>
<span class="sd">                try : res.append(value.__to_bytes__(encoded=encoded))</span>
<span class="sd">                except : raise IlistError(&quot;impossible to apply __to_bytes__ method to object &quot;</span>
<span class="sd">                                          + str(type(value)))</span>
<span class="sd">        return res&#39;&#39;&#39;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_str</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_toint</span><span class="p">(</span><span class="n">extv</span><span class="p">,</span> <span class="n">extset</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return index of extv in extset&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">fast</span> <span class="p">:</span>
            <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span><span class="n">extset</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extset</span><span class="p">))}</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">extv</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">extset</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">extv</span><span class="p">]</span>
        <span class="sd">&#39;&#39;&#39;if not extv : return []</span>
<span class="sd">        ext = Ilist._setable(extv)</span>
<span class="sd">        if isinstance(ext[0], tuple) : return [extset.index(list(val)) for val in ext]</span>
<span class="sd">        return [extset.index(val) for val in ext]&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_toival</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extval</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return index of extval&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setval</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_toext</span><span class="p">(</span><span class="n">iidx</span><span class="p">,</span> <span class="n">extset</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a list of extset[idx] for idx in iidx&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">extset</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">iidx</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_tonumpy</span><span class="p">(</span><span class="n">lis</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">identity</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">func</span> <span class="o">=</span> <span class="n">identity</span>
        <span class="k">if</span> <span class="n">func</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span> <span class="p">:</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">))))</span>
        <span class="n">valList</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="n">lis</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">valList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span> <span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">valList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">valList</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">valList</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">valList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="p">:</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">valList</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">valList</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_toset</span><span class="p">(</span><span class="n">extv</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fast</span> <span class="p">:</span> <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">extv</span><span class="p">))</span>
        <span class="n">setidx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">extv</span> <span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">setidx</span> <span class="p">:</span> <span class="n">setidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">setidx</span>
        <span class="sd">&#39;&#39;&#39;ext = Ilist._setable(extv)</span>
<span class="sd">        setext = list(set(ext))</span>
<span class="sd">        if setext == [] or not isinstance(setext[0], tuple): return setext</span>
<span class="sd">        return list(map(list, setext))&#39;&#39;&#39;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_transpose</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s1">&#39;index not transposable&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="p">[[</span><span class="n">ix</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_tuple</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">[</span><span class="n">val</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>
    <span class="c1">#def _tuple(idx): return list(map(tuple, idx))</span>

    <span class="k">def</span> <span class="nf">_updateset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extind</span><span class="p">):</span>
        <span class="c1"># ajouter à la fin un recalcul de iidx en fonction de sorted(extset)</span>
        <span class="n">iind</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extind</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">if</span> <span class="n">extind</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extind</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">iind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">extind</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">iind</span>

    <span class="k">def</span> <span class="nf">_xcoord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axe</span><span class="p">,</span> <span class="n">funcidx</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&#39;&#39;&#39; Coords generation for Xarray&#39;&#39;&#39;</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">idxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxref</span>
        <span class="n">idxunique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxunique</span>
        <span class="n">idxcoupled</span> <span class="o">=</span> <span class="p">[</span><span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="n">idxder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxder</span>
        <span class="n">idxderived</span> <span class="o">=</span> <span class="p">[</span><span class="n">idxder</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idxunique</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">funcidx</span><span class="o">==</span><span class="p">[]</span> <span class="p">:</span> <span class="n">funci</span><span class="o">=</span><span class="n">identity</span>
            <span class="k">else</span> <span class="p">:</span> <span class="n">funci</span><span class="o">=</span> <span class="n">funcidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axe</span> <span class="p">:</span>
                <span class="n">xlisti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tonumpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">func</span><span class="o">=</span><span class="n">funci</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">xlisti</span>
            <span class="k">elif</span> <span class="n">idxcoupled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">:</span>
                <span class="n">xlisti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tonumpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xderived</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">func</span><span class="o">=</span><span class="n">funci</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">idxref</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">xlisti</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxderived</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">idxder</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">:</span>
                <span class="n">xlisti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tonumpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xderived</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">idxder</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">func</span><span class="o">=</span><span class="n">funci</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">coord</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">idxder</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">xlisti</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;index : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; have to be in axes&quot;</span> <span class="p">)</span>
            <span class="sd">&#39;&#39;&#39;if idxunique[i] : continue</span>
<span class="sd">            if funcidx==[] : funci=identity</span>
<span class="sd">            else : funci= funcidx[i]</span>
<span class="sd">            if   idxcoupled[i] :</span>
<span class="sd">                xlisti = self._tonumpy(self._xderived(i, idxref[i]), func=funci, **kwargs)</span>
<span class="sd">                coord[self.idxname[i]] = (self.idxname[idxref[i]], xlisti)</span>
<span class="sd">            elif self.idxderived[i] :</span>
<span class="sd">                xlisti = self._tonumpy(self._xderived(i, idxder[i]), func=funci, **kwargs)</span>
<span class="sd">                coord[self.idxname[i]] = (self.idxname[idxder[i]], xlisti)</span>
<span class="sd">            else :</span>
<span class="sd">                xlisti = self._tonumpy(self.setidx[i], func=funci, **kwargs)</span>
<span class="sd">                coord[self.idxname[i]] = xlisti&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">coord</span>

    <span class="k">def</span> <span class="nf">_xderived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idxder</span><span class="p">,</span> <span class="n">idxori</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idxlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">[</span><span class="n">idxori</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">[</span><span class="n">idxder</span><span class="p">],</span> <span class="n">coupled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">idxori</span><span class="p">]]</span>
</pre></div>

        </details>

            <div class="docstring"><p>An <code><a href="#Ilist">Ilist</a></code> is a representation of an indexed list (a list is indexed by others list).
E.g. python zip or csv file.</p>

<p><em>Attributes (for @property see methods)</em> :</p>

<ul>
<li><strong>extval</strong> : list of data to be indexed</li>
<li><strong>valname</strong> : name of the extval list</li>
<li><strong>setval</strong> : list of the different extval values (dynamic value)</li>
<li><strong>ival</strong> : index of the extval (dynamic value)</li>
<li><strong>extidx</strong> : list of index (dynamic value)</li>
<li><strong>idxname</strong> : list of the index name</li>
<li><strong>setidx</strong> : list of the different idxval values</li>
<li><strong>iidx</strong> : index of the extidx list of values</li>
</ul>

<p>The methods defined in this class are :</p>

<p><em>constructor (classmethod))</em></p>

<ul>
<li><code><a href="#Ilist.Iidic">Ilist.Iidic</a></code></li>
<li><code><a href="#Ilist.Iext">Ilist.Iext</a></code></li>
<li><code><a href="#Ilist.Iidx">Ilist.Iidx</a></code></li>
<li><code><a href="#Ilist.Iset">Ilist.Iset</a></code></li>
<li><code><a href="#Ilist.Izip">Ilist.Izip</a></code></li>
</ul>

<p><em>dynamic value property (getters)</em></p>

<ul>
<li><code><a href="#Ilist.ival">Ilist.ival</a></code></li>
<li><code><a href="#Ilist.setval">Ilist.setval</a></code></li>
<li><code><a href="#Ilist.extidx">Ilist.extidx</a></code></li>
<li><code><a href="#Ilist.tiidx">Ilist.tiidx</a></code></li>
<li><code><a href="#Ilist.textidx">Ilist.textidx</a></code></li>
</ul>

<p><em>global property (getters)</em></p>

<ul>
<li><code><a href="#Ilist.axes">Ilist.axes</a></code></li>
<li><code><a href="#Ilist.axesall">Ilist.axesall</a></code></li>
<li><code><a href="#Ilist.axesmin">Ilist.axesmin</a></code></li>
<li><code><a href="#Ilist.axesmono">Ilist.axesmono</a></code></li>
<li><code><a href="#Ilist.axesmulti">Ilist.axesmulti</a></code></li>
<li><code><a href="#Ilist.complete">Ilist.complete</a></code></li>
<li><code><a href="#Ilist.completefull">Ilist.completefull</a></code></li>
<li><code><a href="#Ilist.consistent">Ilist.consistent</a></code></li>
<li><code><a href="#Ilist.dimension">Ilist.dimension</a></code></li>
<li><code><a href="#Ilist.lencomplete">Ilist.lencomplete</a></code></li>
<li><code><a href="#Ilist.lencompletefull">Ilist.lencompletefull</a></code></li>
<li><code><a href="#Ilist.rate">Ilist.rate</a></code></li>
<li><code><a href="#Ilist.setvallen">Ilist.setvallen</a></code></li>
<li><code><a href="#Ilist.zip">Ilist.zip</a></code></li>
</ul>

<p><em>idx property (getters)</em></p>

<ul>
<li><code><a href="#Ilist.dicidxref">Ilist.dicidxref</a></code></li>
<li><code><a href="#Ilist.idxcoupled">Ilist.idxcoupled</a></code></li>
<li><code><a href="#Ilist.idxderived">Ilist.idxderived</a></code></li>
<li><code><a href="#Ilist.idxder">Ilist.idxder</a></code></li>
<li><code><a href="#Ilist.idxlen">Ilist.idxlen</a></code></li>
<li><code><a href="#Ilist.idxref">Ilist.idxref</a></code></li>
<li><code><a href="#Ilist.idxunique">Ilist.idxunique</a></code></li>
<li><code><a href="#Ilist.ind">Ilist.ind</a></code></li>
<li><code><a href="#Ilist.lenidx">Ilist.lenidx</a></code></li>
<li><code><a href="#Ilist.minMaxIndex">Ilist.minMaxIndex</a></code></li>
</ul>

<p><em>add - update methods</em></p>

<ul>
<li><code><a href="#Ilist.addextidx">Ilist.addextidx</a></code></li>
<li><code><a href="#Ilist.addlistidx">Ilist.addlistidx</a></code></li>
<li><code><a href="#Ilist.append">Ilist.append</a></code></li>
<li><code><a href="#Ilist.appendi">Ilist.appendi</a></code></li>
<li><code><a href="#Ilist.updateidx">Ilist.updateidx</a></code></li>
<li><code><a href="#Ilist.updatelist">Ilist.updatelist</a></code></li>
</ul>

<p><em>selecting methods</em></p>

<ul>
<li><code><a href="#Ilist.extidxtoi">Ilist.extidxtoi</a></code></li>
<li><code><a href="#Ilist.iidxtoext">Ilist.iidxtoext</a></code></li>
<li><code><a href="#Ilist.iloc">Ilist.iloc</a></code></li>
<li><code><a href="#Ilist.iseIndex">Ilist.iseIndex</a></code></li>
<li><code><a href="#Ilist.isiIndex">Ilist.isiIndex</a></code></li>
<li><code><a href="#Ilist.isValue">Ilist.isValue</a></code></li>
<li><code><a href="#Ilist.loc">Ilist.loc</a></code></li>
<li><code><a href="#Ilist.setname">Ilist.setname</a></code></li>
<li><code><a href="#Ilist.unconsistent">Ilist.unconsistent</a></code></li>
</ul>

<p><em>management - conversion methods</em></p>

<ul>
<li><code><a href="#Ilist.axescoupling">Ilist.axescoupling</a></code></li>
<li><code><a href="#Ilist.couplingmatrix">Ilist.couplingmatrix</a></code></li>
<li><code><a href="#Ilist.derived_to_coupled">Ilist.derived_to_coupled</a></code></li>
<li><code><a href="#Ilist.full">Ilist.full</a></code></li>
<li><code><a href="#Ilist.merge">Ilist.merge</a></code></li>
<li><code><a href="#Ilist.mergeidx">Ilist.mergeidx</a></code></li>
<li><code><a href="#Ilist.reindex">Ilist.reindex</a></code></li>
<li><code><a href="#Ilist.reorder">Ilist.reorder</a></code></li>
<li><code><a href="#Ilist.setfilter">Ilist.setfilter</a></code></li>
<li><code><a href="#Ilist.sort">Ilist.sort</a></code></li>
<li><code><a href="#Ilist.sortidx">Ilist.sortidx</a></code></li>
<li><code><a href="#Ilist.swapindex">Ilist.swapindex</a></code></li>
</ul>

<p><em>exports methods</em></p>

<ul>
<li><code><a href="#Ilist.from_obj">Ilist.from_obj</a></code> (classmethod)</li>
<li><code><a href="#Ilist.from_csv">Ilist.from_csv</a></code> (classmethod)</li>
<li><code><a href="#Ilist.from_file">Ilist.from_file</a></code> (classmethod)</li>
<li><code><a href="#Ilist.json">Ilist.json</a></code></li>
<li><code><a href="#Ilist.to_obj">Ilist.to_obj</a></code></li>
<li><code><a href="#Ilist.to_csv">Ilist.to_csv</a></code></li>
<li><code><a href="#Ilist.to_file">Ilist.to_file</a></code></li>
<li><code><a href="#Ilist.to_numpy">Ilist.to_numpy</a></code></li>
<li><code><a href="#Ilist.to_xarray">Ilist.to_xarray</a></code></li>
<li><code><a href="#Ilist.vlist">Ilist.vlist</a></code></li>
</ul>
</div>


                            <div id="Ilist.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Ilist</span><span class="signature">(
    extval=[],
    setidx=[],
    iidx=[],
    valname=&#39;value&#39;,
    idxname=[],
    defaultidx=True
)</span>
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extval</span><span class="o">=</span><span class="p">[],</span> <span class="n">setidx</span><span class="o">=</span><span class="p">[],</span> <span class="n">iidx</span><span class="o">=</span><span class="p">[],</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">idxname</span><span class="o">=</span><span class="p">[],</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : list (default []) - indexed list (see data model)</span>
<span class="sd">        - **setidx** :  list (default []) - external different values of index (see data model)</span>
<span class="sd">        - **iidx** :  list (default [])  - integer value of index (see data model)</span>
<span class="sd">        - **valname** : string (default &#39;value&#39;) - name of indexed list (see data model)</span>
<span class="sd">        - **idxname** : list of string (default []) - name of index list (see data model)</span>
<span class="sd">        - **defaultidx** : boolean (default True) - If True, a generic index</span>
<span class="sd">        is generated if no index is defined</span>

<span class="sd">        *Returns* : None&#39;&#39;&#39;</span>
        <span class="k">if</span>   <span class="nb">type</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span>  <span class="o">!=</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">iidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span>   <span class="n">defaultidx</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">iidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">or</span> <span class="n">iidx</span> <span class="o">==</span> <span class="p">[])</span> <span class="p">:</span>
            <span class="n">iindex</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">)))]</span>
            <span class="k">if</span> <span class="n">idxname</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span>                      <span class="n">idxname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;default index&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">iidx</span> <span class="o">!=</span> <span class="p">[]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">iidx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="n">iindex</span> <span class="o">=</span> <span class="p">[</span><span class="n">iidx</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>                                      <span class="n">iindex</span> <span class="o">=</span> <span class="n">iidx</span>
        <span class="k">if</span>   <span class="nb">type</span><span class="p">(</span><span class="n">setidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">or</span> <span class="n">setidx</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span> <span class="n">setindex</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">iindex</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">setidx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span>              <span class="n">setindex</span> <span class="o">=</span> <span class="p">[</span><span class="n">setidx</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>                                      <span class="n">setindex</span> <span class="o">=</span>  <span class="n">setidx</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span>                   <span class="p">:</span> <span class="n">extvalue</span> <span class="o">=</span> <span class="p">[</span><span class="n">extval</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">extval</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">and</span> <span class="n">iindex</span> <span class="o">==</span> <span class="p">[]</span>        <span class="p">:</span> <span class="n">extvalue</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="n">extval</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">iindex</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                                                    <span class="n">extvalue</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">iindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                                                    <span class="n">valname</span> <span class="o">=</span> <span class="s1">&#39;default value&#39;</span>
        <span class="k">else</span> <span class="p">:</span>                                      <span class="n">extvalue</span> <span class="o">=</span> <span class="n">extval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extval</span>  <span class="o">=</span> <span class="n">extvalue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>    <span class="o">=</span> <span class="n">iindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span>  <span class="o">=</span> <span class="n">setindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valname</span> <span class="o">=</span> <span class="n">valname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;idx&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iindex</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">setindex</span><span class="p">)))]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">idxname</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">))</span> <span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Ilist constructor.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>extval</strong> : list (default []) - indexed list (see data model)</li>
<li><strong>setidx</strong> :  list (default []) - external different values of index (see data model)</li>
<li><strong>iidx</strong> :  list (default [])  - integer value of index (see data model)</li>
<li><strong>valname</strong> : string (default 'value') - name of indexed list (see data model)</li>
<li><strong>idxname</strong> : list of string (default []) - name of index list (see data model)</li>
<li><strong>defaultidx</strong> : boolean (default True) - If True, a generic index
is generated if no index is defined</li>
</ul>

<p><em>Returns</em> : None</p>
</div>


                            </div>
                            <div id="Ilist.Iidic" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.Iidic">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">Iidic</span><span class="signature">(cls, dictvaliidx, dictsetidx, order=[], idxref=[], defaultidx=True)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>     <span class="c1"># !!! class methods</span>
    <span class="k">def</span> <span class="nf">Iidic</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dictvaliidx</span><span class="p">,</span> <span class="n">dictsetidx</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">idxref</span><span class="o">=</span><span class="p">[],</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (dictionnary data).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **dictvaliidx** :  {valname : valiidx} with valiidx=list(list(val, indexval))</span>
<span class="sd">        - **dictsetidx** :  {idxname0 : setidx0, ... , idxnamen : setidxn}</span>
<span class="sd">        - **order** : list (default []) of axes used if there is no indexval in valiidx</span>
<span class="sd">        - **idxref** : list (default []) of reference axes used if there is no indexval</span>
<span class="sd">        in valiidx</span>
<span class="sd">        - **defaultidx** : boolean (default True). If True, a generic index is generated</span>
<span class="sd">        if no index is defined</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_initdict</span><span class="p">(</span><span class="n">dictvaliidx</span><span class="p">,</span> <span class="n">dictsetidx</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">idxref</span><span class="p">),</span> <span class="n">defaultidx</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Ilist constructor (dictionnary data).</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>dictvaliidx</strong> :  {valname : valiidx} with valiidx=list(list(val, indexval))</li>
<li><strong>dictsetidx</strong> :  {idxname0 : setidx0, ... , idxnamen : setidxn}</li>
<li><strong>order</strong> : list (default []) of axes used if there is no indexval in valiidx</li>
<li><strong>idxref</strong> : list (default []) of reference axes used if there is no indexval
in valiidx</li>
<li><strong>defaultidx</strong> : boolean (default True). If True, a generic index is generated
if no index is defined</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>Ilist</strong></li>
</ul>
</div>


                            </div>
                            <div id="Ilist.Iset" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.Iset">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">Iset</span><span class="signature">(
    cls,
    valiidx,
    setidx,
    order=[],
    idxref=[],
    valname=&#39;value&#39;,
    idxname=[],
    defaultidx=True
)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Iset</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">valiidx</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">idxref</span><span class="o">=</span><span class="p">[],</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span>
             <span class="n">idxname</span><span class="o">=</span><span class="p">[],</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (list data with indexed values ).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **valiidx** :  coupled val / index list : list(list(val, indexval))</span>
<span class="sd">        - **setidx** :  external different values of index (see data model)</span>
<span class="sd">        - **order** : list (default []) of axes used if there is no indexval in valiidx</span>
<span class="sd">        - **idxref** : list (default []) of reference axes used if there is no indexval in valiidx</span>
<span class="sd">        - **valname** : string (default &#39;value&#39;) name of indexed list (see data model)</span>
<span class="sd">        - **idxname** : list of string (default []) name of index list (see data model)</span>
<span class="sd">        - **defaultidx** : boolean (default True). If True, a generic index is generated</span>
<span class="sd">        if no index is defined</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">valiidx</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="p">:</span> <span class="n">validx</span> <span class="o">=</span> <span class="p">[</span><span class="n">valiidx</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">validx</span> <span class="o">=</span> <span class="n">valiidx</span>
        <span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">iidx</span><span class="p">)</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_initset</span><span class="p">(</span><span class="n">validx</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">idxref</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Ilist constructor (list data with indexed values ).</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>valiidx</strong> :  coupled val / index list : list(list(val, indexval))</li>
<li><strong>setidx</strong> :  external different values of index (see data model)</li>
<li><strong>order</strong> : list (default []) of axes used if there is no indexval in valiidx</li>
<li><strong>idxref</strong> : list (default []) of reference axes used if there is no indexval in valiidx</li>
<li><strong>valname</strong> : string (default 'value') name of indexed list (see data model)</li>
<li><strong>idxname</strong> : list of string (default []) name of index list (see data model)</li>
<li><strong>defaultidx</strong> : boolean (default True). If True, a generic index is generated
if no index is defined</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>Ilist</strong></li>
</ul>
</div>


                            </div>
                            <div id="Ilist.Iidx" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.Iidx">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">Iidx</span><span class="signature">(
    cls,
    extval,
    idxlen,
    idxref=[],
    order=[],
    valname=&#39;value&#39;,
    idxname=[],
    defaultidx=True
)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Iidx</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">extval</span><span class="p">,</span> <span class="n">idxlen</span><span class="p">,</span> <span class="n">idxref</span><span class="o">=</span><span class="p">[],</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">idxname</span><span class="o">=</span><span class="p">[],</span>
             <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (automatic index).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : indexed list (see data model)</span>
<span class="sd">        - **idxlen** : integer - number of index</span>
<span class="sd">        - **idxref** : list (default []) of reference axes used</span>
<span class="sd">        - **order** : list (default []) of axes used to order the index</span>
<span class="sd">        - **valname** : string (default &#39;value&#39;) name of indexed list (see data model)</span>
<span class="sd">        - **idxname** : list of string (default []) name of index list (see data model)</span>
<span class="sd">        - **defaultidx** : boolean (default True). If True, a generic index</span>
<span class="sd">        is generated if no index is defined</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="n">iidx</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_initiidx</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">),</span> <span class="n">idxlen</span><span class="p">,</span> <span class="n">idxref</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="p">[],</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Ilist constructor (automatic index).</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>extval</strong> : indexed list (see data model)</li>
<li><strong>idxlen</strong> : integer - number of index</li>
<li><strong>idxref</strong> : list (default []) of reference axes used</li>
<li><strong>order</strong> : list (default []) of axes used to order the index</li>
<li><strong>valname</strong> : string (default 'value') name of indexed list (see data model)</li>
<li><strong>idxname</strong> : list of string (default []) name of index list (see data model)</li>
<li><strong>defaultidx</strong> : boolean (default True). If True, a generic index
is generated if no index is defined</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>Ilist</strong></li>
</ul>
</div>


                            </div>
                            <div id="Ilist.Iedic" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.Iedic">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">Iedic</span><span class="signature">(cls, dicval={&#39;value&#39;: []}, dicidx={}, defaultidx=True, fast=False)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Iedic</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dicval</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:[]},</span> <span class="n">dicidx</span><span class="o">=</span><span class="p">{},</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (external dictionnary).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **dicval** : {valname : extval}  (see data model)</span>
<span class="sd">        - **dicidx** : {idxname[0] : extidx[0], ... , idxname[n] : extidx[n]} (see data model)</span>
<span class="sd">        - **defaultidx** : boolean (default True). If True, a generic index</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        is generated if no index is defined</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="n">valname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dicval</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">extval</span> <span class="o">=</span> <span class="n">dicval</span><span class="p">[</span><span class="n">valname</span><span class="p">]</span>
        <span class="n">idxname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dicidx</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">extidx</span> <span class="o">=</span> <span class="p">[</span><span class="n">dicidx</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">idxname</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">Iext</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">extidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Ilist constructor (external dictionnary).</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>dicval</strong> : {valname : extval}  (see data model)</li>
<li><strong>dicidx</strong> : {idxname[0] : extidx[0], ... , idxname[n] : extidx[n]} (see data model)</li>
<li><strong>defaultidx</strong> : boolean (default True). If True, a generic index</li>
<li><strong>fast</strong> : boolean (default False). If True, fast operation (reduction controls)
is generated if no index is defined</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>Ilist</strong></li>
</ul>
</div>


                            </div>
                            <div id="Ilist.Iext" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.Iext">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">Iext</span><span class="signature">(
    cls,
    extval=[],
    extidx=[],
    valname=&#39;value&#39;,
    idxname=[],
    defaultidx=True,
    fast=False
)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Iext</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">extval</span><span class="o">=</span><span class="p">[],</span> <span class="n">extidx</span><span class="o">=</span><span class="p">[],</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">idxname</span><span class="o">=</span><span class="p">[],</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (external index).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : indexed list (see data model)</span>
<span class="sd">        - **extidx** : index list (see data model)</span>
<span class="sd">        - **valname** : string (default &#39;value&#39;) name of indexed list (see data model)</span>
<span class="sd">        - **idxname** : list of string (default []) name of index list (see data model)</span>
<span class="sd">        - **defaultidx** : boolean (default True). If True, a generic index</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        is generated if no index is defined</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">extidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">defaultidx</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">extidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">or</span> <span class="n">extidx</span> <span class="o">==</span> <span class="p">[])</span> <span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">)))]</span>
            <span class="n">idxname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;default index&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">extidx</span> <span class="o">!=</span> <span class="p">[]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">extidx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span> <span class="p">:</span> <span class="n">ext</span> <span class="o">=</span> <span class="p">[</span><span class="n">extidx</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>                                          <span class="n">ext</span> <span class="o">=</span> <span class="n">extidx</span>
        <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">defaultidx</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Ilist constructor (external index).</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>extval</strong> : indexed list (see data model)</li>
<li><strong>extidx</strong> : index list (see data model)</li>
<li><strong>valname</strong> : string (default 'value') name of indexed list (see data model)</li>
<li><strong>idxname</strong> : list of string (default []) name of index list (see data model)</li>
<li><strong>defaultidx</strong> : boolean (default True). If True, a generic index</li>
<li><strong>fast</strong> : boolean (default False). If True, fast operation (reduction controls)
is generated if no index is defined</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>Ilist</strong></li>
</ul>
</div>


                            </div>
                            <div id="Ilist.Izip" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.Izip">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">Izip</span><span class="signature">(cls, *args)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Izip</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (external index only).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **args** : index list extidx=list(args) (see data model)</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">Iext</span><span class="p">(</span><span class="n">extval</span><span class="o">=</span><span class="p">[],</span> <span class="n">extidx</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">idxname</span><span class="o">=</span><span class="p">[],</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Ilist constructor (external index only).</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>args</strong> : index list extidx=list(args) (see data model)</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>Ilist</strong></li>
</ul>
</div>


                            </div>
                            <div id="Ilist.extval" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.extval">#&nbsp;&nbsp</a>

        <span class="name">extval</span>
    </div>

    
    

                            </div>
                            <div id="Ilist.iidx" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.iidx">#&nbsp;&nbsp</a>

        <span class="name">iidx</span>
    </div>

    
    

                            </div>
                            <div id="Ilist.setidx" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.setidx">#&nbsp;&nbsp</a>

        <span class="name">setidx</span>
    </div>

    
    

                            </div>
                            <div id="Ilist.valname" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.valname">#&nbsp;&nbsp</a>

        <span class="name">valname</span>
    </div>

    
    

                            </div>
                            <div id="Ilist.idxname" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.idxname">#&nbsp;&nbsp</a>

        <span class="name">idxname</span>
    </div>

    
    

                            </div>
                            <div id="Ilist.axes" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.axes">#&nbsp;&nbsp</a>

        <span class="name">axes</span>
    </div>

    
            <div class="docstring"><p>return the list of independant axes (not coupled and not unique)</p>
</div>


                            </div>
                            <div id="Ilist.axesall" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.axesall">#&nbsp;&nbsp</a>

        <span class="name">axesall</span>
    </div>

    
            <div class="docstring"><p>return the list of all axes</p>
</div>


                            </div>
                            <div id="Ilist.axesmin" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.axesmin">#&nbsp;&nbsp</a>

        <span class="name">axesmin</span>
    </div>

    
            <div class="docstring"><p>return the list of independant axes (not coupled, not derived and not unique)</p>
</div>


                            </div>
                            <div id="Ilist.axesmono" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.axesmono">#&nbsp;&nbsp</a>

        <span class="name">axesmono</span>
    </div>

    
            <div class="docstring"><p>return the list of axes with one value</p>
</div>


                            </div>
                            <div id="Ilist.axesmulti" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.axesmulti">#&nbsp;&nbsp</a>

        <span class="name">axesmulti</span>
    </div>

    
            <div class="docstring"><p>return the list of axes with more than one value</p>
</div>


                            </div>
                            <div id="Ilist.complete" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.complete">#&nbsp;&nbsp</a>

        <span class="name">complete</span>
    </div>

    
            <div class="docstring"><p>return a boolean (True if Ilist is complete and consistent)</p>
</div>


                            </div>
                            <div id="Ilist.completefull" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.completefull">#&nbsp;&nbsp</a>

        <span class="name">completefull</span>
    </div>

    
            <div class="docstring"><p>return a boolean (True if Ilist is full complete and consistent)</p>
</div>


                            </div>
                            <div id="Ilist.consistent" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.consistent">#&nbsp;&nbsp</a>

        <span class="name">consistent</span>
    </div>

    
            <div class="docstring"><p>return a boolean (True if Ilist is consistent : only one extval
for one list of index values</p>
</div>


                            </div>
                            <div id="Ilist.dicidxref" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.dicidxref">#&nbsp;&nbsp</a>

        <span class="name">dicidxref</span>
    </div>

    
            <div class="docstring"><p>return a dict with pair of coupled index (index name)</p>
</div>


                            </div>
                            <div id="Ilist.dimension" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.dimension">#&nbsp;&nbsp</a>

        <span class="name">dimension</span>
    </div>

    
            <div class="docstring"><p>return an integer : the number of index non coupled and non unique</p>
</div>


                            </div>
                            <div id="Ilist.extidx" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.extidx">#&nbsp;&nbsp</a>

        <span class="name">extidx</span>
    </div>

    
            <div class="docstring"><p>return extidx (see data model)</p>
</div>


                            </div>
                            <div id="Ilist.idicidxref" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.idicidxref">#&nbsp;&nbsp</a>

        <span class="name">idicidxref</span>
    </div>

    
            <div class="docstring"><p>return a dict with pair of coupled index (index row)</p>
</div>


                            </div>
                            <div id="Ilist.idxcoupled" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.idxcoupled">#&nbsp;&nbsp</a>

        <span class="name">idxcoupled</span>
    </div>

    
            <div class="docstring"><p>return a list of boolean for each index (True if coupled)</p>
</div>


                            </div>
                            <div id="Ilist.idxder" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.idxder">#&nbsp;&nbsp</a>

        <span class="name">idxder</span>
    </div>

    
            <div class="docstring"><p>return the list of derived index</p>
</div>


                            </div>
                            <div id="Ilist.idxderived" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.idxderived">#&nbsp;&nbsp</a>

        <span class="name">idxderived</span>
    </div>

    
            <div class="docstring"><p>return a list of boolean for each index (True if derived)</p>
</div>


                            </div>
                            <div id="Ilist.idxlen" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.idxlen">#&nbsp;&nbsp</a>

        <span class="name">idxlen</span>
    </div>

    
            <div class="docstring"><p>return the list of setidx lenght</p>
</div>


                            </div>
                            <div id="Ilist.idxref" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.idxref">#&nbsp;&nbsp</a>

        <span class="name">idxref</span>
    </div>

    
            <div class="docstring"><p>return the list of reference index</p>
</div>


                            </div>
                            <div id="Ilist.idxunique" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.idxunique">#&nbsp;&nbsp</a>

        <span class="name">idxunique</span>
    </div>

    
            <div class="docstring"><p>return a list of boolean for each index (True if unique)</p>
</div>


                            </div>
                            <div id="Ilist.ind" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.ind">#&nbsp;&nbsp</a>

        <span class="name">ind</span>
    </div>

    
            <div class="docstring"><p>return the textidx (see data model)</p>
</div>


                            </div>
                            <div id="Ilist.ival" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.ival">#&nbsp;&nbsp</a>

        <span class="name">ival</span>
    </div>

    
            <div class="docstring"><p>return the ival (see data model)</p>
</div>


                            </div>
                            <div id="Ilist.lencomplete" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.lencomplete">#&nbsp;&nbsp</a>

        <span class="name">lencomplete</span>
    </div>

    
            <div class="docstring"><p>return an integer : number of values if complete (prod(idxlen,not coupled))</p>
</div>


                            </div>
                            <div id="Ilist.lencompletefull" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.lencompletefull">#&nbsp;&nbsp</a>

        <span class="name">lencompletefull</span>
    </div>

    
            <div class="docstring"><p>return an integer : number of values if full complete (prod(idxlen,not coupled, not derived))</p>
</div>


                            </div>
                            <div id="Ilist.lenidx" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.lenidx">#&nbsp;&nbsp</a>

        <span class="name">lenidx</span>
    </div>

    
            <div class="docstring"><p>return an integer : number of index</p>
</div>


                            </div>
                            <div id="Ilist.minMaxIndex" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.minMaxIndex">#&nbsp;&nbsp</a>

        <span class="name">minMaxIndex</span>
    </div>

    
            <div class="docstring"><p>return a list : [ minimal value of index, maximal value of index]</p>
</div>


                            </div>
                            <div id="Ilist.rate" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.rate">#&nbsp;&nbsp</a>

        <span class="name">rate</span>
    </div>

    
            <div class="docstring"><p>return the float ratio : len / lencompletefull</p>
</div>


                            </div>
                            <div id="Ilist.setval" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.setval">#&nbsp;&nbsp</a>

        <span class="name">setval</span>
    </div>

    
            <div class="docstring"><p>return the setval (see data model)</p>
</div>


                            </div>
                            <div id="Ilist.setvallen" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.setvallen">#&nbsp;&nbsp</a>

        <span class="name">setvallen</span>
    </div>

    
            <div class="docstring"><p>return the integer lenght of setval (see data model)</p>
</div>


                            </div>
                            <div id="Ilist.textidx" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.textidx">#&nbsp;&nbsp</a>

        <span class="name">textidx</span>
    </div>

    
            <div class="docstring"><p>return the textidx (see data model)</p>
</div>


                            </div>
                            <div id="Ilist.tiidx" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.tiidx">#&nbsp;&nbsp</a>

        <span class="name">tiidx</span>
    </div>

    
            <div class="docstring"><p>return the tiidx (see data model)</p>
</div>


                            </div>
                            <div id="Ilist.zip" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Ilist.zip">#&nbsp;&nbsp</a>

        <span class="name">zip</span>
    </div>

    
            <div class="docstring"><p>return a zip format for textidx : tuple(tuple(idx)</p>
</div>


                            </div>
                            <div id="Ilist.addextidx" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.addextidx">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">addextidx</span><span class="signature">(self, idxname, extidx)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">addextidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">extidx</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add a new index with name = idxname and extidx.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **idxname** : string - name of index list (see data model)</span>
<span class="sd">        - **extidx** : list - new index list (see data model)</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addlistidx</span><span class="p">(</span><span class="n">idxname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">extidx</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toint</span><span class="p">(</span><span class="n">extidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">extidx</span><span class="p">)))</span>
</pre></div>

        </details>

            <div class="docstring"><p>add a new index with name = idxname and extidx.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>idxname</strong> : string - name of index list (see data model)</li>
<li><strong>extidx</strong> : list - new index list (see data model)</li>
</ul>

<p><em>Returns</em> : none</p>
</div>


                            </div>
                            <div id="Ilist.addlistidx" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.addlistidx">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">addlistidx</span><span class="signature">(self, idxname, setidx, iidx)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">addlistidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idxname</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add a new index with name = idxname and setidx / iidx.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **idxname** : string - name of index list (see data model)</span>
<span class="sd">        - **setidx** :  list - external different values of index (see data model)</span>
<span class="sd">        - **iidx** :  list - integer value of index (see data model)</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">iidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">iidx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;listindex out of bounds&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">setidx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="o">=</span> <span class="n">iidx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">idxname</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span> <span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">setidx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>   <span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iidx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idxname</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>add a new index with name = idxname and setidx / iidx.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>idxname</strong> : string - name of index list (see data model)</li>
<li><strong>setidx</strong> :  list - external different values of index (see data model)</li>
<li><strong>iidx</strong> :  list - integer value of index (see data model)</li>
</ul>

<p><em>Returns</em> : none</p>
</div>


                            </div>
                            <div id="Ilist.append" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.append">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">append</span><span class="signature">(self, extval, extind, unique=False, fast=False)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extval</span><span class="p">,</span> <span class="n">extind</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add a new value extval with index extind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : new object value</span>
<span class="sd">        - **extind** :  list - new index values to add to extidx</span>
<span class="sd">        - **unique** :  boolean (default False) - If True and extidx present</span>
<span class="sd">        - **fast** : boolean (default False) - Update whithout reindex</span>
<span class="sd">        in textidx append is refuse.</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iseIndex</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">unique</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">isValue</span><span class="p">(</span><span class="n">extval</span><span class="p">)):</span> <span class="k">return</span>
        <span class="k">if</span> <span class="n">fast</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span>
            <span class="n">iind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateset</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">iind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">)</span> <span class="p">:</span> <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="n">tiidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_updateset</span><span class="p">(</span><span class="n">extind</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="n">tiidx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">)</span>
        <span class="k">return</span>
</pre></div>

        </details>

            <div class="docstring"><p>add a new value extval with index extind.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>extval</strong> : new object value</li>
<li><strong>extind</strong> :  list - new index values to add to extidx</li>
<li><strong>unique</strong> :  boolean (default False) - If True and extidx present</li>
<li><strong>fast</strong> : boolean (default False) - Update whithout reindex
in textidx append is refuse.</li>
</ul>

<p><em>Returns</em> : none</p>
</div>


                            </div>
                            <div id="Ilist.appendi" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.appendi">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">appendi</span><span class="signature">(self, extval, intind, unique=False)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">appendi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extval</span><span class="p">,</span> <span class="n">intind</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add a new value extval with index intind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : new object value</span>
<span class="sd">        - **intind** :  list - new index values to add to iidx</span>
<span class="sd">        - **unique** :  boolean (default False) - If True and intind present</span>
<span class="sd">        in tiidx append is refuse.</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isiIndex</span><span class="p">(</span><span class="n">intind</span><span class="p">)</span> <span class="ow">and</span> <span class="n">unique</span><span class="p">)</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isValue</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isiIndex</span><span class="p">(</span><span class="n">intind</span><span class="p">)):</span> <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extval</span><span class="p">)</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="n">tiidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="n">tiidx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>add a new value extval with index intind.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>extval</strong> : new object value</li>
<li><strong>intind</strong> :  list - new index values to add to iidx</li>
<li><strong>unique</strong> :  boolean (default False) - If True and intind present
in tiidx append is refuse.</li>
</ul>

<p><em>Returns</em> : none</p>
</div>


                            </div>
                            <div id="Ilist.axescoupling" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.axescoupling">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">axescoupling</span><span class="signature">(self, axes=None)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">axescoupling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return the list of independant axes (not coupled, not derived and not unique)</span>
<span class="sd">        with coupling order (most coupling first)</span>
<span class="sd">        </span>
<span class="sd">        *Parameters*</span>

<span class="sd">        - **axes** : list of int (default None) - list of axes </span>

<span class="sd">        *Returns* : list  &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span><span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="n">axes</span>
        <span class="n">axe</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span> <span class="k">if</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span><span class="p">]</span>
        <span class="n">order</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">couplingmatrix</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axe</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">axe</span><span class="p">,</span> <span class="n">axe</span><span class="p">]</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  
            <span class="n">order</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
            <span class="n">axe</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">order</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">axe</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">order</span>
</pre></div>

        </details>

            <div class="docstring"><p>return the list of independant axes (not coupled, not derived and not unique)
with coupling order (most coupling first)</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>axes</strong> : list of int (default None) - list of axes </li>
</ul>

<p><em>Returns</em> : list</p>
</div>


                            </div>
                            <div id="Ilist.couplingmatrix" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.couplingmatrix">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">couplingmatrix</span><span class="signature">(self, file=None)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">couplingmatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return a matrix ratio with coupling ratio between each axes.</span>
<span class="sd">        The matrix is return or stored in a file (csv format).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **file** : string (default None) - name of the file. If None, the array </span>
<span class="sd">        is returned.</span>

<span class="sd">        *Returns* : array or None&#39;&#39;&#39;</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">_couplinginfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">j</span><span class="p">])[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span> 
             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="p">:</span> <span class="k">return</span> <span class="n">mat</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">):</span> <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>

        </details>

            <div class="docstring"><p>return a matrix ratio with coupling ratio between each axes.
The matrix is return or stored in a file (csv format).</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>file</strong> : string (default None) - name of the file. If None, the array 
is returned.</li>
</ul>

<p><em>Returns</em> : array or None</p>
</div>


                            </div>
                            <div id="Ilist.derived_to_coupled" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.derived_to_coupled">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">derived_to_coupled</span><span class="signature">(self, idxder, idxref)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">derived_to_coupled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idxder</span><span class="p">,</span> <span class="n">idxref</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Transform a derived index in a coupled index (new setidx).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **idxder** : number of the derived index.</span>
<span class="sd">        - **idxref** : number of the index to be coupled.</span>

<span class="sd">        *Returns* : None&#39;&#39;&#39;</span>
        <span class="n">dic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_idxlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idxref</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idxder</span><span class="p">],</span> <span class="n">coupled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">derived</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dic</span><span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;idx is not derived from the other&quot;</span><span class="p">)</span>
        <span class="n">setidx</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">idxder</span><span class="p">][</span><span class="n">dic</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxlen</span><span class="p">[</span><span class="n">idxref</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">idxder</span><span class="p">]</span> <span class="o">=</span> <span class="n">setidx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idxder</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">idxref</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Transform a derived index in a coupled index (new setidx).</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>idxder</strong> : number of the derived index.</li>
<li><strong>idxref</strong> : number of the index to be coupled.</li>
</ul>

<p><em>Returns</em> : None</p>
</div>


                            </div>
                            <div id="Ilist.extidxtoi" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.extidxtoi">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">extidxtoi</span><span class="signature">(self, extind)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">extidxtoi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        convert an extind (value for each extidx) to an intind (value for each iidx).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extind** : value for each extidx</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **list** : intind, value for each iidx&#39;&#39;&#39;</span>
        <span class="k">try</span> <span class="p">:</span>  <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">extind</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extind</span><span class="p">))]</span>
        <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
</pre></div>

        </details>

            <div class="docstring"><p>convert an extind (value for each extidx) to an intind (value for each iidx).</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>extind</strong> : value for each extidx</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>list</strong> : intind, value for each iidx</li>
</ul>
</div>


                            </div>
                            <div id="Ilist.from_obj" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.from_obj">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">from_obj</span><span class="signature">(cls, bs)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_obj</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate an Ilist Object from a bytes, json or dict value</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **bs** : bytes or string data to convert</span>

<span class="sd">        *Returns* : Ilist &#39;&#39;&#39;</span>
        <span class="n">setidx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">extval</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">bs</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x00</span> <span class="ow">and</span> <span class="p">(</span><span class="n">bs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mb">0b11100000</span><span class="p">)</span><span class="o">==</span> <span class="mb">0b10100000</span><span class="p">:</span>
                <span class="n">dic2</span> <span class="o">=</span> <span class="n">cbor2</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">dic2</span> <span class="o">=</span> <span class="n">bson</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="p">:</span> <span class="n">dic2</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">object_hook</span><span class="o">=</span><span class="n">CborDecoder</span><span class="p">()</span><span class="o">.</span><span class="n">codecbor</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="n">dic2</span> <span class="o">=</span> <span class="n">bs</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;the type of parameter is not available&quot;</span><span class="p">)</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">dic2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ES</span><span class="o">.</span><span class="n">invcodeb</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="n">ES</span><span class="o">.</span><span class="n">invcodeb</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">dic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">if</span> <span class="s1">&#39;_id&#39;</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span> <span class="n">dic</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;order&#39;</span> <span class="ow">in</span> <span class="n">dic</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> 
            <span class="n">idxname</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span>
            <span class="n">setidx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">idxname</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">setidx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s1">&#39;idxref&#39;</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span> <span class="n">idxref</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;idxref&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">idxref</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">valname</span> <span class="o">=</span> <span class="s1">&#39;default value&#39;</span>
        <span class="k">for</span> <span class="n">elmt</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>    
            <span class="k">if</span> <span class="n">elmt</span> <span class="ow">in</span> <span class="n">idxname</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="n">elmt</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span> 
                <span class="n">setidx</span><span class="p">[</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elmt</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="n">elmt</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">elmt</span> <span class="ow">in</span> <span class="n">idxname</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="n">elmt</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span> 
                <span class="n">setidx</span><span class="p">[</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elmt</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="n">elmt</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="n">elmt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;idxref&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">]:</span> 
                <span class="n">valname</span> <span class="o">=</span> <span class="n">elmt</span>
                <span class="n">extval</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="n">elmt</span><span class="p">]</span>
        <span class="n">idxlen</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">setid</span><span class="p">)</span> <span class="k">for</span> <span class="n">setid</span> <span class="ow">in</span> <span class="n">setidx</span><span class="p">]</span>  
        <span class="n">axesmulti</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxlen</span><span class="p">))</span> <span class="k">if</span> <span class="n">idxlen</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;index&#39;</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>
            <span class="sd">&#39;&#39;&#39;if isinstance(dic[&#39;index&#39;], list): iidx = dic[&#39;index&#39;]</span>
<span class="sd">            else: iidx = np.frombuffer(dic[&#39;index&#39;], dtype=&#39;u2&#39;) \</span>
<span class="sd">                         .reshape((len(idxname),len(extval))).tolist()&#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span> <span class="n">iidxmulti</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">iidxmulti</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;u2&#39;</span><span class="p">)</span> \
                         <span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">axesmulti</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">)))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">lismono</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">))]</span>
            <span class="n">iidx</span> <span class="o">=</span> <span class="p">[</span><span class="n">iidxmulti</span><span class="p">[</span><span class="n">axesmulti</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axesmulti</span> \
                    <span class="k">else</span> <span class="n">lismono</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">))]</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iidxref</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">idxref</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">:</span>
                <span class="n">keyn</span> <span class="o">=</span> <span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">valn</span> <span class="o">=</span> <span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="n">iidxref</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">keyn</span><span class="p">,</span> <span class="n">valn</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">keyn</span><span class="p">,</span> <span class="n">valn</span><span class="p">)</span>
            <span class="n">iidx</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_initiidx</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extval</span><span class="p">),</span> <span class="n">idxlen</span><span class="p">,</span> <span class="n">iidxref</span><span class="p">,</span> 
                                 <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">))),</span> <span class="n">defaultidx</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Generate an Ilist Object from a bytes, json or dict value</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>bs</strong> : bytes or string data to convert</li>
</ul>

<p><em>Returns</em> : Ilist</p>
</div>


                            </div>
                            <div id="Ilist.from_csv" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.from_csv">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">from_csv</span><span class="signature">(
    cls,
    filename=&#39;ilist.csv&#39;,
    valfirst=False,
    header=True,
    dtype=None,
    **kwargs
)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_csv</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;ilist.csv&#39;</span><span class="p">,</span> <span class="n">valfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ilist constructor (from a csv file). Each column represents extidx or extval values.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **filename** : string (default &#39;ilist.csv&#39;), name of the file to read</span>
<span class="sd">        - **valfirst** : boolean (default False). If False extval is the last columns</span>
<span class="sd">        else it&#39;s the first</span>
<span class="sd">        - **header** : boolean (default True). If True, the first raw is dedicated to names</span>
<span class="sd">        - **dtype** : list of string (default None) - data type for each column (default str) : str, int, float, datetime, coord</span>
<span class="sd">        - **kwargs** : see csv.reader options</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist**  &#39;&#39;&#39;</span>
        <span class="n">extval</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">extidx</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;value&#39;</span>
        <span class="n">idxname</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dtype</span> <span class="p">:</span> <span class="n">dtype</span> <span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">first</span><span class="o">=</span><span class="kc">True</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">first</span> <span class="p">:</span>
                    <span class="k">for</span> <span class="n">vrow</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">:</span> <span class="n">extidx</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="k">if</span> <span class="n">first</span> <span class="ow">and</span> <span class="n">header</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="n">valfirst</span>      <span class="p">:</span>
                        <span class="n">valname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">vrow</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">:</span> <span class="n">idxname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">vrow</span><span class="p">))</span>
                    <span class="k">else</span> <span class="p">:</span>
                        <span class="n">valname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">vrow</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="n">idxname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">vrow</span><span class="p">))</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="n">valfirst</span>      <span class="p">:</span>
                        <span class="n">extval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="n">extidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]))</span>
                    <span class="k">else</span> <span class="p">:</span>
                        <span class="n">extval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]))</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="n">extidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dtype</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]))</span>
                <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">Iext</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">extidx</span><span class="p">,</span> <span class="n">valname</span><span class="p">,</span> <span class="n">idxname</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Ilist constructor (from a csv file). Each column represents extidx or extval values.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>filename</strong> : string (default 'ilist.csv'), name of the file to read</li>
<li><strong>valfirst</strong> : boolean (default False). If False extval is the last columns
else it's the first</li>
<li><strong>header</strong> : boolean (default True). If True, the first raw is dedicated to names</li>
<li><strong>dtype</strong> : list of string (default None) - data type for each column (default str) : str, int, float, datetime, coord</li>
<li><strong>kwargs</strong> : see csv.reader options</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>Ilist</strong></li>
</ul>
</div>


                            </div>
                            <div id="Ilist.from_file" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.from_file">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">from_file</span><span class="signature">(cls, file, forcestring=False)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">forcestring</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate `Ilist` object from file storage.</span>

<span class="sd">         *Parameters*</span>

<span class="sd">        - **file** : string - file name (with path)</span>
<span class="sd">        - **forcestring** : boolean (default False) - if True, forces the UTF-8 data format, else the format is calculated</span>

<span class="sd">        *Returns* : Ilist object&#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">btype</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">btype</span><span class="o">==</span><span class="nb">bytes</span><span class="p">(</span><span class="s1">&#39;{&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">forcestring</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">bjson</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">bjson</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_obj</span><span class="p">(</span><span class="n">bjson</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Generate <code><a href="#Ilist">Ilist</a></code> object from file storage.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>file</strong> : string - file name (with path)</li>
<li><strong>forcestring</strong> : boolean (default False) - if True, forces the UTF-8 data format, else the format is calculated</li>
</ul>

<p><em>Returns</em> : Ilist object</p>
</div>


                            </div>
                            <div id="Ilist.full" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.full">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">full</span><span class="signature">(self, axes=[], fillvalue=None, inplace=False)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">full</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[],</span> <span class="n">fillvalue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add new extval with new extidx to have a complet Ilist</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **axes** : list (default []) - list of index to be completed. If [], self.axesmin is used.</span>
<span class="sd">        - **fillvalue** : object value used for the new extval</span>
<span class="sd">        - **inplace** : boolean (default True) - if True, new values are added,</span>
<span class="sd">        if False a new Ilist is created.</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **None**, if inplace. Ilist if not inplace&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">consistent</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;unable to generate full Ilist with inconsistent Ilist&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span> <span class="p">:</span> <span class="n">axe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="n">iidxadd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idxfull</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">iidxadd</span> <span class="ow">and</span> <span class="n">inplace</span> <span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">iidxadd</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">inplace</span> <span class="p">:</span> <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">iidxfull</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">idxadd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">,</span> <span class="n">iidxadd</span><span class="p">)</span> <span class="p">:</span> <span class="n">iidxfull</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="n">idxadd</span><span class="p">)</span>
        <span class="n">extvalfull</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">)</span>
        <span class="n">extvalfull</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_nullValue</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">extvalfull</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">fillvalue</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iidxadd</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
        <span class="sd">&#39;&#39;&#39;tiidxfull = self.tiidx</span>
<span class="sd">        extvalfull = copy(self.extval)</span>
<span class="sd">        for ind in self._transpose(self._idxfull(axes=axe)) :</span>
<span class="sd">            if ind not in tiidxfull :</span>
<span class="sd">                tiidxfull.append(ind)</span>
<span class="sd">                extvalfull.append(self._nullValue(type(extvalfull[0]), fillvalue))</span>
<span class="sd">        iidxfull = self._transpose(tiidxfull)&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">inplace</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extval</span> <span class="o">=</span> <span class="n">extvalfull</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>   <span class="o">=</span> <span class="n">iidxfull</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">Ilist</span><span class="p">(</span><span class="n">extvalfull</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">,</span> <span class="n">iidxfull</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>add new extval with new extidx to have a complet Ilist</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>axes</strong> : list (default []) - list of index to be completed. If [], self.axesmin is used.</li>
<li><strong>fillvalue</strong> : object value used for the new extval</li>
<li><strong>inplace</strong> : boolean (default True) - if True, new values are added,
if False a new Ilist is created.</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>None</strong>, if inplace. Ilist if not inplace</li>
</ul>
</div>


                            </div>
                            <div id="Ilist.iadd" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.iadd">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">iadd</span><span class="signature">(self, other, unique=False)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">iadd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add other&#39;s values to self&#39;s values</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **other** : Ilist to be copied</span>
<span class="sd">        - **unique** :  boolean (default False) - If True and iidx present in tiidx,</span>
<span class="sd">        append is refuse.</span>

<span class="sd">        *Returns* : None&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">lenidx</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;the index lenght have to be equal&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">val</span><span class="p">,</span><span class="n">extidx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">textidx</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">extidx</span><span class="p">,</span> <span class="n">unique</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;idx&#39;</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;idx&#39;</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;value&#39;</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">valname</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;value&#39;</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valname</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">valname</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>

        </details>

            <div class="docstring"><p>Add other's values to self's values</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>other</strong> : Ilist to be copied</li>
<li><strong>unique</strong> :  boolean (default False) - If True and iidx present in tiidx,
append is refuse.</li>
</ul>

<p><em>Returns</em> : None</p>
</div>


                            </div>
                            <div id="Ilist.iidxtoext" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.iidxtoext">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">iidxtoext</span><span class="signature">(self, intind)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">iidxtoext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        convert an intind (value for each iidx) to an extind (value for each extidx).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **intind** : value for each iidx</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **list** : extind, value for each extidx&#39;&#39;&#39;</span>
        <span class="k">try</span> <span class="p">:</span>  <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">intind</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intind</span><span class="p">))]</span>
        <span class="k">except</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
</pre></div>

        </details>

            <div class="docstring"><p>convert an intind (value for each iidx) to an extind (value for each extidx).</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>intind</strong> : value for each iidx</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>list</strong> : extind, value for each extidx</li>
</ul>
</div>


                            </div>
                            <div id="Ilist.iloc" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.iloc">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">iloc</span><span class="signature">(self, intind)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">iloc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return extval corresponding to intind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **intind** : list - value for each iidx</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **object** : extval value &#39;&#39;&#39;</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="n">ival</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">intind</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s1">&#39;index not found&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return extval corresponding to intind.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>intind</strong> : list - value for each iidx</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>object</strong> : extval value</li>
</ul>
</div>


                            </div>
                            <div id="Ilist.iseIndex" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.iseIndex">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">iseIndex</span><span class="signature">(self, extind)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">iseIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return True if extind is present in extidx.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extind** : list - value for each extidx</span>

<span class="sd">        *Returns* : boolean - True if found&#39;&#39;&#39;</span>
        <span class="n">intind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidxtoi</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">intind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">intind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return True if extind is present in extidx.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>extind</strong> : list - value for each extidx</li>
</ul>

<p><em>Returns</em> : boolean - True if found</p>
</div>


                            </div>
                            <div id="Ilist.isiIndex" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.isiIndex">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">isiIndex</span><span class="signature">(self, intind)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">isiIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return True if intind is present in iidx.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **intind** : list - value for each iidx</span>

<span class="sd">        *Returns* : boolean - True if found&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">intind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">intind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return True if intind is present in iidx.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>intind</strong> : list - value for each iidx</li>
</ul>

<p><em>Returns</em> : boolean - True if found</p>
</div>


                            </div>
                            <div id="Ilist.isValue" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.isValue">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">isValue</span><span class="signature">(self, extval)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">isValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extval</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return True if present in extval.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extval** : value to test</span>

<span class="sd">        *Returns* : boolean - True if found&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">extval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return True if present in extval.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>extval</strong> : value to test</li>
</ul>

<p><em>Returns</em> : boolean - True if found</p>
</div>


                            </div>
                            <div id="Ilist.json" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.json">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">json</span><span class="signature">(self, **kwargs)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return json dict or string.</span>

<span class="sd">        *Parameters (kwargs)*</span>

<span class="sd">        - **encoded** : boolean (default False) - choice for return format (bynary if True, dict else)</span>
<span class="sd">        - **encode_format** : string (default &#39;json&#39;) - choice for return format (json, bson or cbor)</span>
<span class="sd">        - **json_res_index** : default False - if True add the index to the value</span>
<span class="sd">        - **order** : default [] - list of ordered index</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **codif** : dict (default {}). Numerical value for string in CBOR encoder</span>

<span class="sd">        *Returns* : string or dict&#39;&#39;&#39;</span>

        <span class="c1">#option = kwargs | {&#39;bjson_bson&#39;: False} </span>
        <span class="n">option</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encode_format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;encoded&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;codif&#39;</span> <span class="p">:</span> <span class="p">{}}</span> <span class="o">|</span> <span class="n">kwargs</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_obj</span><span class="p">(</span><span class="o">**</span><span class="n">option</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return json dict or string.</p>

<p><em>Parameters (kwargs)</em></p>

<ul>
<li><strong>encoded</strong> : boolean (default False) - choice for return format (bynary if True, dict else)</li>
<li><strong>encode_format</strong> : string (default 'json') - choice for return format (json, bson or cbor)</li>
<li><strong>json_res_index</strong> : default False - if True add the index to the value</li>
<li><strong>order</strong> : default [] - list of ordered index</li>
<li><strong>fast</strong> : boolean (default False). If True, fast operation (reduction controls)</li>
<li><strong>codif</strong> : dict (default {}). Numerical value for string in CBOR encoder</li>
</ul>

<p><em>Returns</em> : string or dict</p>
</div>


                            </div>
                            <div id="Ilist.loc" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.loc">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">loc</span><span class="signature">(self, extind)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extind</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return extval corresponding to extind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extind** : list - value for each extidx</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **object** : extval value &#39;&#39;&#39;</span>
        <span class="n">intind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidxtoi</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="n">ival</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">intind</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s1">&#39;index not found&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return extval corresponding to extind.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>extind</strong> : list - value for each extidx</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>object</strong> : extval value</li>
</ul>
</div>


                            </div>
                            <div id="Ilist.merge" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.merge">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">merge</span><span class="signature">(self, valname=&#39;merge&#39;, fillvalue=None)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valname</span><span class="o">=</span><span class="s1">&#39;merge&#39;</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Merge replaces Ilist objects included in extval data into its constituents.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **valname** : str (default &#39;merge&#39;) - name of the new Ilist object</span>
<span class="sd">        - **fillvalue** : object (default None) - value used for the new data </span>
<span class="sd">        (e.g. apply a new index to another Ilist)</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Ilist** : merged Ilist &#39;&#39;&#39;</span>        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Ilist</span><span class="p">):</span> <span class="k">return</span> <span class="kc">None</span>
        <span class="n">idxname</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="o">+</span> <span class="p">[</span><span class="n">nam</span> <span class="k">for</span> <span class="n">il</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span> <span class="k">for</span> <span class="n">nam</span> <span class="ow">in</span> <span class="n">il</span><span class="o">.</span><span class="n">idxname</span><span class="p">])))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="s1">&#39;default index&#39;</span> <span class="ow">in</span> <span class="n">idxname</span><span class="p">:</span> <span class="n">idxname</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;default index&#39;</span><span class="p">)</span>
        <span class="n">extidx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxname</span><span class="p">)))</span>
        <span class="n">extval</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">il</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">extval</span> <span class="o">+=</span> <span class="n">il</span><span class="o">.</span><span class="n">extval</span>
            <span class="k">for</span> <span class="n">nam</span> <span class="ow">in</span> <span class="n">idxname</span><span class="p">:</span>
                <span class="n">extiidx</span> <span class="o">=</span> <span class="n">extidx</span><span class="p">[</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nam</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">nam</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="ow">and</span> <span class="n">nam</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">il</span><span class="o">.</span><span class="n">idxname</span><span class="p">:</span>
                    <span class="n">extiidx</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nam</span><span class="p">)][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">il</span><span class="p">))]</span>                         
                <span class="k">elif</span> <span class="n">nam</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="ow">and</span> <span class="n">nam</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">il</span><span class="o">.</span><span class="n">idxname</span><span class="p">:</span>
                    <span class="n">extiidx</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fillvalue</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">il</span><span class="p">))]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">extiidx</span> <span class="o">+=</span> <span class="n">il</span><span class="o">.</span><span class="n">extidx</span><span class="p">[</span><span class="n">il</span><span class="o">.</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nam</span><span class="p">)]</span>                
        <span class="n">ilm</span> <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">Iext</span><span class="p">(</span><span class="n">valname</span><span class="o">=</span><span class="n">valname</span><span class="p">,</span> <span class="n">extval</span><span class="o">=</span><span class="n">extval</span><span class="p">,</span> <span class="n">idxname</span><span class="o">=</span><span class="n">idxname</span><span class="p">,</span> <span class="n">extidx</span><span class="o">=</span><span class="n">extidx</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ilm</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Ilist</span><span class="p">):</span> 
            <span class="k">return</span> <span class="n">ilm</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">valname</span><span class="o">=</span><span class="n">valname</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">fillvalue</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">ilm</span>
</pre></div>

        </details>

            <div class="docstring"><p>Merge replaces Ilist objects included in extval data into its constituents.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>valname</strong> : str (default 'merge') - name of the new Ilist object</li>
<li><strong>fillvalue</strong> : object (default None) - value used for the new data 
(e.g. apply a new index to another Ilist)</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>Ilist</strong> : merged Ilist</li>
</ul>
</div>


                            </div>
                            <div id="Ilist.mergeidx" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.mergeidx">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">mergeidx</span><span class="signature">(self, listidx)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">mergeidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listidx</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a new index with tuple built from the indexes in listidx.</span>
<span class="sd">        Append the new index to ilist</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **listidx** : list - list of index row to be merged</span>

<span class="sd">        *Returns* : None&#39;&#39;&#39;</span>   
        <span class="n">name</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">listidx</span><span class="p">])</span>
        <span class="n">extidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">listidx</span><span class="p">])))</span>
        <span class="c1">#extidx = self._mergeidx([self.iidx[i] for i in listidx])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addextidx</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">extidx</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>

        </details>

            <div class="docstring"><p>Create a new index with tuple built from the indexes in listidx.
Append the new index to ilist</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>listidx</strong> : list - list of index row to be merged</li>
</ul>

<p><em>Returns</em> : None</p>
</div>


                            </div>
                            <div id="Ilist.reindex" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.reindex">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">reindex</span><span class="signature">(self, index=[], fast=False)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">reindex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[],</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Define new sorted index.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **index** : list (default [])- list of the index to reindex.</span>
<span class="sd">        If [] all the index are reindexed.</span>

<span class="sd">        *Returns* : None&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span> <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">index</span> <span class="p">:</span>
            <span class="n">oldidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>   <span class="o">=</span> <span class="n">Ilist</span><span class="o">.</span><span class="n">_reindexidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">oldidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">fast</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Define new sorted index.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>index</strong> : list (default [])- list of the index to reindex.
If [] all the index are reindexed.</li>
</ul>

<p><em>Returns</em> : None</p>
</div>


                            </div>
                            <div id="Ilist.reorder" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.reorder">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">reorder</span><span class="signature">(self, sort=[], inplace=True, fast=False)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">reorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="p">[],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Change the order of extval and iidx with a new order define by sort</span>
<span class="sd">        (sort can be a subset of the items list).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **sort** : list (default [])- new record order to apply. If [], no change.</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **inplace** : boolean (default True) - if True, new order is apply to self,</span>
<span class="sd">        if False a new Ilist is created.</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **None**, if inplace. **Ilist** if not inplace&#39;&#39;&#39;</span>
        <span class="n">selfextidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span>
        <span class="n">extval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reorder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">sort</span><span class="p">)</span>
        <span class="n">iidx</span> <span class="o">=</span>  <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_reorder</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">sort</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">]</span>
        <span class="n">extidx</span> <span class="o">=</span>  <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_reorder</span><span class="p">(</span><span class="n">eidx</span><span class="p">,</span> <span class="n">sort</span><span class="p">)</span> <span class="k">for</span> <span class="n">eidx</span> <span class="ow">in</span> <span class="n">selfextidx</span><span class="p">]</span>
        <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="n">extidx</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inplace</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extval</span> <span class="o">=</span> <span class="n">extval</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>   <span class="o">=</span> <span class="n">iidx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span> <span class="o">=</span> <span class="n">setidx</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">Ilist</span><span class="p">(</span><span class="n">extval</span><span class="p">,</span> <span class="n">setidx</span><span class="p">,</span> <span class="n">iidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Change the order of extval and iidx with a new order define by sort
(sort can be a subset of the items list).</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>sort</strong> : list (default [])- new record order to apply. If [], no change.</li>
<li><strong>fast</strong> : boolean (default False). If True, fast operation (reduction controls)</li>
<li><strong>inplace</strong> : boolean (default True) - if True, new order is apply to self,
if False a new Ilist is created.</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>None</strong>, if inplace. <strong>Ilist</strong> if not inplace</li>
</ul>
</div>


                            </div>
                            <div id="Ilist.setname" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.setname">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">setname</span><span class="signature">(self, name)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">setname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        return setidx for the idx define by name</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **name** : str - name of the index in idxname </span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **List** : list if name in idxname, None else&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>

        </details>

            <div class="docstring"><p>return setidx for the idx define by name</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>name</strong> : str - name of the index in idxname </li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>List</strong> : list if name in idxname, None else</li>
</ul>
</div>


                            </div>
                            <div id="Ilist.setfilter" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.setfilter">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">setfilter</span><span class="signature">(self, setidxfilt=None, inplace=True, index=True, fast=False)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">setfilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setidxfilt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove values that does not match the indexes filter.</span>
<span class="sd">        The filter is a reduced list of indexes.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **setidxfilt** : list of lists (default None) - new reduced setidx. If None, no change.</span>
<span class="sd">        - **index** : boolean (default True) - indicates if setidxfilt is a list of values (False)</span>
<span class="sd">        or indexes (True).</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **inplace** : boolean (default True) - if True, new setidx is apply to self,</span>
<span class="sd">        if False a new Ilist is created.</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **None**, if inplace. **Ilist** if not inplace&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">setidxfilt</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">setidxfilt</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="p">:</span> <span class="k">return</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="n">lenidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span>
        <span class="k">if</span> <span class="n">index</span> <span class="p">:</span> <span class="n">setidxf</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">setidxfilt</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">setidxf</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">setidxfilt</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)]</span>
        <span class="n">sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isinset</span><span class="p">(</span><span class="n">tiidx</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">setidxf</span><span class="p">)]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="n">sort</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Remove values that does not match the indexes filter.
The filter is a reduced list of indexes.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>setidxfilt</strong> : list of lists (default None) - new reduced setidx. If None, no change.</li>
<li><strong>index</strong> : boolean (default True) - indicates if setidxfilt is a list of values (False)
or indexes (True).</li>
<li><strong>fast</strong> : boolean (default False). If True, fast operation (reduction controls)</li>
<li><strong>inplace</strong> : boolean (default True) - if True, new setidx is apply to self,
if False a new Ilist is created.</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>None</strong>, if inplace. <strong>Ilist</strong> if not inplace</li>
</ul>
</div>


                            </div>
                            <div id="Ilist.sort" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.sort">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">sort</span><span class="signature">(self, sort=[], order=[], reindex=True, inplace=True, fast=False)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="p">[],</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">reindex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; sort : calculate a new list order</span>
<span class="sd">        Change the order of extval and iidx with a new order (order can be a subset of the items list).or a specific sort</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **order** : list (default [])- new order of index to apply. If [], the sort </span>
<span class="sd">        function is applied to extval.</span>
<span class="sd">        - **sort** : list (default [])- new order of resval to apply. If [], the new order</span>
<span class="sd">        is calculated.</span>
<span class="sd">        - **reindex** : boolean (default True) - if True, the index are reindexed.</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **inplace** : boolean (default True) - if True, new order is apply to self,</span>
<span class="sd">        if False a new Ilist is created.</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **None**, if inplace. **Ilist** if not inplace&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sortidx</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">sort</span><span class="p">,</span> <span class="n">reindex</span><span class="p">,</span> <span class="n">fast</span><span class="p">),</span> <span class="n">inplace</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>sort : calculate a new list order
Change the order of extval and iidx with a new order (order can be a subset of the items list).or a specific sort</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>order</strong> : list (default [])- new order of index to apply. If [], the sort 
function is applied to extval.</li>
<li><strong>sort</strong> : list (default [])- new order of resval to apply. If [], the new order
is calculated.</li>
<li><strong>reindex</strong> : boolean (default True) - if True, the index are reindexed.</li>
<li><strong>fast</strong> : boolean (default False). If True, fast operation (reduction controls)</li>
<li><strong>inplace</strong> : boolean (default True) - if True, new order is apply to self,
if False a new Ilist is created.</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>None</strong>, if inplace. <strong>Ilist</strong> if not inplace</li>
</ul>
</div>


                            </div>
                            <div id="Ilist.sortidx" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.sortidx">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">sortidx</span><span class="signature">(self, order=[], sort=[], reindex=True, fast=False)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">sortidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">sort</span><span class="o">=</span><span class="p">[],</span> <span class="n">reindex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Define a new order to apply to extval and iidx (reorder method).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **order** : list (default [])- new order of index to apply in sort function.</span>
<span class="sd">        If [], the sort function is applied to extval.</span>
<span class="sd">        - **sort** : list (default [])- new order of resval to apply. If [], the new order</span>
<span class="sd">        is calculated.</span>
<span class="sd">        - **reindex** : boolean (default True) - if True, the index are reindexed.</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **list** : sort - new order to apply&#39;&#39;&#39;</span>
        <span class="c1">#if sorted(sort) == sorted(self.extval): return sort</span>
        <span class="k">if</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sort</span><span class="p">])</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">]):</span> <span class="k">return</span> <span class="n">sort</span>
        <span class="n">newsetidx</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">))]</span>
        <span class="n">newiidx</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ilist</span><span class="o">.</span><span class="n">_reindexidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">newsetidx</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">fast</span><span class="p">)</span>
                   <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">reindex</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="n">newiidx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span> <span class="o">=</span> <span class="n">newsetidx</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="p">:</span> <span class="n">idx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">newiidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">order</span><span class="p">]</span>
        <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">)</span>
        <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))))</span>
        <span class="k">return</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="n">idx</span><span class="p">)))[</span><span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Define a new order to apply to extval and iidx (reorder method).</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>order</strong> : list (default [])- new order of index to apply in sort function.
If [], the sort function is applied to extval.</li>
<li><strong>sort</strong> : list (default [])- new order of resval to apply. If [], the new order
is calculated.</li>
<li><strong>reindex</strong> : boolean (default True) - if True, the index are reindexed.</li>
<li><strong>fast</strong> : boolean (default False). If True, fast operation (reduction controls)</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>list</strong> : sort - new order to apply</li>
</ul>
</div>


                            </div>
                            <div id="Ilist.swapindex" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.swapindex">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">swapindex</span><span class="signature">(self, order)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">swapindex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Change the order of the index (iidx, setidx, idxname).</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **order** : list - new order of index to apply.</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="c1">#if not isinstance(order, list) or len(order) != self.lenidx :</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;order lenght not correct&quot;</span><span class="p">)</span>
        <span class="n">iidx</span>    <span class="o">=</span> <span class="p">[]</span>
        <span class="n">setidx</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="n">idxname</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order</span> <span class="p">:</span>
            <span class="n">iidx</span><span class="o">.</span><span class="n">append</span>  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>  <span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">setidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">idxname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span>   <span class="o">=</span> <span class="n">iidx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span> <span class="o">=</span> <span class="n">setidx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idxname</span> <span class="o">=</span> <span class="n">idxname</span>
</pre></div>

        </details>

            <div class="docstring"><p>Change the order of the index (iidx, setidx, idxname).</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>order</strong> : list - new order of index to apply.</li>
</ul>

<p><em>Returns</em> : none</p>
</div>


                            </div>
                            <div id="Ilist.to_file" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.to_file">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">to_file</span><span class="signature">(self, file, **kwargs)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate il file to display `Ilist` data.</span>

<span class="sd">         *Parameters (kwargs)*</span>

<span class="sd">        - **file** : string - file name (with path)</span>
<span class="sd">        - **kwargs** : see &#39;to_obj&#39; parameters</span>

<span class="sd">        *Returns*</span>

<span class="sd">        - **Integer** : file lenght (bytes)  &#39;&#39;&#39;</span>
        <span class="n">option</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encode_format&#39;</span><span class="p">:</span> <span class="s1">&#39;cbor&#39;</span><span class="p">,</span> <span class="s1">&#39;json_res_index&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span> <span class="o">|</span> <span class="n">kwargs</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;encoded&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_obj</span><span class="p">(</span><span class="o">**</span><span class="n">option</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bson&#39;</span><span class="p">,</span> <span class="s1">&#39;cbor&#39;</span><span class="p">]:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">size</span>
</pre></div>

        </details>

            <div class="docstring"><p>Generate il file to display <code><a href="#Ilist">Ilist</a></code> data.</p>

<p><em>Parameters (kwargs)</em></p>

<ul>
<li><strong>file</strong> : string - file name (with path)</li>
<li><strong>kwargs</strong> : see 'to_obj' parameters</li>
</ul>

<p><em>Returns</em></p>

<ul>
<li><strong>Integer</strong> : file lenght (bytes)</li>
</ul>
</div>


                            </div>
                            <div id="Ilist.to_csv" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.to_csv">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">to_csv</span><span class="signature">(
    self,
    filename=&#39;ilist.csv&#39;,
    func=None,
    ifunc=[],
    valfirst=False,
    order=[],
    header=True,
    **kwargs
)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;ilist.csv&#39;</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ifunc</span><span class="o">=</span><span class="p">[],</span> <span class="n">valfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">order</span><span class="o">=</span><span class="p">[],</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate a csv file with Ilist data (a column for extval and each extidx)</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **filename** : string (default &#39;ilist.csv&#39;) - name of the file to create</span>
<span class="sd">        - **func** : function (default none) - function to apply to extval before writting csv file</span>
<span class="sd">        - **ifunc** : list of function (default []) - function to apply to extidx</span>
<span class="sd">        before writting csv file</span>
<span class="sd">        - **valfirst** : boolean (default False). If False extval is the last columns,</span>
<span class="sd">         else it&#39;s the first</span>
<span class="sd">        - **order** : list of integer (default []) - ordered list of index in columns</span>
<span class="sd">        - **header** : boolean (default True). If True, the first raw is dedicated to names</span>
<span class="sd">        - **kwargs** : parameter for csv.writer or func</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span> <span class="n">order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONNUMERIC</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">extidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span>
            <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">valfirst</span>      <span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">order</span> <span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">valfirst</span>  <span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valname</span><span class="p">)</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ifunc</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span> <span class="n">funci</span> <span class="o">=</span> <span class="n">func</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span> <span class="p">:</span> <span class="n">funci</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">valfirst</span>      <span class="p">:</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">func</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">order</span> <span class="p">:</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="n">extidx</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">funci</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">valfirst</span>  <span class="p">:</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">func</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">size</span>
</pre></div>

        </details>

            <div class="docstring"><p>Generate a csv file with Ilist data (a column for extval and each extidx)</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>filename</strong> : string (default 'ilist.csv') - name of the file to create</li>
<li><strong>func</strong> : function (default none) - function to apply to extval before writting csv file</li>
<li><strong>ifunc</strong> : list of function (default []) - function to apply to extidx
before writting csv file</li>
<li><strong>valfirst</strong> : boolean (default False). If False extval is the last columns,
else it's the first</li>
<li><strong>order</strong> : list of integer (default []) - ordered list of index in columns</li>
<li><strong>header</strong> : boolean (default True). If True, the first raw is dedicated to names</li>
<li><strong>kwargs</strong> : parameter for csv.writer or func</li>
</ul>

<p><em>Returns</em> : none</p>
</div>


                            </div>
                            <div id="Ilist.to_numpy" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.to_numpy">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">to_numpy</span><span class="signature">(self, func=None, ind=&#39;axe&#39;, fillvalue=None, fast=False, **kwargs)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="s1">&#39;axe&#39;</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Complete the Ilist and generate a Numpy array with the dimension define by ind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **func** : function (default none) - function to apply to extval before export</span>
<span class="sd">        - **ind** : string (default &#39;axe&#39;) - &#39;axe&#39; -&gt; independant axes,</span>
<span class="sd">        &#39;all&#39; -&gt; all axes, &#39;flat&#39; -&gt; one list</span>
<span class="sd">        - **fillvalue** : object (default &#39;?&#39;) - value used for the new extval</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **kwargs** : parameter for func</span>

<span class="sd">        *Returns* : </span>
<span class="sd">            </span>
<span class="sd">        - **np.array** : if ind=&#39;flat</span>
<span class="sd">        - **tuple (np.array, list of index)** : if ind = &#39;axe&#39; or &#39;all&#39;</span>
<span class="sd">        - **none** :  else&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">consistent</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;unable to generate numpy array with inconsistent Ilist&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ind</span> <span class="o">==</span> <span class="s1">&#39;flat&#39;</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tonumpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ind</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;axe&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]</span>  <span class="p">:</span>
            <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="s1">&#39;axe&#39;</span> <span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span> <span class="c1">#!!!axes</span>
            <span class="k">else</span> <span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">))</span>
            <span class="n">ilf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">fillvalue</span><span class="p">)</span>
            <span class="n">ilf</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tonumpy</span><span class="p">(</span><span class="n">ilf</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">ilf</span><span class="o">.</span><span class="n">idxlen</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">]),</span>
                    <span class="p">[</span><span class="n">ilf</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">])</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>

        </details>

            <div class="docstring"><p>Complete the Ilist and generate a Numpy array with the dimension define by ind.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>func</strong> : function (default none) - function to apply to extval before export</li>
<li><strong>ind</strong> : string (default 'axe') - 'axe' -> independant axes,
'all' -> all axes, 'flat' -> one list</li>
<li><strong>fillvalue</strong> : object (default '?') - value used for the new extval</li>
<li><strong>fast</strong> : boolean (default False). If True, fast operation (reduction controls)</li>
<li><strong>kwargs</strong> : parameter for func</li>
</ul>

<p><em>Returns</em> : </p>

<ul>
<li><strong>np.array</strong> : if ind='flat</li>
<li><strong>tuple (np.array, list of index)</strong> : if ind = 'axe' or 'all'</li>
<li><strong>none</strong> :  else</li>
</ul>
</div>


                            </div>
                            <div id="Ilist.to_obj" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.to_obj">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">to_obj</span><span class="signature">(self, **kwargs)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">to_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return a formatted object with val (extval or ival) and idx (extidx or iidx or none).</span>
<span class="sd">        Format can be json, bson or cbor</span>
<span class="sd">        object can be string, bytes or dict</span>

<span class="sd">        *Parameters (kwargs)*</span>

<span class="sd">        - **encoded** : boolean (default False) - choice for return format (string/bytes if True, dict else)</span>
<span class="sd">        - **encode_format**  : string (default &#39;json&#39;)- choice for return format (bson, json, cbor)</span>
<span class="sd">        - **json_res_index** : default False - if True add the index to the value</span>
<span class="sd">        - **order** : default [] - list of ordered index</span>
<span class="sd">        - **fast** : boolean (default False). If True, fast operation (reduction controls)</span>
<span class="sd">        - **codif** : dict (default ES.codeb). Numerical value for string in CBOR encoder</span>

<span class="sd">        *Returns* : string, bytes or dict&#39;&#39;&#39;</span>
        <span class="n">option</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encoded&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;encode_format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span>  <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="p">[],</span>
                  <span class="s1">&#39;json_res_index&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;fast&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;codif&#39;</span><span class="p">:</span> <span class="p">{}}</span> <span class="o">|</span> <span class="n">kwargs</span>
        <span class="n">option2</span> <span class="o">=</span> <span class="n">option</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;encoded&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="n">optidxref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">complete</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;json_res_index&#39;</span><span class="p">]</span>
        <span class="n">nulres</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valname</span> <span class="o">==</span> <span class="s1">&#39;default value&#39;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">extval</span>
        <span class="c1">#print(&#39;optidxref nulres &#39;, optidxref, nulres)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]:</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span><span class="p">))</span>
        <span class="c1">#if not nulres and (option[&#39;order&#39;] == list(range(self.lenidx)) or optidxref):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nulres</span> <span class="ow">and</span> <span class="n">optidxref</span><span class="p">:</span>
            <span class="n">ils</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">option</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ils</span><span class="o">.</span><span class="n">swapindex</span><span class="p">(</span><span class="n">option</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">ils</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">js</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">js</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;fast&#39;</span><span class="p">]</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ils</span><span class="o">.</span><span class="n">setidx</span><span class="p">)):</span> 
                <span class="k">if</span> <span class="n">ils</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;default index&#39;</span><span class="p">:</span> <span class="n">js</span><span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ils</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="c1">#js[ils.idxname[i]] = ils.setidx[i]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nulres</span><span class="p">:</span> <span class="n">js</span><span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">valname</span><span class="p">]</span> <span class="o">=</span> <span class="n">ils</span><span class="o">.</span><span class="n">extval</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ils</span><span class="o">.</span><span class="n">setidx</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">ils</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;default index&#39;</span><span class="p">:</span> <span class="n">js</span><span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_json</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="o">**</span><span class="n">option2</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">ils</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="c1">#js[ils.idxname[i]] = [self._json(idx, **option2) for idx in ils.setidx[i]]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nulres</span><span class="p">:</span> 
                <span class="n">js</span><span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">valname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_json</span><span class="p">(</span><span class="n">ils</span><span class="o">.</span><span class="n">extval</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">**</span><span class="n">option2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ils</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">optidxref</span><span class="p">:</span>
            <span class="n">dicidxref</span> <span class="o">=</span> <span class="n">ils</span><span class="o">.</span><span class="n">dicidxref</span>
            <span class="k">if</span> <span class="n">dicidxref</span> <span class="p">:</span> <span class="n">js</span><span class="p">[</span><span class="s1">&#39;idxref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dicidxref</span>
        <span class="c1">#elif option[&#39;encoded&#39;] and option[&#39;bjson_bson&#39;] and not nulres:</span>
        <span class="k">elif</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;bson&#39;</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encoded&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">nulres</span><span class="p">:</span>
            <span class="n">js</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ils</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ils</span><span class="o">.</span><span class="n">axesmulti</span><span class="p">],</span>  <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;u2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
            <span class="c1">#js[&#39;index&#39;] = np.array(ils.iidx,  dtype=&#39;u2&#39;).tobytes()</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">nulres</span><span class="p">:</span> <span class="n">js</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ils</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ils</span><span class="o">.</span><span class="n">axesmulti</span><span class="p">]</span>
        <span class="c1">#elif not nulres: js[&#39;index&#39;] = [ils.iidx[i] if i in ils.axesmulti else [0] for i in ils.axesall]</span>
        <span class="c1">#elif not nulres: js[&#39;index&#39;] = ils.iidx</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;codif&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;bson&#39;</span><span class="p">:</span>
            <span class="n">js2</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">js</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;codif&#39;</span><span class="p">]:</span> <span class="n">js2</span><span class="p">[</span><span class="n">option</span><span class="p">[</span><span class="s1">&#39;codif&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">js2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">js2</span> <span class="o">=</span> <span class="n">js</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encoded&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span> 
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span> <span class="n">js2</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">IlistEncoder</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encoded&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bson&#39;</span><span class="p">:</span> 
            <span class="k">return</span> <span class="n">bson</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">js2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encoded&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;encode_format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;cbor&#39;</span><span class="p">:</span> 
            <span class="k">return</span> <span class="n">cbor2</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">js2</span><span class="p">,</span> <span class="n">datetime_as_timestamp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                               <span class="n">timezone</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">,</span> <span class="n">canonical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">js2</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return a formatted object with val (extval or ival) and idx (extidx or iidx or none).
Format can be json, bson or cbor
object can be string, bytes or dict</p>

<p><em>Parameters (kwargs)</em></p>

<ul>
<li><strong>encoded</strong> : boolean (default False) - choice for return format (string/bytes if True, dict else)</li>
<li><strong>encode_format</strong>  : string (default 'json')- choice for return format (bson, json, cbor)</li>
<li><strong>json_res_index</strong> : default False - if True add the index to the value</li>
<li><strong>order</strong> : default [] - list of ordered index</li>
<li><strong>fast</strong> : boolean (default False). If True, fast operation (reduction controls)</li>
<li><strong>codif</strong> : dict (default ES.codeb). Numerical value for string in CBOR encoder</li>
</ul>

<p><em>Returns</em> : string, bytes or dict</p>
</div>


                            </div>
                            <div id="Ilist.to_xarray" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.to_xarray">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">to_xarray</span><span class="signature">(
    self,
    info=False,
    axes=[],
    dimmax=-1,
    fillvalue=&#39;?&#39;,
    func=None,
    ifunc=[],
    name=&#39;Ilist&#39;,
    **kwargs
)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">to_xarray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[],</span> <span class="n">dimmax</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                  <span class="n">ifunc</span><span class="o">=</span><span class="p">[],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ilist&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Complete the Ilist and generate a Xarray DataArray with the dimension define by ind.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **info** : boolean (default False) - if True, add _dict attributes to attrs Xarray</span>
<span class="sd">        - **axes** : list (default []) - list of index to be completed. If [],</span>
<span class="sd">        self.axes is used.</span>
<span class="sd">        - **dimmax** : int (default -1) - max Xarray dimension (only if axes=[])</span>
<span class="sd">        - **fillvalue** : object (default &#39;?&#39;) - value used for the new extval</span>
<span class="sd">        - **func** : function (default none) - function to apply to extval before export</span>
<span class="sd">        - **ifunc** : list of function (default []) - function to apply to</span>
<span class="sd">        extidx before export</span>
<span class="sd">        - **name** : string (default &#39;Ilist&#39;) - DataArray name</span>
<span class="sd">        - **kwargs** : parameter for func and ifunc</span>

<span class="sd">        *Returns* : none &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">consistent</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;Ilist not consistent&quot;</span><span class="p">)</span>
        <span class="n">lenidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span>
        <span class="k">if</span> <span class="n">axes</span><span class="o">==</span><span class="p">[]</span> <span class="p">:</span> 
            <span class="n">axe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span>
            <span class="n">coup</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axe</span><span class="p">)</span> <span class="o">-</span> <span class="n">dimmax</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">coup</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">coup</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">axe</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mergeidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axescoupling</span><span class="p">(</span><span class="n">axe</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">coup</span><span class="p">])</span>
                <span class="n">axe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesmin</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="n">ilf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axe</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">fillvalue</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swapindex</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">lenidx</span><span class="p">)))</span>
        <span class="n">ilf</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">ilf</span><span class="o">.</span><span class="n">_xcoord</span><span class="p">(</span><span class="n">axe</span><span class="p">,</span> <span class="n">ifunc</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="n">ilf</span><span class="o">.</span><span class="n">idxname</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ilf</span><span class="o">.</span><span class="n">_tonumpy</span><span class="p">(</span><span class="n">ilf</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">ilf</span><span class="o">.</span><span class="n">idxlen</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">axe</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">info</span> <span class="p">:</span> <span class="k">return</span> <span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">ilf</span><span class="o">.</span><span class="n">_dict</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Complete the Ilist and generate a Xarray DataArray with the dimension define by ind.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>info</strong> : boolean (default False) - if True, add _dict attributes to attrs Xarray</li>
<li><strong>axes</strong> : list (default []) - list of index to be completed. If [],
self.axes is used.</li>
<li><strong>dimmax</strong> : int (default -1) - max Xarray dimension (only if axes=[])</li>
<li><strong>fillvalue</strong> : object (default '?') - value used for the new extval</li>
<li><strong>func</strong> : function (default none) - function to apply to extval before export</li>
<li><strong>ifunc</strong> : list of function (default []) - function to apply to
extidx before export</li>
<li><strong>name</strong> : string (default 'Ilist') - DataArray name</li>
<li><strong>kwargs</strong> : parameter for func and ifunc</li>
</ul>

<p><em>Returns</em> : none</p>
</div>


                            </div>
                            <div id="Ilist.unconsistent" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.unconsistent">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">unconsistent</span><span class="signature">(self)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">unconsistent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return a key/value dict with the number of occurences (value) for each</span>
<span class="sd">        indice-tuple (key) with multi-occurences&#39;&#39;&#39;</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="c1">#act = {tuple(self._indtoext(list(it))) for it in Counter(self._tuple(tiidx)).items() if it[1] &gt;1}</span>
        <span class="k">return</span> <span class="p">{</span><span class="nb">tuple</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_indtoext</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">])))):</span> <span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
                <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tuple</span><span class="p">(</span><span class="n">tiidx</span><span class="p">))</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span><span class="mi">1</span><span class="p">}</span>
        <span class="c1">#return dict(self._list(act))</span>
</pre></div>

        </details>

            <div class="docstring"><p>return a key/value dict with the number of occurences (value) for each
indice-tuple (key) with multi-occurences</p>
</div>


                            </div>
                            <div id="Ilist.updateidx" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.updateidx">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">updateidx</span><span class="signature">(self, indval, extind, unique=False)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">updateidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indval</span><span class="p">,</span> <span class="n">extind</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update the index of an extval.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **indval** : integer - row of the value in extval</span>
<span class="sd">        - **extind** : list - new value for each extidx</span>
<span class="sd">        - **unique** :  boolean (default False) - If True and extind present in textidx,</span>
<span class="sd">        update is refuse.</span>

<span class="sd">        *Returns* : none&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenidx</span> <span class="ow">or</span> <span class="n">indval</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">indval</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;out of bounds&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iseIndex</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span> <span class="ow">and</span> <span class="n">unique</span> <span class="p">:</span> <span class="k">return</span>
        <span class="n">tiidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiidx</span>
        <span class="n">tiidx</span><span class="p">[</span><span class="n">indval</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateset</span><span class="p">(</span><span class="n">extind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span><span class="p">(</span><span class="n">tiidx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Update the index of an extval.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>indval</strong> : integer - row of the value in extval</li>
<li><strong>extind</strong> : list - new value for each extidx</li>
<li><strong>unique</strong> :  boolean (default False) - If True and extind present in textidx,
update is refuse.</li>
</ul>

<p><em>Returns</em> : none</p>
</div>


                            </div>
                            <div id="Ilist.updatelist" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.updatelist">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">updatelist</span><span class="signature">(self, extlist, idx=None)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">updatelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extlist</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update extval or extidx.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **extlist** : list of list - list of values to update</span>
<span class="sd">        - **idx** : list of integer - list of index to update (idx=-1 for extval)</span>

<span class="sd">        *Returns* : none&#39;&#39;&#39;</span>
        <span class="n">extlis</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkidxlist</span><span class="p">(</span><span class="n">extlist</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">extlis</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">IlistError</span><span class="p">(</span><span class="s2">&quot;out of bounds&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">extl</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">extlis</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">extval</span>      <span class="o">=</span> <span class="n">extl</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toset</span><span class="p">(</span><span class="n">extl</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toint</span><span class="p">(</span><span class="n">extl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetidx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extidx</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Update extval or extidx.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>extlist</strong> : list of list - list of values to update</li>
<li><strong>idx</strong> : list of integer - list of index to update (idx=-1 for extval)</li>
</ul>

<p><em>Returns</em> : none</p>
</div>


                            </div>
                            <div id="Ilist.vlist" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Ilist.vlist">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">vlist</span><span class="signature">(self, *args, func=None, idx=None, **kwargs)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">vlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Apply a function to extval or extidx and return the result.</span>

<span class="sd">        *Parameters*</span>

<span class="sd">        - **func** : function (default none) - function to apply to extval or extidx</span>
<span class="sd">        - **args, kwargs** : parameters for the function</span>
<span class="sd">        - **idx** : integer - index to update (idx=-1 for extval)</span>

<span class="sd">        *Returns* : list of func result&#39;&#39;&#39;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkidxlist</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">extidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extidx</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extval</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funclist</span><span class="p">(</span><span class="n">extidx</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Apply a function to extval or extidx and return the result.</p>

<p><em>Parameters</em></p>

<ul>
<li><strong>func</strong> : function (default none) - function to apply to extval or extidx</li>
<li><strong>args, kwargs</strong> : parameters for the function</li>
<li><strong>idx</strong> : integer - index to update (idx=-1 for extval)</li>
</ul>

<p><em>Returns</em> : list of func result</p>
</div>


                            </div>
                </section>
                <section id="IlistError">
                                <div class="attr class">
        <a class="headerlink" href="#IlistError">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">IlistError</span><wbr>(<span class="base">builtins.Exception</span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">class</span> <span class="nc">IlistError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Ilist Exception&#39;&#39;&#39;</span>
    <span class="c1">#pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>Ilist Exception</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.Exception</dt>
                                <dd id="IlistError.__init__" class="function">Exception</dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="IlistError.with_traceback" class="function">with_traceback</dd>
                <dd id="IlistError.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>