<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 11.0.0"/>
    <title>ES API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(:first-of-type){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;cursor:pointer;}.pdoc details > summary:focus{outline:0;}.pdoc > section:first-of-type details > summary{top:-20px;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>
            <img src="https://loco-philippe.github.io/ES/logo_loco.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

        <h2>Contents</h2>
        <ul>
  <li><a href="#environmental-sensing-package"><strong><em>Environmental Sensing Package</em></strong></a></li>
</ul></li>
<li><a href="#why-a-project-for-environmental-data">Why a project for Environmental Data ?</a>
<ul>
  <li><a href="#the-environmental-sensing-project">The Environmental Sensing project</a></li>
  <li><a href="#main-principles">Main principles</a>
  <ul>
    <li><a href="#standards">Standards</a></li>
    <li><a href="#observation">Observation</a></li>
    <li><a href="#data-structure">Data structure</a></li>
    <li><a href="#index">Index</a></li>
    <li><a href="#dimension">Dimension</a></li>
    <li><a href="#configuration-and-customization">Configuration and customization</a></li>
    <li><a href="#observation-management">Observation management</a></li>
    <li><a href="#json-interface">Json interface</a></li>
    <li><a href="#binary-sensor-interface">Binary sensor interface</a></li>
    <li><a href="#bluetooth-mapping">Bluetooth mapping</a></li>
    <li><a href="#xarray-mapping">Xarray mapping</a></li>
  </ul></li>
  <li><a href="#getting-started">Getting Started</a>
  <ul>
    <li><a href="#first-observation">First Observation</a></li>
    <li><a href="#observation-for-sensor">Observation for sensor</a></li>
    <li><a href="#dimension-concept">Dimension concept</a></li>
    <li><a href="#observation-management-2">Observation management</a></li>
  </ul></li>
  <li><a href="#quick-overview">Quick overview</a>
  <ul>
    <li><a href="#create-an-observation">Create an Observation</a></li>
    <li><a href="#generate-an-exchange-format">Generate an Exchange format</a></li>
    <li><a href="#managing-observations">Managing Observations</a></li>
    <li><a href="#interface">Interface</a></li>
  </ul></li>
  <li><a href="#developers-documentation">Developers documentation</a>
  <ul>
    <li><a href="#data-model">Data model</a></li>
  </ul></li>
</ul>


        <h2>Submodules</h2>
        <ul>
                <li><a href="ES/ESObservation.html">ES.ESObservation</a></li>
                <li><a href="ES/ESValue.html">ES.ESValue</a></li>
                <li><a href="ES/ESconstante.html">ES.ESconstante</a></li>
                <li><a href="ES/check_property_relationship.html">ES.check_property_relationship</a></li>
                <li><a href="ES/iindex.html">ES.iindex</a></li>
                <li><a href="ES/ilist.html">ES.ilist</a></li>
                <li><a href="ES/jeu.html">ES.jeu</a></li>
                <li><a href="ES/openlocationcode.html">ES.openlocationcode</a></li>
                <li><a href="ES/test_all.html">ES.test_all</a></li>
                <li><a href="ES/test_esvalue.html">ES.test_esvalue</a></li>
                <li><a href="ES/test_iindex.html">ES.test_iindex</a></li>
                <li><a href="ES/test_ilist.html">ES.test_ilist</a></li>
                <li><a href="ES/test_mongo.html">ES.test_mongo</a></li>
                <li><a href="ES/test_observation.html">ES.test_observation</a></li>
                <li><a href="ES/test_slot.html">ES.test_slot</a></li>
                <li><a href="ES/timeslot.html">ES.timeslot</a></li>
                <li><a href="ES/util.html">ES.util</a></li>
        </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section>
                    <h1 class="modulename">
ES    </h1>

                        <div class="docstring"><h2 id="environmental-sensing-package"><strong><em>Environmental Sensing Package</em></strong></h2>

<p>Created on Fri Dec 24 15:21:14 2021</p>

<p>@author: philippe@loco-labs.io</p>

<h1 id="why-a-project-for-environmental-data">Why a project for Environmental Data ?</h1>

<p>The project was born from the following observations:</p>

<ul>
<li>there is no standard format (apart from the Environmental Sensing Service Bluetooth) 
used by the sensors to transmit the information (binary and textual),</li>
<li>there is no data exchange format presenting at the same time a temporal, 
spatial and physical component (apart from file formats),</li>
<li>we spend a lot of energy converting this type of data to make it usable.</li>
</ul>

<h1 id="the-environmental-sensing-project">The Environmental Sensing project</h1>

<p>The ES project is made of :</p>

<ul>
<li>A data model that makes it possible to represent elementary observations 
(a simple one-off measurement), complex observations (multi-dimensions), 
detailed levels of representation (for example, the evolution of a plume of smoke).</li>
<li>Data formats adapted to interfaces (binary payload for networks, json for requests 
or for NoSQL API, files)</li>
<li>A library of connectors for different uses (sensors, database, storage, networks, etc.) 
in différents languages (python, C++)</li>
<li>Bidirectional interfaces to data processing tools (eg Numpy, Xarray, GIS).</li>
</ul>

<p>It allows to :</p>

<ul>
<li>Facilitate the use and sharing of environmental data</li>
<li>Standardize both data acquisition equipment (sensors) and processing applications,</li>
<li>Implement a software architecture replacing all coding / decoding operations 
(interfaces) by the use of standard connectors,</li>
<li>Respect and rely on the main existing standards</li>
<li>Collectively share and develop a set of open-source connectors responding to 
all situations (platform)</li>
</ul>

<h1 id="main-principles">Main principles</h1>

<h2 id="standards">Standards</h2>

<p>The main standard about Environmental Data is the ISO-19156 "observation and 
measurement" standard :    </p>

<p><em>"This International Standard defines a conceptual schema for observations, and 
for features involved in sampling when making observations. These provide models 
for the exchange of information describing observation acts and their results, 
both within and between different scientific and technical communities."</em> </p>

<p>But this standard specifies that: </p>

<p><em>"ISO 19156 concerns only interfaces visible from the outside and
 does not impose any restrictions on the underlying implementations"</em></p>

<p>The other standards concern more restricted areas and are sometimes incompatible. 
They often remain at a syntactic and non-semantic level.
The proposed data structure is based on existing standards that it complements 
by ensuring convergence:    </p>

<p><img src="./ES/standard.png" width="800"></p>

<h2 id="observation">Observation</h2>

<p>In the ISO-19156 standard, an Observation is characterized by:</p>

<ul>
<li>"observed property": the observed property,</li>
<li>"feature of interest": the object (most often a location) of the observation,</li>
<li>"procedure": the information acquisition mode (sensor, model, etc.)</li>
<li>"result": result of the observation or the measurement</li>
</ul>

<p>The result is a set of values or objects ​​referenced according to the 3 dimensions:</p>

<ul>
<li>temporal,</li>
<li>spatial,</li>
<li>physical (observed property)</li>
</ul>

<p><img src="./ES/structure.png" width="800"></p>

<p>In the ES project, the three dimensions are respected but it is possible to add 
other dimensions. </p>

<p>An Observation object consists of five components : </p>

<ul>
<li>a set of Features (Datation Object, Location Object, Property Object, Variable Object)</li>
<li>a Result Object</li>
<li>an Index object (link between Result and Axes)</li>
<li>a Parameter object</li>
</ul>

<p>It can be converted into a multi-dimensional matrix (one dimension for each Feature), 
each result being indexed by Features Values (e.g. temporal, spatial, physical values).</p>

<p>Common properties (indicators) are associated with each Observation. 
They allow processing to be performed on Observations without having to know 
their composition (e.g. bounding boxes, type of observation, volume, etc.).   </p>

<h2 id="data-structure">Data structure</h2>

<p>The implemented data structure respects the principles of the standard. </p>

<p>An Observation object groups common data (name, options, parameters) and associates
 each of the Features </p>

<ul>
<li>spatial (LocationValue objects)</li>
<li>temporal (DatingValue objects)</li>
<li>properties (PropertyValue objects)</li>
<li>others (NamedValue, ExternValue objects)</li>
</ul>

<p>to results (any objects).</p>

<p><img src="./ES/ESmodel.png" width="600"></p>

<p>An Observation can represent both a single measurement and a large historical data set.</p>

<h2 id="index">Index</h2>

<p><img src="./ES/index.png" width="800"></p>

<p>In the usual tabular representations (like Excel or csv) there is one row for each Result
and a lot of columns for Datation, Location and Property.
This representation is simple and readable, but it duplicates the information and
 is not suitable for updates. </p>

<p>In the ES project, we choose the indexed representation suitable for computer 
processing. Thus, the Result object is made up of its own attributes as well as
 an index to the Features objects. </p>

<h2 id="dimension">Dimension</h2>

<p><img src="./ES/dimension.png" width="800"></p>

<p>A result is associated with a property, a location and a date. The Result Object 
is therefore indexed with three axes (dimension = 3). But there are two cases 
where the dimension is reduced:</p>

<ul>
<li>if an axis has only one value</li>
<li>if two axes are coupled</li>
</ul>

<p>For example, if on a path we measure a property, the dimension is 1 (Location 
and Datation are coupled, Property has one value).</p>

<p>This notion is important because it conditions the modes of representation
 (e.g., plot).</p>

<h2 id="configuration-and-customization">Configuration and customization</h2>

<p>Parameters and additional information may be added at different levels:</p>

<ul>
<li>global : At the Observation level, we may add specific informations with specific 
key / value e.g.:
<ul>
<li><em>{ 'type' : 'observation' ,<strong>'test campaign' : 'first'</strong>, 
'datation' : 'morning' , 'location' : 'paris' , 'property' : ' Temp' , 
'result' : 'high' }</em></li>
</ul></li>
<li>local : We may customize the 'name' attribute e.g.:
<ul>
<li><em>'datation' : [ { <strong>'first campaign'</strong> : '2021-01-01' } , { <strong>'second campaign'</strong> : ''2021-03-01' } ]</li>
<li>'property' : [ { <strong>'inside'</strong> : 'Temp' } , { <strong>'outside'</strong> : 'Temp' } ]</em></li>
</ul></li>
<li>individual : Each Result value may be annotate e.g.:
<ul>
<li><em>'result' : { <strong>'first result'</strong> : 'high' }</li>
<li>'result' : {<strong>'https://loco-philippe.github.io/ES.html'</strong> : 'high' }</em></li>
</ul></li>
</ul>

<p>The PropertyValues are defined in a catalogue which may be specific. </p>

<h2 id="observation-management">Observation management</h2>

<p>Some operations are available for Observation objects</p>

<ul>
<li><p>between two Observation :</p>

<ul>
<li>Addition function : The Result values are added</li>
<li>Extend function : The axes are added (e.g. template Observation)</li>
<li>Append function : An Observation is included as a Result value (e.g. tree structure)</li>
</ul></li>
</ul>

<p><img src="./ES/extension.png" width="800"></p>

<ul>
<li><p>for one Observation :</p>

<ul>
<li>Sort function : changing the order of data according to the axes order</li>
<li>Find function : selecting some data </li>
<li>Full function : add empty Result value to complete an Observation</li>
</ul></li>
</ul>

<p><img src="./ES/extraction.png" width="800"></p>

<p>These operations make it possible to cut, group, restructure and classify the 
Observations.</p>

<h2 id="json-interface">Json interface</h2>

<p>The JSON format is used for Observation interchange. The ObsJSON format support
 the Observation data model. This means that an Observation generated from a 
 JSON format from another Observation is identical to this one.</p>

<p>This format is defined in the 
<a href="https://github.com/loco-philippe/Environnemental-Sensing/blob/main/documentation/ObsJSON%20-%20Standard.pdf" 
target="_blank">ObsJSON document</a>.</p>

<p>This format is extended to JSON binary format which allows :</p>

<ul>
<li>storage of observation as a file</li>
<li>natural representation of dates (datetime)</li>
<li>taking into account all types of objects in binary form</li>
</ul>

<p>Two binary format are available :</p>

<ul>
<li>BSON format (used in NoSQL databases like Mongodb)</li>
<li>CBOR format (dedicated to small code size, small message size)</li>
</ul>

<h2 id="binary-sensor-interface">Binary sensor interface</h2>

<p>The binary payload is necessary for exchanges with LPWAN networks (e.g. LoRaWAN). 
The payload should be as compact as possible to minimize the Time-on-Air 
and reduce power consumption (for battery operated) devices. For example, the maximum
lenght of the payload is between 51 bytes and 222 bytes for LoRaWAN.</p>

<p>To obtain this maximum length, limitations are imposed.</p>

<p>Two formats are defined : </p>

<ul>
<li>CBOR format with optimization to insure low payload,</li>
<li>internal optimized format for the most simple usages.</li>
</ul>

<p><img src="./ES/binary.png" width="800"></p>

<p>The diagram above shows the structure of the payload.</p>

<p><em>Note : The right side of the diagram explains the coding of the values. This coding 
is the same as that used by Bluetooth in the <a href=
"https://www.bluetooth.com/specifications/specs/environmental-sensing-service-1-0/" 
target="_blank">Environmental Sensing Service</a>.</em></p>

<p>To obtain low payload, a specific process can be used (see below). It allows data
 to be sent in two stages: first send metadata, second (in operation use) send data.</p>

<p><img src="./ES/sensor.png" width="800"></p>

<h2 id="bluetooth-mapping">Bluetooth mapping</h2>

<p>The Environmental Sensing Service is a Bluetooth protocol for sensors. The data 
exposed in this protocol are compatible and consistent with the Observation data model. 
Thus, Bluetooth data is automatically converted into Observation data.</p>

<p>The diagram below shows the mapping of the two structures.</p>

<p><img src="./ES/bluetooth.png" width="800"></p>

<h2 id="xarray-mapping">Xarray mapping</h2>

<p>Xarray is very powerful to analyze and process multi-dimensional data. Xarray 
share the same principle as Observation: indexed multi-dimensional data. Thus, 
it's natural du use Xarray if you want to analyze Observation data.</p>

<p>The difference between Observation and Xarray is that Xarray uses matrix data and 
Observation uses only indexed data. Therefore, to transfer Observation data to Xarray 
we must complete data with 'nan' value to obtain a complete matrix with the right 
dimension (1, 2 or 3).</p>

<p>The diagram below shows the mapping of the two structures.</p>

<p><img src="./ES/xarray.png" width="800"></p>

<h1 id="getting-started">Getting Started</h1>

<p>The code used, the results and the explanations are provided through "Jupyter 
Notebook" indicated in link in each chapter.
The Notebook files are 
<a href="https://github.com/loco-philippe/loco-philippe.github.io/tree/main/Example" target="_blank">
stored in Github</a> and can be replayed.</p>

<h2 id="first-observation">First Observation</h2>

<p>This chapter explain you 
<a href="./Example/first_observation.html" target="_blank">(see the page here)</a> :</p>

<ul>
<li>how to create a simple and more complex Observation Object</li>
<li>the different view of the data</li>
<li>how the ObsJSON is structured </li>
</ul>

<h2 id="observation-for-sensor">Observation for sensor</h2>

<p>A sensor sends data to a server with a specific protocol. The server stores and processes the data.
The sensor how use TCP/IP sends the data with ObsJSON format (see above).
This chapter introduces you to the to binary interface and explain you:
<a href="./Example/sensor_observation.html" target="_blank">(see the page here)</a> :</p>

<ul>
<li>how to encode and decode binary data</li>
<li>the processes to obtain low data as explain in the "Binary interface" chapter</li>
</ul>

<h2 id="dimension-concept">Dimension concept</h2>

<p>The dimension is an important concept to understand (see chapter above). </p>

<p>In this example, we show you Observations with differents dimensions (1 to 3).</p>

<p>We also present how Result values without index can be loaded with the 'order' parameter.</p>

<p><a href="./Example/dimension.html" target="_blank">(see the page here)</a> :</p>

<h2 id="observation-management-2">Observation management</h2>

<p><em>Under construction</em></p>

<h1 id="quick-overview">Quick overview</h1>

<p><em>Under construction</em></p>

<h2 id="create-an-observation">Create an Observation</h2>

<p><em>Under construction</em></p>

<ul>
<li>Measuring station</li>
<li>Mobile sensor</li>
<li>Simulation</li>
<li>Access information</li>
<li>Visualize an Observation</li>
</ul>

<h2 id="generate-an-exchange-format">Generate an Exchange format</h2>

<p><em>Under construction</em></p>

<ul>
<li>Binary format</li>
<li>Json format</li>
<li>No SQL format</li>
</ul>

<h2 id="managing-observations">Managing Observations</h2>

<p><em>Under construction</em></p>

<ul>
<li>Add</li>
<li>Sort</li>
<li>Filter</li>
<li>Aggregation</li>
</ul>

<h2 id="interface">Interface</h2>

<p><em>Under construction</em></p>

<ul>
<li>Numpy export</li>
<li>Xarray export</li>
<li>File storage</li>
</ul>

<h1 id="developers-documentation">Developers documentation</h1>

<h2 id="data-model">Data model</h2>

<p>An <code>ESObservation.Observation</code> is an object representing a set of information having
spatial and temporal characteristics associated with measurable or observable
 properties.</p>

<p>The Observation Object is built around three main bricks :</p>

<ul>
<li>Ilist Object which deal with indexing,</li>
<li>ESValue Object which integrate the specificities of environmental data,</li>
<li>Tools dedicated to particular domains (<a href="https://shapely.readthedocs.io/en/stable/manual.html">Shapely</a> 
for location, TimeSlot for Datation)</li>
</ul>

<p>The ES functions are divided according to the class below:</p>

<p><img src="./ES/EShierarchie.png" width="800"></p>

<p>Modules contain the following classes:</p>

<ul>
<li><p>ESObservation : </p>

<ul>
<li><code><a href="ES/ESObservation.html">ES.ESObservation</a></code></li>
</ul></li>
<li><p>ESValue : </p>

<ul>
<li><code><a href="ES/ESValue.html">ES.ESValue</a></code>(<code><a href="ES/ESValue.html#DatationValue">ES.ESValue.DatationValue</a></code>, <code><a href="ES/ESValue.html#LocationValue">ES.ESValue.LocationValue</a></code>, <code><a href="ES/ESValue.html#PropertyValue">ES.ESValue.PropertyValue</a></code>,
<code><a href="ES/ESValue.html#NamedValue">ES.ESValue.NamedValue</a></code>, <code><a href="ES/ESValue.html#ExternValue">ES.ESValue.ExternValue</a></code>, <code><a href="ES/ESValue.html#ESValue">ES.ESValue.ESValue</a></code>)</li>
</ul></li>
<li><p>Ilist : </p>

<ul>
<li><code><a href="ES/ilist.html">ES.ilist</a></code></li>
</ul></li>
<li><p>Iindex : </p>

<ul>
<li><code><a href="ES/iindex.html">ES.iindex</a></code></li>
</ul></li>
<li><p>TimeSlot : </p>

<ul>
<li><code><a href="ES/timeslot.html">ES.timeslot</a></code></li>
</ul></li>
<li><p>ESconstante : </p>

<ul>
<li><code><a href="ES/ESconstante.html">ES.ESconstante</a></code>.</li>
</ul></li>
</ul>
</div>

                        <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">## ***Environmental Sensing Package***</span>

<span class="sd">Created on Fri Dec 24 15:21:14 2021</span>

<span class="sd">@author: philippe@loco-labs.io</span>


<span class="sd"># Why a project for Environmental Data ?</span>

<span class="sd">The project was born from the following observations:</span>
<span class="sd">    </span>
<span class="sd">- there is no standard format (apart from the Environmental Sensing Service Bluetooth) </span>
<span class="sd">used by the sensors to transmit the information (binary and textual),</span>
<span class="sd">- there is no data exchange format presenting at the same time a temporal, </span>
<span class="sd">spatial and physical component (apart from file formats),</span>
<span class="sd">- we spend a lot of energy converting this type of data to make it usable.</span>

<span class="sd"># The Environmental Sensing project</span>

<span class="sd">The ES project is made of :</span>
<span class="sd">    </span>
<span class="sd">- A data model that makes it possible to represent elementary observations </span>
<span class="sd">(a simple one-off measurement), complex observations (multi-dimensions), </span>
<span class="sd">detailed levels of representation (for example, the evolution of a plume of smoke).</span>
<span class="sd">- Data formats adapted to interfaces (binary payload for networks, json for requests </span>
<span class="sd">or for NoSQL API, files)</span>
<span class="sd">- A library of connectors for different uses (sensors, database, storage, networks, etc.) </span>
<span class="sd">in différents languages (python, C++)</span>
<span class="sd">- Bidirectional interfaces to data processing tools (eg Numpy, Xarray, GIS).</span>

<span class="sd">It allows to :</span>
<span class="sd">    </span>
<span class="sd">- Facilitate the use and sharing of environmental data</span>
<span class="sd">- Standardize both data acquisition equipment (sensors) and processing applications,</span>
<span class="sd">- Implement a software architecture replacing all coding / decoding operations </span>
<span class="sd">(interfaces) by the use of standard connectors,</span>
<span class="sd">- Respect and rely on the main existing standards</span>
<span class="sd">- Collectively share and develop a set of open-source connectors responding to </span>
<span class="sd">all situations (platform)</span>

<span class="sd"># Main principles</span>

<span class="sd">## Standards</span>

<span class="sd">The main standard about Environmental Data is the ISO-19156 &quot;observation and </span>
<span class="sd">measurement&quot; standard :    </span>

<span class="sd">*&quot;This International Standard defines a conceptual schema for observations, and </span>
<span class="sd">for features involved in sampling when making observations. These provide models </span>
<span class="sd">for the exchange of information describing observation acts and their results, </span>
<span class="sd">both within and between different scientific and technical communities.&quot;* </span>

<span class="sd">But this standard specifies that: </span>
<span class="sd">    </span>
<span class="sd">*&quot;ISO 19156 concerns only interfaces visible from the outside and</span>
<span class="sd"> does not impose any restrictions on the underlying implementations&quot;*</span>

<span class="sd">The other standards concern more restricted areas and are sometimes incompatible. </span>
<span class="sd">They often remain at a syntactic and non-semantic level.</span>
<span class="sd">The proposed data structure is based on existing standards that it complements </span>
<span class="sd">by ensuring convergence:    </span>

<span class="sd">&lt;img src=&quot;./ES/standard.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd">## Observation</span>

<span class="sd">In the ISO-19156 standard, an Observation is characterized by:</span>

<span class="sd">- &quot;observed property&quot;: the observed property,</span>
<span class="sd">- &quot;feature of interest&quot;: the object (most often a location) of the observation,</span>
<span class="sd">- &quot;procedure&quot;: the information acquisition mode (sensor, model, etc.)</span>
<span class="sd">- &quot;result&quot;: result of the observation or the measurement</span>

<span class="sd">The result is a set of values or objects ​​referenced according to the 3 dimensions:</span>

<span class="sd">- temporal,</span>
<span class="sd">- spatial,</span>
<span class="sd">- physical (observed property)</span>

<span class="sd">&lt;img src=&quot;./ES/structure.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd">In the ES project, the three dimensions are respected but it is possible to add </span>
<span class="sd">other dimensions. </span>

<span class="sd">An Observation object consists of five components : </span>
<span class="sd">    </span>
<span class="sd">- a set of Features (Datation Object, Location Object, Property Object, Variable Object)</span>
<span class="sd">- a Result Object</span>
<span class="sd">- an Index object (link between Result and Axes)</span>
<span class="sd">- a Parameter object</span>

<span class="sd">It can be converted into a multi-dimensional matrix (one dimension for each Feature), </span>
<span class="sd">each result being indexed by Features Values (e.g. temporal, spatial, physical values).</span>

<span class="sd">Common properties (indicators) are associated with each Observation. </span>
<span class="sd">They allow processing to be performed on Observations without having to know </span>
<span class="sd">their composition (e.g. bounding boxes, type of observation, volume, etc.).   </span>

<span class="sd">## Data structure</span>

<span class="sd">The implemented data structure respects the principles of the standard. </span>

<span class="sd">An Observation object groups common data (name, options, parameters) and associates</span>
<span class="sd"> each of the Features </span>
<span class="sd"> </span>
<span class="sd">- spatial (LocationValue objects)</span>
<span class="sd">- temporal (DatingValue objects)</span>
<span class="sd">- properties (PropertyValue objects)</span>
<span class="sd">- others (NamedValue, ExternValue objects)</span>

<span class="sd">to results (any objects).</span>

<span class="sd">&lt;img src=&quot;./ES/ESmodel.png&quot; width=&quot;600&quot;&gt;</span>

<span class="sd">An Observation can represent both a single measurement and a large historical data set.</span>

<span class="sd">## Index</span>

<span class="sd">&lt;img src=&quot;./ES/index.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd">In the usual tabular representations (like Excel or csv) there is one row for each Result</span>
<span class="sd">and a lot of columns for Datation, Location and Property.</span>
<span class="sd">This representation is simple and readable, but it duplicates the information and</span>
<span class="sd"> is not suitable for updates. </span>
<span class="sd"> </span>
<span class="sd">In the ES project, we choose the indexed representation suitable for computer </span>
<span class="sd">processing. Thus, the Result object is made up of its own attributes as well as</span>
<span class="sd"> an index to the Features objects. </span>

<span class="sd">## Dimension</span>

<span class="sd">&lt;img src=&quot;./ES/dimension.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd">A result is associated with a property, a location and a date. The Result Object </span>
<span class="sd">is therefore indexed with three axes (dimension = 3). But there are two cases </span>
<span class="sd">where the dimension is reduced:</span>
<span class="sd">    </span>
<span class="sd">- if an axis has only one value</span>
<span class="sd">- if two axes are coupled</span>

<span class="sd">For example, if on a path we measure a property, the dimension is 1 (Location </span>
<span class="sd">and Datation are coupled, Property has one value).</span>

<span class="sd">This notion is important because it conditions the modes of representation</span>
<span class="sd"> (e.g., plot).</span>

<span class="sd">## Configuration and customization</span>

<span class="sd">Parameters and additional information may be added at different levels:</span>
<span class="sd">    </span>
<span class="sd">- global : At the Observation level, we may add specific informations with specific </span>
<span class="sd">key / value e.g.:</span>
<span class="sd">    - *{ &#39;type&#39; : &#39;observation&#39; ,**&#39;test campaign&#39; : &#39;first&#39;**, </span>
<span class="sd">       &#39;datation&#39; : &#39;morning&#39; , &#39;location&#39; : &#39;paris&#39; , &#39;property&#39; : &#39; Temp&#39; , </span>
<span class="sd">       &#39;result&#39; : &#39;high&#39; }*</span>
<span class="sd">- local : We may customize the &#39;name&#39; attribute e.g.:</span>
<span class="sd">    - *&#39;datation&#39; : [ { **&#39;first campaign&#39;** : &#39;2021-01-01&#39; } , { **&#39;second campaign&#39;** : &#39;&#39;2021-03-01&#39; } ]</span>
<span class="sd">    - &#39;property&#39; : [ { **&#39;inside&#39;** : &#39;Temp&#39; } , { **&#39;outside&#39;** : &#39;Temp&#39; } ]*</span>
<span class="sd">- individual : Each Result value may be annotate e.g.:</span>
<span class="sd">    - *&#39;result&#39; : { **&#39;first result&#39;** : &#39;high&#39; }</span>
<span class="sd">    - &#39;result&#39; : {**&#39;https://loco-philippe.github.io/ES.html&#39;** : &#39;high&#39; }*</span>

<span class="sd">The PropertyValues are defined in a catalogue which may be specific. </span>

<span class="sd">## Observation management</span>

<span class="sd">Some operations are available for Observation objects</span>

<span class="sd">- between two Observation :</span>
<span class="sd">    </span>
<span class="sd">    - Addition function : The Result values are added</span>
<span class="sd">    - Extend function : The axes are added (e.g. template Observation)</span>
<span class="sd">    - Append function : An Observation is included as a Result value (e.g. tree structure)</span>

<span class="sd">&lt;img src=&quot;./ES/extension.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd">- for one Observation :</span>
<span class="sd">    </span>
<span class="sd">    - Sort function : changing the order of data according to the axes order</span>
<span class="sd">    - Find function : selecting some data </span>
<span class="sd">    - Full function : add empty Result value to complete an Observation</span>

<span class="sd">&lt;img src=&quot;./ES/extraction.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd">These operations make it possible to cut, group, restructure and classify the </span>
<span class="sd">Observations.</span>

<span class="sd">## Json interface</span>

<span class="sd">The JSON format is used for Observation interchange. The ObsJSON format support</span>
<span class="sd"> the Observation data model. This means that an Observation generated from a </span>
<span class="sd"> JSON format from another Observation is identical to this one.</span>

<span class="sd">This format is defined in the </span>
<span class="sd">&lt;a href=&quot;https://github.com/loco-philippe/Environnemental-Sensing/blob/main/documentation/ObsJSON%20-%20Standard.pdf&quot; </span>
<span class="sd">target=&quot;_blank&quot;&gt;ObsJSON document&lt;/a&gt;.</span>

<span class="sd">This format is extended to JSON binary format which allows :</span>
<span class="sd">    </span>
<span class="sd">- storage of observation as a file</span>
<span class="sd">- natural representation of dates (datetime)</span>
<span class="sd">- taking into account all types of objects in binary form</span>

<span class="sd">Two binary format are available :</span>
<span class="sd">    </span>
<span class="sd">- BSON format (used in NoSQL databases like Mongodb)</span>
<span class="sd">- CBOR format (dedicated to small code size, small message size)</span>

<span class="sd">## Binary sensor interface</span>

<span class="sd">The binary payload is necessary for exchanges with LPWAN networks (e.g. LoRaWAN). </span>
<span class="sd">The payload should be as compact as possible to minimize the Time-on-Air </span>
<span class="sd">and reduce power consumption (for battery operated) devices. For example, the maximum</span>
<span class="sd">lenght of the payload is between 51 bytes and 222 bytes for LoRaWAN.</span>

<span class="sd">To obtain this maximum length, limitations are imposed.</span>

<span class="sd">Two formats are defined : </span>
<span class="sd">    </span>
<span class="sd">- CBOR format with optimization to insure low payload,</span>
<span class="sd">- internal optimized format for the most simple usages.</span>

<span class="sd">&lt;img src=&quot;./ES/binary.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd">The diagram above shows the structure of the payload.</span>

<span class="sd">*Note : The right side of the diagram explains the coding of the values. This coding </span>
<span class="sd">is the same as that used by Bluetooth in the &lt;a href=</span>
<span class="sd">&quot;https://www.bluetooth.com/specifications/specs/environmental-sensing-service-1-0/&quot; </span>
<span class="sd">target=&quot;_blank&quot;&gt;Environmental Sensing Service&lt;/a&gt;.*</span>

<span class="sd">To obtain low payload, a specific process can be used (see below). It allows data</span>
<span class="sd"> to be sent in two stages: first send metadata, second (in operation use) send data.</span>
<span class="sd"> </span>
<span class="sd">&lt;img src=&quot;./ES/sensor.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd"> </span>
<span class="sd">## Bluetooth mapping</span>

<span class="sd">The Environmental Sensing Service is a Bluetooth protocol for sensors. The data </span>
<span class="sd">exposed in this protocol are compatible and consistent with the Observation data model. </span>
<span class="sd">Thus, Bluetooth data is automatically converted into Observation data.</span>
<span class="sd"> </span>
<span class="sd">The diagram below shows the mapping of the two structures.</span>

<span class="sd">&lt;img src=&quot;./ES/bluetooth.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd">## Xarray mapping</span>

<span class="sd">Xarray is very powerful to analyze and process multi-dimensional data. Xarray </span>
<span class="sd">share the same principle as Observation: indexed multi-dimensional data. Thus, </span>
<span class="sd">it&#39;s natural du use Xarray if you want to analyze Observation data.</span>

<span class="sd">The difference between Observation and Xarray is that Xarray uses matrix data and </span>
<span class="sd">Observation uses only indexed data. Therefore, to transfer Observation data to Xarray </span>
<span class="sd">we must complete data with &#39;nan&#39; value to obtain a complete matrix with the right </span>
<span class="sd">dimension (1, 2 or 3).</span>

<span class="sd">The diagram below shows the mapping of the two structures.</span>

<span class="sd">&lt;img src=&quot;./ES/xarray.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd"># Getting Started</span>

<span class="sd">The code used, the results and the explanations are provided through &quot;Jupyter </span>
<span class="sd">Notebook&quot; indicated in link in each chapter.</span>
<span class="sd">The Notebook files are </span>
<span class="sd">&lt;a href=&quot;https://github.com/loco-philippe/loco-philippe.github.io/tree/main/Example&quot; target=&quot;_blank&quot;&gt;</span>
<span class="sd">stored in Github&lt;/a&gt; and can be replayed.</span>

<span class="sd">## First Observation</span>

<span class="sd">This chapter explain you </span>
<span class="sd">&lt;a href=&quot;./Example/first_observation.html&quot; target=&quot;_blank&quot;&gt;(see the page here)&lt;/a&gt; :</span>
<span class="sd">    </span>
<span class="sd">- how to create a simple and more complex Observation Object</span>
<span class="sd">- the different view of the data</span>
<span class="sd">- how the ObsJSON is structured </span>

<span class="sd">## Observation for sensor</span>

<span class="sd">A sensor sends data to a server with a specific protocol. The server stores and processes the data.</span>
<span class="sd">The sensor how use TCP/IP sends the data with ObsJSON format (see above).</span>
<span class="sd">This chapter introduces you to the to binary interface and explain you:</span>
<span class="sd">&lt;a href=&quot;./Example/sensor_observation.html&quot; target=&quot;_blank&quot;&gt;(see the page here)&lt;/a&gt; :</span>
<span class="sd">    </span>
<span class="sd">- how to encode and decode binary data</span>
<span class="sd">- the processes to obtain low data as explain in the &quot;Binary interface&quot; chapter</span>

<span class="sd">## Dimension concept</span>

<span class="sd">The dimension is an important concept to understand (see chapter above). </span>

<span class="sd">In this example, we show you Observations with differents dimensions (1 to 3).</span>

<span class="sd">We also present how Result values without index can be loaded with the &#39;order&#39; parameter.</span>

<span class="sd">&lt;a href=&quot;./Example/dimension.html&quot; target=&quot;_blank&quot;&gt;(see the page here)&lt;/a&gt; :</span>
<span class="sd">    </span>
<span class="sd">## Observation management</span>

<span class="sd">*Under construction*</span>

<span class="sd"># Quick overview</span>

<span class="sd">*Under construction*</span>

<span class="sd">## Create an Observation</span>

<span class="sd">*Under construction*</span>

<span class="sd">- Measuring station</span>
<span class="sd">- Mobile sensor</span>
<span class="sd">- Simulation</span>
<span class="sd">- Access information</span>
<span class="sd">- Visualize an Observation</span>

<span class="sd">## Generate an Exchange format</span>

<span class="sd">*Under construction*</span>

<span class="sd">- Binary format</span>
<span class="sd">- Json format</span>
<span class="sd">- No SQL format</span>

<span class="sd">## Managing Observations</span>

<span class="sd">*Under construction*</span>

<span class="sd">- Add</span>
<span class="sd">- Sort</span>
<span class="sd">- Filter</span>
<span class="sd">- Aggregation</span>

<span class="sd">## Interface</span>

<span class="sd">*Under construction*</span>

<span class="sd">- Numpy export</span>
<span class="sd">- Xarray export</span>
<span class="sd">- File storage</span>

<span class="sd"># Developers documentation</span>

<span class="sd">## Data model</span>

<span class="sd">An `ESObservation.Observation` is an object representing a set of information having</span>
<span class="sd">spatial and temporal characteristics associated with measurable or observable</span>
<span class="sd"> properties.</span>
<span class="sd"> </span>
<span class="sd">The Observation Object is built around three main bricks :</span>
<span class="sd">    </span>
<span class="sd">- Ilist Object which deal with indexing,</span>
<span class="sd">- ESValue Object which integrate the specificities of environmental data,</span>
<span class="sd">- Tools dedicated to particular domains ([Shapely](https://shapely.readthedocs.io/en/stable/manual.html) </span>
<span class="sd">for location, TimeSlot for Datation)</span>
<span class="sd">    </span>
<span class="sd">The ES functions are divided according to the class below:</span>
<span class="sd"> </span>
<span class="sd">&lt;img src=&quot;./ES/EShierarchie.png&quot; width=&quot;800&quot;&gt;</span>

<span class="sd">Modules contain the following classes:</span>
<span class="sd">    </span>
<span class="sd">- ESObservation : </span>
<span class="sd">    </span>
<span class="sd">    - `ES.ESObservation`</span>
<span class="sd">    </span>
<span class="sd">- ESValue : </span>
<span class="sd">    </span>
<span class="sd">    - `ES.ESValue`(`ES.ESValue.DatationValue`, `ES.ESValue.LocationValue`, `ES.ESValue.PropertyValue`,</span>
<span class="sd">    `ES.ESValue.NamedValue`, `ES.ESValue.ExternValue`, `ES.ESValue.ESValue`)</span>
<span class="sd">    </span>
<span class="sd">- Ilist : </span>
<span class="sd">    </span>
<span class="sd">    - `ES.ilist`</span>
<span class="sd">    </span>
<span class="sd">- Iindex : </span>
<span class="sd">    </span>
<span class="sd">    - `ES.iindex`</span>
<span class="sd">    </span>
<span class="sd">- TimeSlot : </span>
<span class="sd">    </span>
<span class="sd">    - `ES.timeslot`</span>

<span class="sd">- ESconstante : </span>
<span class="sd">    </span>
<span class="sd">    - `ES.ESconstante`.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

        </details>

            </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>